<HEAD>
<TITLE>Motion Strategy Library</TITLE>
</HEAD>

<body bgcolor="#ffffff">

<center><img src="msl.jpg"></center>

<p>


<!-- Generated by Doxygen 1.2.2 on Wed Aug 29 23:26:45 2001 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>renderiv.C</h1><a href="renderiv_C.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">//----------------------------------------------------------------------</font>
00002 <font class="comment">//               The Motion Strategy Library (MSL)</font>
00003 <font class="comment">//----------------------------------------------------------------------</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// Copyright (c) 1998-2000 Iowa State University and Steve LaValle.  </font>
00006 <font class="comment">// All Rights Reserved.</font>
00007 <font class="comment">// </font>
00008 <font class="comment">// Permission to use, copy, and distribute this software and its </font>
00009 <font class="comment">// documentation is hereby granted free of charge, provided that </font>
00010 <font class="comment">// (1) it is not a component of a commercial product, and </font>
00011 <font class="comment">// (2) this notice appears in all copies of the software and</font>
00012 <font class="comment">//     related documentation. </font>
00013 <font class="comment">// </font>
00014 <font class="comment">// Iowa State University and the author make no representations</font>
00015 <font class="comment">// about the suitability or fitness of this software for any purpose.  </font>
00016 <font class="comment">// It is provided "as is" without express or implied warranty.</font>
00017 <font class="comment">//----------------------------------------------------------------------</font>
00018 
00019 <font class="comment">// Standard includes</font>
00020 <font class="preprocessor">#include &lt;math.h&gt;</font>
00021 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00022 <font class="preprocessor">#include &lt;assert.h&gt;</font>
00023 
00024 <font class="comment">// OpenInventor includes</font>
00025 <font class="preprocessor">#include &lt;Xm/Xm.h&gt;</font>
00026 <font class="preprocessor">#include &lt;Inventor/Xt/SoXt.h&gt;</font>
00027 <font class="preprocessor">#include &lt;Inventor/SoDB.h&gt;</font>
00028 <font class="preprocessor">#include &lt;Inventor/Xt/viewers/SoXtExaminerViewer.h&gt;</font>
00029 <font class="preprocessor">#include &lt;Inventor/nodes/SoTransform.h&gt;</font>
00030 <font class="preprocessor">#include &lt;Inventor/nodes/SoSeparator.h&gt;</font>
00031 <font class="preprocessor">#include &lt;Inventor/nodes/SoCamera.h&gt;</font>
00032 <font class="preprocessor">#include &lt;Inventor/nodes/SoIndexedFaceSet.h&gt;</font>
00033 <font class="preprocessor">#include &lt;Inventor/nodes/SoMaterial.h&gt;</font>
00034 <font class="preprocessor">#include &lt;Inventor/nodes/SoLineSet.h&gt;</font>
00035 <font class="preprocessor">#include &lt;Inventor/nodes/SoSwitch.h&gt;</font>
00036 <font class="preprocessor">#include &lt;Inventor/sensors/SoTimerSensor.h&gt;</font>
00037 <font class="preprocessor">#include &lt;Inventor/fields/SoMFInt32.h&gt;</font>
00038 
00039 <font class="comment">// MSL includes</font>
00040 <font class="preprocessor">#include "<a class="code" href="renderiv_h.html">renderiv.h</a>"</font>
00041 <font class="preprocessor">#include "<a class="code" href="defs_h.html">defs.h</a>"</font>
00042 
00043 
00044 <font class="comment">// default viewer dimensions</font>
<a name="l00045"></a><a class="code" href="renderiv_C.html#a0">00045</a> <font class="keyword">const</font> <font class="keywordtype">short</font> DEF_VIEWER_WIDTH  = 500;
<a name="l00046"></a><a class="code" href="renderiv_C.html#a1">00046</a> <font class="keyword">const</font> <font class="keywordtype">short</font> DEF_VIEWER_HEIGHT = 400;
00047 
00048 <font class="comment">//---------------------------------------------------------------------</font>
00049 <font class="comment">//                       RenderIv</font>
00050 <font class="comment">//</font>
00051 <font class="comment">// Method:  Constructors</font>
00052 <font class="comment">//</font>
00053 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00054"></a><a class="code" href="class_RenderIv.html#a0">00054</a> <a class="code" href="class_RenderIv.html#a0">RenderIv::RenderIv</a>(): <a class="code" href="class_Render.html">Render</a>()
00055 {
00056   ControlFreak = <font class="keyword">true</font>;
00057   _ivRoot = NULL;
00058   _ivData = NULL;
00059 }
00060 
00061 
<a name="l00062"></a><a class="code" href="class_RenderIv.html#a1">00062</a> <a class="code" href="class_RenderIv.html#a0">RenderIv::RenderIv</a>(string filepath=<font class="stringliteral">""</font>): <a class="code" href="class_Render.html">Render</a>(filepath)
00063 {
00064   ControlFreak = <font class="keyword">true</font>;
00065   _ivRoot = NULL;
00066   _ivData = NULL;
00067 }
00068 
00069 
<a name="l00070"></a><a class="code" href="class_RenderIv.html#a2">00070</a> <a class="code" href="class_RenderIv.html#a0">RenderIv::RenderIv</a>(<a class="code" href="class_Scene.html">Scene</a> *s, string filepath): <a class="code" href="class_Render.html">Render</a>(s,filepath)
00071 {
00072   ControlFreak = <font class="keyword">true</font>;
00073   _ivRoot = NULL;
00074   _ivData = NULL;
00075 }
00076 
00077 
00078 <font class="comment">//---------------------------------------------------------------------</font>
00079 <font class="comment">//                       RenderIv</font>
00080 <font class="comment">//</font>
00081 <font class="comment">// Method:  Destructor</font>
00082 <font class="comment">//</font>
00083 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00084"></a><a class="code" href="class_RenderIv.html#a3">00084</a> <a class="code" href="class_RenderIv.html#a3">RenderIv::~RenderIv</a>()<font class="keyword">
</font>00085 <font class="keyword"></font>{
00086   <font class="keywordflow">if</font> (_ivRoot)
00087     _ivRoot-&gt;unref();
00088   <font class="comment">// inventor garbage collection should take care of deleting</font>
00089   <font class="comment">// this and all of the other scene graph nodes</font>
00090 }
00091 
00092 
00093 <font class="comment">//---------------------------------------------------------------------</font>
00094 <font class="comment">//                       RenderIv</font>
00095 <font class="comment">//</font>
00096 <font class="comment">// Method:  Reset</font>
00097 <font class="comment">//</font>
00098 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00099"></a><a class="code" href="class_RenderIv.html#a4">00099</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderIv.html#a4">RenderIv::Reset</a>()<font class="keyword">
</font>00100 <font class="keyword"></font>{
00101   <font class="comment">// Use reset from base class</font>
00102   <a class="code" href="class_Render.html#a7">Render::Reset</a>();
00103 
00104   <font class="comment">// clear all data</font>
00105   <font class="keywordflow">if</font> (_ivData)
00106     _ivData-&gt;removeAllChildren();
00107 }
00108 
00109 
00110 
00111 <font class="comment">//---------------------------------------------------------------------</font>
00112 <font class="comment">//                       RenderIv</font>
00113 <font class="comment">//</font>
00114 <font class="comment">// Method:  Init</font>
00115 <font class="comment">//</font>
00116 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00117"></a><a class="code" href="class_RenderIv.html#a5">00117</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderIv.html#a5">RenderIv::Init</a>()<font class="keyword">
</font>00118 <font class="keyword"></font>{
00119   <a class="code" href="class_Render.html#a4">Render::Init</a>();
00120 
00121   <font class="comment">// initialize Xt and Inventor</font>
00122   <font class="keyword">const</font> <font class="keywordtype">char</font>* MAIN_WINDOW_TITLE = <font class="stringliteral">"MSL Library   Iowa State University"</font>;
00123   Widget mainWindow = SoXt::init(MAIN_WINDOW_TITLE);
00124   <font class="keywordflow">if</font> (!mainWindow) {
00125     exit(1);
00126   }
00127 
00128   <font class="comment">//create the root</font>
00129   _ivRoot = <font class="keyword">new</font> SoSeparator;
00130   _ivRoot-&gt;ref();
00131 
00132   <font class="comment">// create the main perspective viewer</font>
00133   _viewer = <font class="keyword">new</font> SoXtExaminerViewer(mainWindow);
00134   _viewer-&gt;setTitle(MAIN_WINDOW_TITLE);
00135   _viewer-&gt;setSceneGraph(_ivRoot);
00136   _viewer-&gt;setSize(SbVec2s(DEF_VIEWER_WIDTH, DEF_VIEWER_HEIGHT));
00137   _viewer-&gt;show();
00138 
00139   <font class="comment">// Sest default view for the camera</font>
00140   <font class="keywordtype">float</font> defaultCam[3] = { 0.0, 3.0, 5.0 };
00141   <font class="keywordflow">if</font> (S-&gt;GeomDim == 2)
00142     defaultCam[1] = -defaultCam[1];
00143   SoCamera *camera = _viewer-&gt;getCamera();
00144   camera-&gt;position.setValue(defaultCam[0], defaultCam[1], defaultCam[2]);
00145   camera-&gt;pointAt(SbVec3f(0.0, 0.0, 0.0));
00146   camera-&gt;focalDistance.setValue(camera-&gt;position.getValue().length());
00147   _viewer-&gt;saveHomePosition();
00148   
00149   <font class="comment">// set the background color</font>
00150   SbColor ivColor(0,0,0);
00151   _viewer-&gt;setBackgroundColor(ivColor);
00152 
00153   <font class="comment">// set up the timer callback </font>
00154   SoTimerSensor *callbackSensor = <font class="keyword">new</font> SoTimerSensor(_TimerCB, <font class="keyword">this</font>);
00155   callbackSensor-&gt;setInterval(1/2000.0);  <font class="comment">// as fast as possible</font>
00156   callbackSensor-&gt;schedule();
00157  
00158   <font class="comment">// initialize the data</font>
00159   _ivData = <font class="keyword">new</font> SoSeparator;
00160   _ivRoot-&gt;addChild(_ivData);
00161   <font class="keywordflow">if</font> (!<a class="code" href="class_RenderIv.html#b6">_InitData</a>()) cerr &lt;&lt; <font class="stringliteral">"renderiv: Error initializing data"</font> &lt;&lt; endl;
00162   _viewer-&gt;viewAll();
00163 
00164   <font class="comment">// show the window</font>
00165   SoXt::show(mainWindow);
00166 }
00167 
00168 
00169 <font class="comment">//---------------------------------------------------------------------</font>
00170 <font class="comment">//                           RenderIv</font>
00171 <font class="comment">// Method:  MainLoop</font>
00172 <font class="comment">//</font>
00173 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00174"></a><a class="code" href="class_RenderIv.html#a6">00174</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderIv.html#a6">RenderIv::MainLoop</a>(<a class="code" href="class_Gui.html">Gui</a> *g)<font class="keyword">
</font>00175 <font class="keyword"></font>{
00176   g-&gt;Finished = <font class="keyword">false</font>;
00177   _pGui = g;
00178 
00179   <font class="comment">// enter the inventor loop</font>
00180   SoXt::mainLoop();
00181 }
00182 
00183 
00185 <font class="comment">//</font>
00186 <font class="comment">// PROTECTED METHODS</font>
00187 <font class="comment">//</font>
00188 
00189 
00190 <font class="comment">//---------------------------------------------------------------------</font>
00191 <font class="comment">//                           RenderIv</font>
00192 <font class="comment">// Method:  _TimerCB</font>
00193 <font class="comment">//</font>
00194 <font class="comment">// Purpose: Callback for the timer sensor</font>
00195 <font class="comment">//</font>
00196 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00197"></a><a class="code" href="class_RenderIv.html#e0">00197</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderIv.html#e0">RenderIv::_TimerCB</a>(<font class="keywordtype">void</font> *userData, SoSensor *)<font class="keyword">
</font>00198 <font class="keyword"></font>{
00199   <a class="code" href="class_RenderIv.html">RenderIv</a> *riv = (<a class="code" href="class_RenderIv.html">RenderIv</a> *)userData;
00200   <font class="comment">// execute idle function</font>
00201   riv-&gt;<a class="code" href="class_RenderIv.html#b0">_IdleFunction</a>();
00202 }
00203 
00204 
00205 
00206 <font class="comment">//---------------------------------------------------------------------</font>
00207 <font class="comment">//                           RenderIv</font>
00208 <font class="comment">// Method:  _TimerCB</font>
00209 <font class="comment">//</font>
00210 <font class="comment">// Purpose: Callback for the timer sensor</font>
00211 <font class="comment">//</font>
00212 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00213"></a><a class="code" href="class_RenderIv.html#b0">00213</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> <a class="code" href="class_RenderIv.html#b0">RenderIv::_IdleFunction</a>()<font class="keyword">
</font>00214 <font class="keyword"></font>{
00215   <font class="comment">// Handle the window events for the Gui</font>
00216   _pGui-&gt;<a class="code" href="class_Gui.html#a3">HandleEvents</a>();
00217 
00218   <font class="comment">// Allow exiting by pressing Exit button in Gui</font>
00219   <font class="keywordflow">if</font> (_pGui-&gt;Finished) exit(-1);
00220 
00221   <font class="comment">// update display toggles</font>
00222   <font class="keywordflow">if</font> (_bDisplayBounds != BoundingBoxOn) {
00223     _bDisplayBounds = BoundingBoxOn;
00224     <a class="code" href="class_RenderIv.html#b7">_SetSwitch</a>(_ivBoundsSwitch, _bDisplayBounds);
00225   }
00226   <font class="keywordflow">if</font> (_bDisplayPath != ShowPathOn) {
00227     _bDisplayPath = ShowPathOn;
00228     <a class="code" href="class_RenderIv.html#b7">_SetSwitch</a>(_ivPathSwitch, _bDisplayPath);
00229   }
00230   <font class="keywordflow">if</font> (_bDisplayPath &amp;&amp; NumFrames != _pathFrames)
00231     <a class="code" href="class_RenderIv.html#b8">_UpdatePathDisplay</a>();
00232 
00233   <font class="comment">// update body state if animation is on</font>
00234   <font class="keywordflow">if</font> (AnimationActive) {
00235     <a class="code" href="class_Render.html#b0">SetCurrentAnimationFrame</a>();
00236     <a class="code" href="class_RenderIv.html#b10">_UpdateBodies</a>(CurrentAnimationFrame);
00237   }
00238 }
00239 
00240 
00241 <font class="comment">//---------------------------------------------------------------------</font>
00242 <font class="comment">//                            RenderIv</font>
00243 <font class="comment">// Method:  _ReadIvFile</font>
00244 <font class="comment">//</font>
00245 <font class="comment">// Purpose: Read Inventor scene from a file</font>
00246 <font class="comment">//</font>
00247 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00248"></a><a class="code" href="class_RenderIv.html#b1">00248</a> SoSeparator* <a class="code" href="class_RenderIv.html#b1">RenderIv::_ReadIvFile</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *filename)<font class="keyword">
</font>00249 <font class="keyword"></font>{
00250   <font class="comment">// Open the input file</font>
00251   SoInput sceneInput;
00252   <font class="keywordflow">if</font> (!sceneInput.openFile(filename)) {
00253     cerr &lt;&lt; <font class="stringliteral">"Cannot open file: "</font> &lt;&lt; filename &lt;&lt; endl;
00254     <font class="keywordflow">return</font> NULL;
00255   }
00256 
00257   <font class="comment">// Read the whole file into the database</font>
00258   SoSeparator *graph = SoDB::readAll(&amp;sceneInput);
00259   <font class="keywordflow">if</font> (graph == NULL) {
00260     cerr &lt;&lt; <font class="stringliteral">"Problem reading file: "</font> &lt;&lt; filename &lt;&lt; endl;
00261     <font class="keywordflow">return</font> NULL;
00262   } 
00263 
00264   sceneInput.closeFile();
00265   <font class="keywordflow">return</font> graph;
00266 }
00267 
00268 
00269 <font class="comment">//---------------------------------------------------------------------</font>
00270 <font class="comment">//                           RenderIv</font>
00271 <font class="comment">// Method:  _InitObject</font>
00272 <font class="comment">//</font>
00273 <font class="comment">// Purpose: Load a single object</font>
00274 <font class="comment">//</font>
00275 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00276"></a><a class="code" href="class_RenderIv.html#b2">00276</a> SoSeparator* <a class="code" href="class_RenderIv.html#b2">RenderIv::_InitObject</a>(<font class="keyword">const</font> string &amp;fname)<font class="keyword">
</font>00277 <font class="keyword"></font>{
00278   SoSeparator* pObject = NULL;
00279   cout &lt;&lt; <font class="stringliteral">"  loading file: "</font> &lt;&lt; fname &lt;&lt; endl;
00280 
00281   <font class="comment">// check for native inventor file</font>
00282   <font class="keywordflow">if</font> (fname.substr(fname.length()-3,3) == <font class="stringliteral">".iv"</font>)
00283     pObject = <a class="code" href="class_RenderIv.html#b1">_ReadIvFile</a>(fname.c_str());
00284   <font class="keywordflow">else</font> {
00285     <font class="comment">// otherwise load raw geometry</font>
00286     list&lt;MSLTriangle&gt; trlist;
00287     std::ifstream fin(fname.c_str());
00288     
00289     <font class="keywordflow">if</font> (S-&gt;GeomDim == 2) {
00290       list&lt;MSLPolygon&gt; plist;
00291       fin &gt;&gt; plist;
00292       trlist = <a class="code" href="triangle_h.html#a0">PolygonsToTriangles</a>(plist, 2.0); <font class="comment">// Defined in 3Dtriangle.C</font>
00293     }
00294     <font class="keywordflow">else</font>
00295       fin &gt;&gt; trlist;
00296     pObject = <a class="code" href="class_RenderIv.html#b5">_InitTriangleGeom</a>(trlist);
00297   }
00298     
00299   <font class="keywordflow">return</font> pObject;
00300 }
00301 
00302 
00303 <font class="comment">//---------------------------------------------------------------------</font>
00304 <font class="comment">//                           RenderIv</font>
00305 <font class="comment">// Method:  _InitBoundsDisplay</font>
00306 <font class="comment">//</font>
00307 <font class="comment">// Purpose: initialize workspace boundary visualization</font>
00308 <font class="comment">//</font>
00309 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00310"></a><a class="code" href="class_RenderIv.html#b3">00310</a> <font class="keywordtype">bool</font> <a class="code" href="class_RenderIv.html#b3">RenderIv::_InitBoundsDisplay</a>()<font class="keyword">
</font>00311 <font class="keyword"></font>{
00312   <font class="comment">// build configuration bounds visualization nodes</font>
00313   SoVertexProperty* pVertexProp = <font class="keyword">new</font> SoVertexProperty;
00314   SoLineSet *lines = <font class="keyword">new</font> SoLineSet;
00315   lines-&gt;vertexProperty = pVertexProp;
00316   _ivBoundsSwitch = <font class="keyword">new</font> SoSwitch(1);
00317   _ivBoundsSwitch-&gt;addChild(lines);
00318   _ivRoot-&gt;addChild(_ivBoundsSwitch);
00319   _bDisplayBounds = <font class="keyword">false</font>;
00320   <font class="comment">// display the bounds if flag is set</font>
00321   <a class="code" href="class_RenderIv.html#b7">_SetSwitch</a>(_ivBoundsSwitch, _bDisplayBounds);
00322 
00323   <font class="comment">// set the color</font>
00324   <font class="keyword">const</font> <font class="keywordtype">float</font> color[3] = { 0.5, 0.5, 0.5};
00325   uint32_t red   = uint32_t(color[0] * 255) &lt;&lt; 24;
00326   uint32_t green = uint32_t(color[1] * 255) &lt;&lt; 16;
00327   uint32_t blue  = uint32_t(color[2] * 255) &lt;&lt; 8;
00328   uint32_t alpha = 0x000000FF;
00329   uint32_t packedColor = red | green | blue | alpha;
00330   pVertexProp-&gt;orderedRGBA.setValue(packedColor);
00331 
00332   <font class="comment">// default bounding box</font>
00333   <font class="keywordtype">float</font> L[3] = { -10, -10, -10 };
00334   <font class="keywordtype">float</font> U[3] = { 10, 10, 10 };
00335   
00336   <font class="comment">// get the workspace bounds</font>
00337   <font class="keywordflow">if</font> (S-&gt;LowerWorld[0] != S-&gt;UpperWorld[0]) {
00338     L[0]= S-&gt;LowerWorld[0];  L[1]= S-&gt;LowerWorld[1];  L[2]= S-&gt;LowerWorld[2];
00339     U[0]= S-&gt;UpperWorld[0];  U[1]= S-&gt;UpperWorld[1];  U[2]= S-&gt;UpperWorld[2];
00340   }
00341   cerr &lt;&lt; <font class="stringliteral">"Workspace boundary: ( "</font> &lt;&lt; L[0] &lt;&lt; <font class="stringliteral">", "</font> &lt;&lt; L[1] &lt;&lt; <font class="stringliteral">", "</font> &lt;&lt; L[2]
00342        &lt;&lt; <font class="stringliteral">" ) - ( "</font>  &lt;&lt; U[0] &lt;&lt; <font class="stringliteral">", "</font> &lt;&lt; U[1] &lt;&lt; <font class="stringliteral">", "</font> &lt;&lt; U[2] &lt;&lt; <font class="stringliteral">" )"</font> &lt;&lt; endl;
00343 
00344   <font class="comment">// set the bounding box lines</font>
00345   <font class="keyword">const</font> <font class="keywordtype">int</font> numPoints = 16;
00346   <font class="keywordtype">float</font> points[numPoints][3] = {
00347     {L[0],L[1],L[2]}, {L[0],L[1],U[2]}, {U[0],L[1],U[2]}, {U[0],L[1],L[2]},
00348     {L[0],L[1],L[2]}, {L[0],U[1],L[2]}, {L[0],U[1],U[2]}, {U[0],U[1],U[2]},
00349     {U[0],U[1],L[2]}, {L[0],U[1],L[2]}, {U[0],U[1],L[2]}, {U[0],L[1],L[2]},
00350     {U[0],L[1],U[2]}, {U[0],U[1],U[2]}, {L[0],U[1],U[2]}, {L[0],L[1],U[2]}
00351   };
00352   pVertexProp-&gt;vertex.setNum(numPoints);
00353   pVertexProp-&gt;vertex.setValues(0, numPoints, points);
00354 
00355   <font class="keywordflow">return</font> <font class="keyword">true</font>;
00356 }
00357 
00358 
00359 <font class="comment">//---------------------------------------------------------------------</font>
00360 <font class="comment">//                           RenderIv</font>
00361 <font class="comment">// Method:  _InitPathDisplay</font>
00362 <font class="comment">//</font>
00363 <font class="comment">// Purpose: initialize path visualization</font>
00364 <font class="comment">//</font>
00365 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00366"></a><a class="code" href="class_RenderIv.html#b4">00366</a> <font class="keywordtype">bool</font> <a class="code" href="class_RenderIv.html#b4">RenderIv::_InitPathDisplay</a>()<font class="keyword">
</font>00367 <font class="keyword"></font>{
00368   <font class="comment">// build configuration bounds visualization nodes</font>
00369   _pPathVertexProp = <font class="keyword">new</font> SoVertexProperty;
00370   SoLineSet *lines = <font class="keyword">new</font> SoLineSet;
00371   lines-&gt;vertexProperty = _pPathVertexProp;
00372   _ivPathSwitch = <font class="keyword">new</font> SoSwitch(1);
00373   _ivPathSwitch-&gt;addChild(lines);
00374   _ivRoot-&gt;addChild(_ivPathSwitch);
00375   _bDisplayPath = <font class="keyword">false</font>;
00376   _pathFrames = 0;
00377   <font class="comment">// display the bounds if flag is set</font>
00378   <a class="code" href="class_RenderIv.html#b7">_SetSwitch</a>(_ivPathSwitch, _bDisplayPath);
00379 
00380   <font class="comment">// set the color</font>
00381   <font class="keyword">const</font> <font class="keywordtype">float</font> color[3] = { 1.0, 1.0, 0.2};
00382   uint32_t red   = uint32_t(color[0] * 255) &lt;&lt; 24;
00383   uint32_t green = uint32_t(color[1] * 255) &lt;&lt; 16;
00384   uint32_t blue  = uint32_t(color[2] * 255) &lt;&lt; 8;
00385   uint32_t alpha = 0x000000FF;
00386   uint32_t packedColor = red | green | blue | alpha;
00387   _pPathVertexProp-&gt;orderedRGBA.setValue(packedColor);
00388 
00389   <font class="comment">// default bounding box</font>
00390   <font class="keywordtype">float</font> L[3] = { -3, -3, -1 };
00391   <font class="keywordtype">float</font> U[3] = { 2, 3, 1 };
00392 
00393   <font class="comment">// reset to empty path</font>
00394   <font class="keyword">const</font> <font class="keywordtype">int</font> numPoints = 16;
00395   <font class="keywordtype">float</font> points[numPoints][3] = {
00396     {L[0],L[1],L[2]}, {L[0],L[1],U[2]}, {U[0],L[1],U[2]}, {U[0],L[1],L[2]},
00397     {L[0],L[1],L[2]}, {L[0],U[1],L[2]}, {L[0],U[1],U[2]}, {U[0],U[1],U[2]},
00398     {U[0],U[1],L[2]}, {L[0],U[1],L[2]}, {U[0],U[1],L[2]}, {U[0],L[1],L[2]},
00399     {U[0],L[1],U[2]}, {U[0],U[1],U[2]}, {L[0],U[1],U[2]}, {L[0],L[1],U[2]}
00400   };
00401   _pPathVertexProp-&gt;vertex.setNum(numPoints);
00402   _pPathVertexProp-&gt;vertex.setValues(0, numPoints, points);
00403 
00404   <font class="keywordflow">return</font> <font class="keyword">true</font>;
00405 }
00406 
00407 
00408 <font class="comment">//---------------------------------------------------------------------</font>
00409 <font class="comment">//                           RenderIv</font>
00410 <font class="comment">//</font>
00411 <font class="comment">// Method:  _InitTriangleGeom</font>
00412 <font class="comment">//</font>
00413 <font class="comment">// Purpose: initialize object geometry from triangles</font>
00414 <font class="comment">//</font>
00415 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00416"></a><a class="code" href="class_RenderIv.html#b5">00416</a> SoSeparator* <a class="code" href="class_RenderIv.html#b5">RenderIv::_InitTriangleGeom</a>(list&lt;MSLTriangle&gt; &amp;triangles)<font class="keyword">
</font>00417 <font class="keyword"></font>{
00418   <font class="keywordtype">int</font> numTriangles = triangles.size();
00419   <font class="keywordflow">if</font> (numTriangles &lt;= 0) {
00420     cerr &lt;&lt; <font class="stringliteral">"renderiv: WARNING - empty triangle list."</font> &lt;&lt; endl;
00421     <font class="keywordflow">return</font> NULL;
00422   }
00423 
00424   <font class="comment">// build iv hierarchy</font>
00425   SoSeparator* pSep = <font class="keyword">new</font> SoSeparator;
00426   SoMaterial* pMat = <font class="keyword">new</font> SoMaterial;
00427   SoVertexProperty* pVertexProp = <font class="keyword">new</font> SoVertexProperty;
00428   SoIndexedFaceSet* pFaceSet = <font class="keyword">new</font> SoIndexedFaceSet;
00429   pSep-&gt;addChild(pMat);
00430   pSep-&gt;addChild(pFaceSet);
00431 
00432   <font class="comment">// Change the colors for different bodies</font>
00433   <font class="keyword">static</font> <font class="keywordtype">int</font> objnum = 0;
00434   objnum++;
00435   SbColor c(RGBRed[(objnum) % RENDERCOLORS],
00436             RGBGreen[(objnum) % RENDERCOLORS],
00437             RGBBlue[(objnum) % RENDERCOLORS]);
00438   pMat-&gt;diffuseColor.setValue(c[0], c[1], c[2]);
00439 
00440   <font class="comment">// set the vertex data</font>
00441   pFaceSet-&gt;vertexProperty = pVertexProp;
00442   <font class="keyword">const</font> <font class="keywordtype">int</font> numVerts = numTriangles * 3;
00443   <font class="keyword">typedef</font> <font class="keywordtype">float</font> float3[3];
00444   float3* points = <font class="keyword">new</font> float3[numVerts];
00445   <font class="keywordtype">int</font> v = 0;
00446   list&lt;MSLTriangle&gt;::iterator t;
00447   <a class="code" href="defs_h.html#a8">forall</a>(t, triangles)<font class="keyword"> </font>{
00448     points[v][0] = t-&gt;p1.xcoord();
00449     points[v][1] = t-&gt;p1.ycoord();
00450     points[v][2] = t-&gt;p1.zcoord();
00451     v++;
00452     points[v][0] = t-&gt;p2.xcoord();
00453     points[v][1] = t-&gt;p2.ycoord();
00454     points[v][2] = t-&gt;p2.zcoord();
00455     v++;
00456     points[v][0] = t-&gt;p3.xcoord();
00457     points[v][1] = t-&gt;p3.ycoord();
00458     points[v][2] = t-&gt;p3.zcoord();
00459     v++;
00460   }
00461   assert(v == numVerts);
00462   pVertexProp-&gt;vertex.setNum(numVerts);
00463   pVertexProp-&gt;vertex.setValues(0, numVerts, points);
00464   
00465   <font class="comment">// set the triangle vertex indices</font>
00466   <font class="keyword">const</font> <font class="keywordtype">int</font> numIndices = numTriangles * 4;
00467   int32_t *vIndex = <font class="keyword">new</font> int32_t[numIndices];
00468   <font class="keywordtype">int</font> i = 0;
00469   v = 0;
00470   <font class="keywordflow">for</font> (<font class="keywordtype">int</font> t = 0; t &lt; numTriangles; t++) {
00471     vIndex[i++] = v++;  vIndex[i++] = v++;  vIndex[i++] = v++; 
00472     vIndex[i++] = -1; 
00473   }
00474   assert (v == numVerts);
00475   assert (i == numIndices);
00476 
00477   pFaceSet-&gt;coordIndex.setValues(0, numIndices, vIndex);
00478   pFaceSet-&gt;coordIndex.setNum(numIndices);
00479   <font class="keyword">delete</font> [] vIndex;
00480 
00481   <font class="keywordflow">return</font> pSep;
00482 }
00483 
00484 
00485 <font class="comment">//---------------------------------------------------------------------</font>
00486 <font class="comment">//                           RenderIv</font>
00487 <font class="comment">// Method:  _InitData</font>
00488 <font class="comment">//</font>
00489 <font class="comment">// Purpose: Load all obstacles and body geometry </font>
00490 <font class="comment">//</font>
00491 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00492"></a><a class="code" href="class_RenderIv.html#b6">00492</a> <font class="keywordtype">bool</font> <a class="code" href="class_RenderIv.html#b6">RenderIv::_InitData</a>()<font class="keyword">
</font>00493 <font class="keyword"></font>{
00494   <font class="comment">// set control variables</font>
00495   AnimationActive = <font class="keyword">false</font>;
00496 
00497   <font class="comment">// EnvList was initialized by Init in Render base class</font>
00498   list&lt;string&gt;::iterator fname;
00499   <a class="code" href="defs_h.html#a8">forall</a>(fname, EnvList)<font class="keyword"> </font>{
00500     SoSeparator* pObject = <a class="code" href="class_RenderIv.html#b2">_InitObject</a>(FilePath + *fname);
00501     <font class="keywordflow">if</font> (!pObject)
00502       cerr &lt;&lt; <font class="stringliteral">"renderiv: ERROR initializing obstacle: "</font> &lt;&lt; *fname &lt;&lt; endl;
00503     <font class="keywordflow">else</font>
00504       _ivRoot-&gt;addChild(pObject);
00505   }
00506 
00507   <font class="comment">// Bodies</font>
00508   <a class="code" href="defs_h.html#a8">forall</a>(fname, BodyList)<font class="keyword"> </font>{
00509     SoSeparator* pObject = <a class="code" href="class_RenderIv.html#b2">_InitObject</a>(FilePath + *fname);
00510     <font class="keywordflow">if</font> (!pObject)
00511       cerr &lt;&lt; <font class="stringliteral">"renderiv: ERROR initializing body: "</font> &lt;&lt; *fname &lt;&lt; endl;
00512     <font class="keywordflow">else</font> {
00513       <font class="comment">// create a movable transformation</font>
00514       SoSeparator* objRoot  = <font class="keyword">new</font> SoSeparator;
00515       SoTransform* objTrans = <font class="keyword">new</font> SoTransform;
00516       objRoot-&gt;addChild(objTrans);
00517       objRoot-&gt;addChild(pObject);
00518       _ivRoot-&gt;addChild(objRoot);
00519       _bodyTrans.push_back(objTrans);
00520     }
00521   }
00522 
00523   <font class="comment">// init the display items</font>
00524   <font class="keywordflow">if</font> (!<a class="code" href="class_RenderIv.html#b3">_InitBoundsDisplay</a>())
00525     cerr &lt;&lt; <font class="stringliteral">"renderiv: ERROR initializing workspace boundary"</font> &lt;&lt; endl;
00526   <font class="keywordflow">if</font> (!<a class="code" href="class_RenderIv.html#b4">_InitPathDisplay</a>())
00527     cerr &lt;&lt; <font class="stringliteral">"renderiv: ERROR initializing path display"</font> &lt;&lt; endl;
00528 
00529 
00530   <font class="comment">// update the current positions</font>
00531   <a class="code" href="class_RenderIv.html#b10">_UpdateBodies</a>(CurrentAnimationFrame);
00532   
00533   <font class="keywordflow">return</font> <font class="keyword">true</font>;
00534 }
00535 
00536 
00537 <font class="comment">//---------------------------------------------------------------------</font>
00538 <font class="comment">//                           RenderIv</font>
00539 <font class="comment">// Method:  _SetSwitch</font>
00540 <font class="comment">//</font>
00541 <font class="comment">// Purpose: set the value of a rendering switch</font>
00542 <font class="comment">//</font>
00543 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00544"></a><a class="code" href="class_RenderIv.html#b7">00544</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> <a class="code" href="class_RenderIv.html#b7">RenderIv::_SetSwitch</a>(SoSwitch *pSwitch, <font class="keywordtype">bool</font> bFlag)<font class="keyword">
</font>00545 <font class="keyword"></font>{
00546   pSwitch-&gt;whichChild.setValue(bFlag ? SO_SWITCH_ALL : SO_SWITCH_NONE); 
00547 }
00548 
00549 
00550 <font class="comment">//---------------------------------------------------------------------</font>
00551 <font class="comment">//                           RenderIv</font>
00552 <font class="comment">//</font>
00553 <font class="comment">// Method:  _UpdatePathDisplay</font>
00554 <font class="comment">//</font>
00555 <font class="comment">// Purpose: update the path visualization</font>
00556 <font class="comment">//</font>
00557 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00558"></a><a class="code" href="class_RenderIv.html#b8">00558</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderIv.html#b8">RenderIv::_UpdatePathDisplay</a>()<font class="keyword">
</font>00559 <font class="keyword"></font>{
00560   _pathFrames = NumFrames;
00561 
00562   <font class="comment">// check for empty path</font>
00563   <font class="keywordflow">if</font> (NumFrames &lt; 2) {
00564     _pPathVertexProp-&gt;vertex.setNum(0);
00565     <font class="keywordflow">return</font>;
00566   }
00567 
00568   <a class="code" href="class_MSLVector.html">MSLVector</a> next, prev = FrameList.front();
00569   <font class="keywordtype">int</font> BodyNum = prev.<a class="code" href="class_MSLVector.html#a8">dim</a>() / 6;
00570 
00571   <font class="comment">// point allocation</font>
00572   <font class="keyword">const</font> <font class="keywordtype">int</font> numPoints = BodyNum * ((NumFrames - 1) * 2);
00573   <font class="keyword">typedef</font> <font class="keywordtype">float</font> float3[3];
00574   float3* points = <font class="keyword">new</font> float3[numPoints];
00575 
00576   <font class="comment">// get all frame data</font>
00577   <font class="keywordtype">int</font> bInd;
00578   <font class="keywordtype">int</font> p = 0;
00579 
00580   list&lt;MSLVector&gt;::iterator frp;
00581   frp = FrameList.begin();
00582   <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 1; i &lt; NumFrames; i++) {
00583     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j = 0; j &lt; BodyNum; j++) {
00584       bInd = 6 * j;
00585       frp++; next = *frp;
00586       <font class="comment">// set the endpoints</font>
00587       points[p][0] = prev[bInd];
00588       points[p][1] = prev[bInd+1];
00589       points[p][2] = prev[bInd+2];
00590       p++;
00591       points[p][0] = next[bInd];
00592       points[p][1] = next[bInd+1];
00593       points[p][2] = next[bInd+2];
00594       p++;
00595       prev = next;
00596     }
00597   }
00598   assert(p == numPoints);
00599 
00600   <font class="comment">// set the points</font>
00601   _pPathVertexProp-&gt;vertex.setNum(numPoints);
00602   _pPathVertexProp-&gt;vertex.setValues(0, numPoints, points);
00603   <font class="keyword">delete</font> [] points;
00604 }
00605 
00606 
00607 <font class="comment">//---------------------------------------------------------------------</font>
00608 <font class="comment">//                           RenderIv</font>
00609 <font class="comment">//</font>
00610 <font class="comment">// Method:  _SetBodyTransform</font>
00611 <font class="comment">//</font>
00612 <font class="comment">// Purpose: set a 3D transformation</font>
00613 <font class="comment">//</font>
00614 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00615"></a><a class="code" href="class_RenderIv.html#b9">00615</a> <font class="keyword">inline</font> <font class="keywordtype">void</font> <a class="code" href="class_RenderIv.html#b9">RenderIv::_SetTransform</a>(SoTransform* pTrans,
00616                                     <font class="keywordtype">double</font> tx, <font class="keywordtype">double</font> ty, <font class="keywordtype">double</font> tz,
00617                                     <font class="keywordtype">double</font> rx, <font class="keywordtype">double</font> ry, <font class="keywordtype">double</font> rz)<font class="keyword">
</font>00618 <font class="keyword"></font>{
00619   <font class="comment">// set the rotation matrix from RPY euler angles</font>
00620   <font class="keywordtype">float</font> ca = cos(rx);   <font class="keywordtype">float</font> sa = sin(rx);
00621   <font class="keywordtype">float</font> cb = cos(ry);   <font class="keywordtype">float</font> sb = sin(ry);
00622   <font class="keywordtype">float</font> cc = cos(rz);   <font class="keywordtype">float</font> sc = sin(rz);
00623   
00624   <font class="keywordtype">float</font> R11 = cb * cc;
00625   <font class="keywordtype">float</font> R12 = sa * sb * cc  -  ca * sc;
00626   <font class="keywordtype">float</font> R13 = ca * sb * cc  +  sa * sc;
00627   <font class="keywordtype">float</font> R21 = cb * sc;
00628   <font class="keywordtype">float</font> R22 = sa * sb * sc  +  ca * cc;
00629   <font class="keywordtype">float</font> R23 = ca * sb * sc  -  sa * cc;
00630   <font class="keywordtype">float</font> R31 = -sb;
00631   <font class="keywordtype">float</font> R32 = sa * cb;
00632   <font class="keywordtype">float</font> R33 = ca * cb;
00633 
00634   <font class="comment">// build row-major matrix</font>
00635   SbMatrix matrix(R11,  R21,  R31,  0.0,
00636                   R12,  R22,  R32,  0.0,
00637                   R13,  R23,  R33,  0.0,
00638                   tx,   ty,   tz,   1.0);
00639   pTrans-&gt;setMatrix(matrix);
00640 }
00641 
00642 
00643 <font class="comment">//---------------------------------------------------------------------</font>
00644 <font class="comment">//                           RenderIv</font>
00645 <font class="comment">//</font>
00646 <font class="comment">// Method:  _UpdateBodies</font>
00647 <font class="comment">//</font>
00648 <font class="comment">// Purpose: update the body configuration</font>
00649 <font class="comment">//</font>
00650 <font class="comment">//---------------------------------------------------------------------</font>
<a name="l00651"></a><a class="code" href="class_RenderIv.html#b10">00651</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderIv.html#b10">RenderIv::_UpdateBodies</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;qConfig)<font class="keyword">
</font>00652 <font class="keyword"></font>{
00653   <font class="keywordtype">int</font> index = 0;
00654   list&lt;SoTransform*&gt;::iterator pTrans;
00655   <a class="code" href="defs_h.html#a8">forall</a> (pTrans, _bodyTrans)<font class="keyword"> </font>{
00656     <a class="code" href="class_RenderIv.html#b9">_SetTransform</a>(*pTrans, qConfig[index], qConfig[index+1], qConfig[index+2], 
00657                   qConfig[index+3], qConfig[index+4], qConfig[index+5]);
00658     index += 6;
00659   }
00660   assert(index == qConfig.<a class="code" href="class_MSLVector.html#a8">dim</a>());
00661 }
00662 
00663 
</div></pre><HEAD>
<TITLE>Motion Strategy Library</TITLE>
</HEAD>

<p>

<hr>

Web page maintained by 
<a href="http://janowiec.cs.iastate.edu/~lavalle">Steve LaValle</a><br>

Partial support provided by NSF CAREER Award IRI-970228 (LaValle),
Honda Research, and Iowa State University.<br>

Contributors:  Anna Atramentov, Peng Cheng, James Kuffner, Steve LaValle, and Libo Yang.<br>
