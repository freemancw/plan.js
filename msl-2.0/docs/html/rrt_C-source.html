<HEAD>
<TITLE>Motion Strategy Library</TITLE>
</HEAD>

<body bgcolor="#ffffff">

<center><img src="msl.jpg"></center>

<p>


<!-- Generated by Doxygen 1.2.2 on Wed Aug 29 23:26:45 2001 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>rrt.C</h1><a href="rrt_C.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">//----------------------------------------------------------------------</font>
00002 <font class="comment">//               The Motion Strategy Library (MSL)</font>
00003 <font class="comment">//----------------------------------------------------------------------</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// Copyright (c) 1998-2000 Iowa State University and Steve LaValle.  </font>
00006 <font class="comment">// All Rights Reserved.</font>
00007 <font class="comment">// </font>
00008 <font class="comment">// Permission to use, copy, and distribute this software and its </font>
00009 <font class="comment">// documentation is hereby granted free of charge, provided that </font>
00010 <font class="comment">// (1) it is not a component of a commercial product, and </font>
00011 <font class="comment">// (2) this notice appears in all copies of the software and</font>
00012 <font class="comment">//     related documentation. </font>
00013 <font class="comment">// </font>
00014 <font class="comment">// Iowa State University and the author make no representations</font>
00015 <font class="comment">// about the suitability or fitness of this software for any purpose.  </font>
00016 <font class="comment">// It is provided "as is" without express or implied warranty.</font>
00017 <font class="comment">//----------------------------------------------------------------------</font>
00018 
00019 <font class="preprocessor">#include &lt;math.h&gt;</font>
00020 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00021 
00022 <font class="preprocessor">#include "<a class="code" href="rrt_h.html">rrt.h</a>"</font>
00023 <font class="preprocessor">#include "<a class="code" href="defs_h.html">defs.h</a>"</font>
00024 
00025 
00026 <font class="comment">// *********************************************************************</font>
00027 <font class="comment">// *********************************************************************</font>
00028 <font class="comment">// CLASS:     RRT base class</font>
00029 <font class="comment">// </font>
00030 <font class="comment">// *********************************************************************</font>
00031 <font class="comment">// *********************************************************************</font>
00032 
<a name="l00033"></a><a class="code" href="class_RRT.html#a0">00033</a> <a class="code" href="class_RRT.html#a0">RRT::RRT</a>(<a class="code" href="class_Problem.html">Problem</a> *problem): <a class="code" href="class_IncrementalPlanner.html">IncrementalPlanner</a>(problem) {
00034 
00035   UseANN = <font class="keyword">false</font>;
00036 
00037   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(ConnectTimeLimit,INFINITY);
00038 
00039   <a class="code" href="class_RRT.html#a2">Reset</a>();
00040 }
00041 
00042 
00043 
<a name="l00044"></a><a class="code" href="class_RRT.html#a2">00044</a> <font class="keywordtype">void</font> <a class="code" href="class_RRT.html#a2">RRT::Reset</a>()<font class="keyword"> </font>{
00045   <a class="code" href="class_Planner.html#a2">IncrementalPlanner::Reset</a>();
00046 
00047   NumNodes = 1000;
00048 
00049   SatisfiedCount = 0;
00050   GoalDist = P-&gt;Metric(P-&gt;InitialState,P-&gt;GoalState);
00051   BestState = P-&gt;InitialState;
00052 
00053 <font class="preprocessor">#ifdef USE_ANN
</font>00054 <font class="preprocessor"></font>  MAG = MultiANN(&amp;G);
00055   MAG2 = MultiANN(&amp;G2);
00056 <font class="preprocessor">#endif
</font>00057 <font class="preprocessor"></font>
00058 }
00059 
00060 
00061 <font class="comment">// Return the best new state in nx_best</font>
00062 <font class="comment">// success will be false if no action is collision free</font>
<a name="l00063"></a><a class="code" href="class_RRT.html#b0">00063</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_RRT.html#b0">RRT::SelectInput</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2, 
00064                            <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;nx_best, <font class="keywordtype">bool</font> &amp;success,
00065                            <font class="keywordtype">bool</font> forward = <font class="keyword">true</font>)<font class="keyword">
</font>00066 <font class="keyword"></font>{
00067   <a class="code" href="class_MSLVector.html">MSLVector</a> u_best,nx;
00068   list&lt;MSLVector&gt;::iterator u;
00069   <font class="keywordtype">double</font> d,d_min;
00070   success = <font class="keyword">false</font>;
00071   d_min = (forward) ? P-&gt;Metric(x1,x2) : P-&gt;Metric(x2,x1);
00072   list&lt;MSLVector&gt; il = P-&gt;GetInputs(x1);
00073 
00074   <font class="keywordflow">if</font> (Holonomic) { <font class="comment">// Just do interpolation</font>
00075     u_best = P-&gt;InterpolateState(x1,x2,0.1) - x1;
00076     u_best = u_best.<a class="code" href="class_MSLVector.html#a15">norm</a>(); <font class="comment">// Normalize the direction</font>
00077     nx_best = P-&gt;Integrate(x1,u_best,PlannerDeltaT);
00078     SatisfiedCount++;
00079     <font class="keywordflow">if</font> (P-&gt;Satisfied(nx_best))
00080       success = <font class="keyword">true</font>;
00081   }
00082   <font class="keywordflow">else</font> {  <font class="comment">// Nonholonomic (the more general case -- look at Inputs)</font>
00083     <a class="code" href="defs_h.html#a8">forall</a>(u,il)<font class="keyword"> </font>{
00084       <font class="keywordflow">if</font> (forward)
00085         nx = P-&gt;Integrate(x1,*u,PlannerDeltaT);
00086       <font class="keywordflow">else</font>
00087         nx = P-&gt;Integrate(x1,*u,-PlannerDeltaT);
00088       
00089       d  = (forward) ? P-&gt;Metric(nx,x2): P-&gt;Metric(x2,nx);
00090       
00091       SatisfiedCount++;
00092       
00093       <font class="keywordflow">if</font> ((d &lt; d_min)&amp;&amp;(x1 != nx)) { 
00094         <font class="keywordflow">if</font> (P-&gt;Satisfied(nx)) {
00095           d_min = d; u_best = *u; nx_best = nx; success = <font class="keyword">true</font>;
00096         }
00097       }
00098     }
00099   }
00100 
00101   <font class="comment">//cout &lt;&lt; "u_best: " &lt;&lt; u_best &lt;&lt; "\n";</font>
00102   <font class="comment">//cout &lt;&lt; "nx_best: " &lt;&lt; nx_best &lt;&lt; "\n";</font>
00103   <font class="comment">//cout &lt;&lt; "success: " &lt;&lt; success &lt;&lt; "\n";</font>
00104   <font class="comment">//success = true;</font>
00105 
00106   <font class="keywordflow">return</font> u_best;
00107 }
00108 
00109 
00110 
00111 
<a name="l00112"></a><a class="code" href="class_RRT.html#b1">00112</a> <a class="code" href="class_MSLNode.html">MSLNode</a>* <a class="code" href="class_RRT.html#b1">RRT::SelectNode</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <a class="code" href="class_MSLTree.html">MSLTree</a>* t,
00113                          <font class="keywordtype">bool</font> forward = <font class="keyword">true</font>)<font class="keyword"> </font>{
00114   <font class="keywordtype">double</font> d,d_min;
00115   <a class="code" href="class_MSLNode.html">MSLNode</a> *n_best;
00116   list&lt;MSLNode*&gt;::iterator n;
00117 
00118   d_min = INFINITY; d = 0.0;
00119 
00120 <font class="preprocessor">#ifdef USE_ANN
</font>00121 <font class="preprocessor"></font>  <font class="keywordflow">if</font> (!UseANN) {
00122 <font class="preprocessor">#endif
</font>00123 <font class="preprocessor"></font>    list&lt;MSLNode*&gt; nl;
00124     nl = t-&gt;<a class="code" href="class_MSLTree.html#a8">Nodes</a>();
00125     <a class="code" href="defs_h.html#a8">forall</a>(n,nl)<font class="keyword"> </font>{
00126       d = (forward) ? P-&gt;Metric((*n)-&gt;State(),x) : P-&gt;Metric(x,(*n)-&gt;State());
00127       <font class="keywordflow">if</font> (d &lt; d_min) {
00128         d_min = d; n_best = (*n); 
00129       }
00130     } 
00131 <font class="preprocessor">#ifdef USE_ANN
</font>00132 <font class="preprocessor"></font>  }
00133   <font class="keywordflow">else</font> {
00134     <font class="keywordflow">if</font> (&amp;g == &amp;G)
00135       n_best = MAG.SelectNode(x);
00136     <font class="keywordflow">else</font>
00137       n_best = MAG2.SelectNode(x);
00138   }
00139 <font class="preprocessor">#endif
</font>00140 <font class="preprocessor"></font>
00141   <font class="comment">//cout &lt;&lt; "n_best: " &lt;&lt; (*n_best) &lt;&lt; "\n";</font>
00142   
00143   <font class="keywordflow">return</font> n_best;
00144 }
00145 
00146 
00147 
<a name="l00148"></a><a class="code" href="class_RRT.html#b2">00148</a> <font class="keywordtype">bool</font> <a class="code" href="class_RRT.html#b2">RRT::Extend</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, 
00149                  <a class="code" href="class_MSLTree.html">MSLTree</a> *t,
00150                  <a class="code" href="class_MSLNode.html">MSLNode</a> *&amp;nn, <font class="keywordtype">bool</font> forward = <font class="keyword">true</font>)<font class="keyword"> </font>{
00151   <a class="code" href="class_MSLNode.html">MSLNode</a> *n_best;
00152   <a class="code" href="class_MSLVector.html">MSLVector</a> nx,u_best;
00153   <font class="keywordtype">bool</font> success;
00154   
00155   n_best = <a class="code" href="class_RRT.html#b1">SelectNode</a>(x,t,forward);
00156   u_best = <a class="code" href="class_RRT.html#b0">SelectInput</a>(n_best-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),x,nx,success,forward);
00157   <font class="comment">// nx gets next state</font>
00158   <font class="keywordflow">if</font> (success) {   <font class="comment">// If a collision-free input was found</font>
00159     <font class="comment">// Extend the tree</font>
00160     nn = t-&gt;<a class="code" href="class_MSLTree.html#a4">Extend</a>(n_best, nx, u_best, PlannerDeltaT);
00161 
00162     <font class="comment">//cout &lt;&lt; "n_best: " &lt;&lt; n_best &lt;&lt; "\n";</font>
00163     <font class="comment">//cout &lt;&lt; "New node: " &lt;&lt; nn &lt;&lt; "\n";</font>
00164   }
00165 
00166   <font class="keywordflow">return</font> success;
00167 }
00168 
00169 
00170 
00171 <font class="comment">// This function essentially iterates Extend until it has to stop</font>
00172 <font class="comment">// The same action is used for every iteration</font>
<a name="l00173"></a><a class="code" href="class_RRT.html#b3">00173</a> <font class="keywordtype">bool</font> <a class="code" href="class_RRT.html#b3">RRT::Connect</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, 
00174                   <a class="code" href="class_MSLTree.html">MSLTree</a> *t,
00175                   <a class="code" href="class_MSLNode.html">MSLNode</a> *&amp;nn, <font class="keywordtype">bool</font> forward = <font class="keyword">true</font>)<font class="keyword"> </font>{
00176   <a class="code" href="class_MSLNode.html">MSLNode</a> *nn_prev,*n_best;
00177   <a class="code" href="class_MSLVector.html">MSLVector</a> nx,nx_prev,u_best;
00178   <font class="keywordtype">bool</font> success;
00179   <font class="keywordtype">double</font> d,d_prev,clock;
00180   <font class="keywordtype">int</font> steps;
00181   
00182   n_best = <a class="code" href="class_RRT.html#b1">SelectNode</a>(x,t,forward);
00183   u_best = <a class="code" href="class_RRT.html#b0">SelectInput</a>(n_best-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),x,nx,success,forward); 
00184   steps = 0;
00185            <font class="comment">// nx gets next state</font>
00186   <font class="keywordflow">if</font> (success) {   <font class="comment">// If a collision-free input was found</font>
00187     d = P-&gt;Metric(nx,x); d_prev = d;
00188     nx_prev = nx; <font class="comment">// Initialize</font>
00189     nn = n_best;
00190     clock = PlannerDeltaT;
00191     <font class="keywordflow">while</font> ((P-&gt;Satisfied(nx))&amp;&amp;
00192            (clock &lt;= ConnectTimeLimit)&amp;&amp;
00193            (d &lt;= d_prev))
00194       {
00195         SatisfiedCount++;
00196         steps++; <font class="comment">// Number of steps made in connecting</font>
00197         nx_prev = nx;
00198         d_prev = d; nn_prev = nn;
00199         <font class="comment">// Uncomment line below to select best action each time</font>
00200         <font class="comment">//u_best = SelectInput(g.inf(nn),x,nx,success,forward); </font>
00201         <font class="keywordflow">if</font> (Holonomic) { 
00202             nx = P-&gt;Integrate(nx_prev,u_best,PlannerDeltaT);
00203         }
00204         <font class="keywordflow">else</font> { <font class="comment">// Nonholonomic</font>
00205           <font class="keywordflow">if</font> (forward)
00206             nx = P-&gt;Integrate(nx_prev,u_best,PlannerDeltaT);
00207           <font class="keywordflow">else</font>
00208             nx = P-&gt;Integrate(nx_prev,u_best,-PlannerDeltaT);
00209         }
00210         d = P-&gt;Metric(nx,x);
00211         clock += PlannerDeltaT;
00212         <font class="comment">// Uncomment the subsequent two lines to</font>
00213         <font class="comment">//   make each intermediate node added</font>
00214         <font class="comment">//nn = g.new_node(nx_prev); // Make a new node</font>
00215         <font class="comment">//g.new_edge(nn_prev,nn,u_best);</font>
00216       }
00217     nn = t-&gt;<a class="code" href="class_MSLTree.html#a4">Extend</a>(n_best, nx_prev, u_best, steps*PlannerDeltaT);
00218 
00219   }
00220 
00221   <font class="keywordflow">return</font> success;
00222 }
00223 
00224 
00225 
<a name="l00226"></a><a class="code" href="class_RRT.html#a3">00226</a> <font class="keywordtype">bool</font> <a class="code" href="class_RRT.html#a3">RRT::Plan</a>()<font class="keyword">
</font>00227 <font class="keyword"></font>{
00228   <font class="keywordtype">int</font> i;
00229   <font class="keywordtype">double</font> d;
00230   <a class="code" href="class_MSLNode.html">MSLNode</a> *n,*nn,*n_goal;
00231   <a class="code" href="class_MSLVector.html">MSLVector</a> nx,u_best;
00232   list&lt;MSLNode*&gt; path;
00233 
00234   <font class="comment">// Keep track of time</font>
00235   <font class="keywordtype">float</font> t = <a class="code" href="util_C.html#a0">used_time</a>();
00236 
00237   <font class="comment">// Make the root node of G</font>
00238   <font class="keywordflow">if</font> (!T)
00239     T = <font class="keyword">new</font> MSLTree(P-&gt;InitialState);
00240 
00241   nn = T-&gt;Root();
00242 
00243   i = 0;
00244   n = <a class="code" href="class_RRT.html#b1">SelectNode</a>(P-&gt;GoalState,T);
00245   n_goal = n;
00246 
00247   GoalDist = P-&gt;Metric(n-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),P-&gt;GoalState);
00248   <font class="keywordflow">while</font> ((i &lt; NumNodes)&amp;&amp;(!GapSatisfied(n_goal-&gt;State(),P-&gt;GoalState))) {
00249     <font class="keywordflow">if</font> (<a class="code" href="class_RRT.html#b2">Extend</a>(<a class="code" href="class_RRT.html#b4">ChooseState</a>(),T,nn)) { 
00250       d = P-&gt;Metric(nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),P-&gt;GoalState);
00251       <font class="keywordflow">if</font> (d &lt; GoalDist) {  <font class="comment">// Decrease if goal closer</font>
00252         GoalDist = d;
00253         BestState = nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>();
00254         n_goal = nn;
00255         <font class="comment">//cout &lt;&lt; "GoalDist " &lt;&lt; GoalDist &lt;&lt; "\n";</font>
00256       }
00257     }
00258     i++;
00259   }
00260 
00261   CumulativePlanningTime += ((<font class="keywordtype">double</font>)<a class="code" href="util_C.html#a0">used_time</a>(t));
00262   cout &lt;&lt; <font class="stringliteral">"Planning Time: "</font> &lt;&lt; CumulativePlanningTime &lt;&lt; <font class="stringliteral">"s\n"</font>; 
00263 
00264   <font class="comment">// Get the solution path</font>
00265   <font class="keywordflow">if</font> (<a class="code" href="class_Planner.html#a7">GapSatisfied</a>(n_goal-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),P-&gt;GoalState)) {
00266     cout &lt;&lt; <font class="stringliteral">"Success\n"</font>;
00267     path = T-&gt;PathToRoot(n_goal);
00268     path.reverse();
00269     <a class="code" href="class_IncrementalPlanner.html#a3">RecordSolution</a>(path); <font class="comment">// Write to Path and Policy</font>
00270     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00271   }
00272   <font class="keywordflow">else</font> {
00273     cout &lt;&lt; <font class="stringliteral">"Failure\n"</font>;
00274     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00275   }
00276 }
00277 
00278 
00279 
<a name="l00280"></a><a class="code" href="class_RRT.html#b4">00280</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_RRT.html#b4">RRT::ChooseState</a>()<font class="keyword"> </font>{
00281   <font class="keywordflow">return</font> <a class="code" href="class_Planner.html#b0">RandomState</a>();
00282 }
00283 
00284 
00285 
00286 
00287 <font class="comment">// *********************************************************************</font>
00288 <font class="comment">// *********************************************************************</font>
00289 <font class="comment">// CLASS:     RRTGoalBias</font>
00290 <font class="comment">//</font>
00291 <font class="comment">// Occasionally pick the goal state instead of a random sample. </font>
00292 <font class="comment">// *********************************************************************</font>
00293 <font class="comment">// *********************************************************************</font>
00294 
00295 
<a name="l00296"></a><a class="code" href="class_RRTGoalBias.html#a0">00296</a> <a class="code" href="class_RRTGoalBias.html#a0">RRTGoalBias::RRTGoalBias</a>(<a class="code" href="class_Problem.html">Problem</a> *p):<a class="code" href="class_RRT.html">RRT</a>(p) {
00297   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(GoalProb,0.05);
00298 }
00299 
00300 
00301 
<a name="l00302"></a><a class="code" href="class_RRTGoalBias.html#b0">00302</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_RRTGoalBias.html#b0">RRTGoalBias::ChooseState</a>()<font class="keyword">
</font>00303 <font class="keyword"></font>{
00304   <font class="keywordtype">double</font> rv;
00305 
00306   R &gt;&gt; rv;
00307   <font class="keywordflow">if</font> (rv &gt; GoalProb)
00308     <font class="keywordflow">return</font> <a class="code" href="class_Planner.html#b0">RandomState</a>();
00309   <font class="keywordflow">else</font>
00310     <font class="keywordflow">return</font> P-&gt;GoalState;
00311 }
00312 
00313 
00314 
00315 <font class="comment">// *********************************************************************</font>
00316 <font class="comment">// *********************************************************************</font>
00317 <font class="comment">// CLASS:     RRTCon</font>
00318 <font class="comment">// </font>
00319 <font class="comment">// Make the regular RRT greedy by attempting to connect all the way</font>
00320 <font class="comment">// to the random sample, or go as far as possible before colliding.</font>
00321 <font class="comment">// *********************************************************************</font>
00322 <font class="comment">// *********************************************************************</font>
00323 
00324 
00325 <font class="comment">// Build an RRT that tries to go as far as it can for each edge</font>
<a name="l00326"></a><a class="code" href="class_RRTCon.html#a0">00326</a> <a class="code" href="class_RRTCon.html#a0">RRTCon::RRTCon</a>(<a class="code" href="class_Problem.html">Problem</a> *p):<a class="code" href="class_RRTGoalBias.html">RRTGoalBias</a>(p) {
00327   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(GoalProb,0.0);
00328 }
00329 
00330 
00331 
00332 
<a name="l00333"></a><a class="code" href="class_RRTCon.html#a2">00333</a> <font class="keywordtype">bool</font> <a class="code" href="class_RRTCon.html#a2">RRTCon::Plan</a>()<font class="keyword">
</font>00334 <font class="keyword"></font>{
00335   <font class="keywordtype">int</font> i;
00336   <font class="keywordtype">double</font> d;
00337   <a class="code" href="class_MSLNode.html">MSLNode</a> *n,*nn,*n_goal;
00338   <a class="code" href="class_MSLVector.html">MSLVector</a> nx,u_best;
00339   list&lt;MSLNode*&gt; path;
00340 
00341   <font class="comment">// Keep track of time</font>
00342   <font class="keywordtype">float</font> t = <a class="code" href="util_C.html#a0">used_time</a>();
00343 
00344   <font class="comment">// Make the root node of G</font>
00345   <font class="keywordflow">if</font> (!T)
00346     T = <font class="keyword">new</font> MSLTree(P-&gt;InitialState);
00347 
00348 
00349   i = 0;
00350   n = <a class="code" href="class_RRT.html#b1">SelectNode</a>(P-&gt;GoalState,T);
00351   n_goal = n;
00352 
00353   GoalDist = P-&gt;Metric(n-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),P-&gt;GoalState);
00354   <font class="keywordflow">while</font> ((i &lt; NumNodes)&amp;&amp;(!GapSatisfied(n_goal-&gt;State(),P-&gt;GoalState))) {
00355     <font class="keywordflow">if</font> (<a class="code" href="class_RRT.html#b3">Connect</a>(<a class="code" href="class_RRTGoalBias.html#b0">ChooseState</a>(),T,nn)) { 
00356       d = P-&gt;Metric(nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),P-&gt;GoalState);
00357       <font class="keywordflow">if</font> (d &lt; GoalDist) {  <font class="comment">// Decrease if goal closer</font>
00358         GoalDist = d;
00359         BestState = nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>();
00360         n_goal = nn;
00361         <font class="comment">//cout &lt;&lt; "GoalDist " &lt;&lt; GoalDist &lt;&lt; "\n";</font>
00362       }
00363     }
00364     i++;
00365   }
00366 
00367   CumulativePlanningTime += ((<font class="keywordtype">double</font>)<a class="code" href="util_C.html#a0">used_time</a>(t));
00368   cout &lt;&lt; <font class="stringliteral">"Planning Time: "</font> &lt;&lt; CumulativePlanningTime &lt;&lt; <font class="stringliteral">"s\n"</font>; 
00369 
00370   <font class="comment">// Get the solution path</font>
00371   <font class="keywordflow">if</font> (<a class="code" href="class_Planner.html#a7">GapSatisfied</a>(n_goal-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),P-&gt;GoalState)) {
00372     cout &lt;&lt; <font class="stringliteral">"Successful Path Found\n"</font>;
00373     path = T-&gt;PathToRoot(n_goal);
00374     path.reverse();
00375     <a class="code" href="class_IncrementalPlanner.html#a3">RecordSolution</a>(path); <font class="comment">// Write to Path and Policy</font>
00376     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00377   }
00378   <font class="keywordflow">else</font> {
00379     cout &lt;&lt; <font class="stringliteral">"Failure to connect after "</font> &lt;&lt; 
00380       T-&gt;Size() &lt;&lt; <font class="stringliteral">" nodes\n"</font>;
00381     cout &lt;&lt; <font class="stringliteral">"Collision Detection Calls: "</font> &lt;&lt; SatisfiedCount &lt;&lt; <font class="stringliteral">"\n"</font>;
00382     
00383     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00384   }
00385 }
00386 
00387 
00388 <font class="comment">// *********************************************************************</font>
00389 <font class="comment">// *********************************************************************</font>
00390 <font class="comment">// CLASS:     RRTDual</font>
00391 <font class="comment">// </font>
00392 <font class="comment">// The dual-tree planner used in LaValle, Kuffner, ICRA 1999.  Each </font>
00393 <font class="comment">// tree is extended toward a randomly-sampled point.  RRTExtExt is</font>
00394 <font class="comment">// generally better.</font>
00395 <font class="comment">// *********************************************************************</font>
00396 <font class="comment">// *********************************************************************</font>
00397 
<a name="l00398"></a><a class="code" href="class_RRTDual.html#a0">00398</a> <a class="code" href="class_RRTDual.html#a0">RRTDual::RRTDual</a>(<a class="code" href="class_Problem.html">Problem</a> *p):<a class="code" href="class_RRT.html">RRT</a>(p) {
00399 }
00400 
00401 
<a name="l00402"></a><a class="code" href="class_RRTDual.html#b0">00402</a> <font class="keywordtype">void</font> <a class="code" href="class_RRTDual.html#b0">RRTDual::RecoverSolution</a>(<a class="code" href="class_MSLNode.html">MSLNode</a> *n1, <a class="code" href="class_MSLNode.html">MSLNode</a> *n2)<font class="keyword"> </font>{
00403   list&lt;MSLNode*&gt; path,path2;
00404 
00405   path = T-&gt;PathToRoot(n1);
00406   path.reverse();
00407 
00408   path2 = T2-&gt;PathToRoot(n2); 
00409   
00410   <font class="comment">//cout &lt;&lt; "Path: " &lt;&lt; path;</font>
00411   <font class="comment">//cout &lt;&lt; "Path2: " &lt;&lt; path2;</font>
00412 
00413   <a class="code" href="class_IncrementalPlanner.html#a3">RecordSolution</a>(path,path2); <font class="comment">// Write to Path and Policy</font>
00414 }
00415 
00416 
00417 
<a name="l00418"></a><a class="code" href="class_RRTDual.html#a2">00418</a> <font class="keywordtype">bool</font> <a class="code" href="class_RRTDual.html#a2">RRTDual::Plan</a>()<font class="keyword">
</font>00419 <font class="keyword"></font>{
00420   <font class="keywordtype">int</font> i;
00421   <a class="code" href="class_MSLVector.html">MSLVector</a> rx,u_best,nx;
00422   <a class="code" href="class_MSLNode.html">MSLNode</a> *nn,*nn2;
00423   <font class="keywordtype">bool</font> connected;
00424 
00425   connected = <font class="keyword">false</font>;
00426 
00427   <font class="keywordtype">float</font> t = <a class="code" href="util_C.html#a0">used_time</a>();
00428 
00429   <font class="comment">//int total = 0;</font>
00430   <font class="comment">//for (int j=0; j &lt; 100; j++) {</font>
00431 
00432   <font class="keywordflow">if</font> (!T)
00433     T = <font class="keyword">new</font> MSLTree(P-&gt;InitialState);
00434   <font class="keywordflow">if</font> (!T2)
00435     T2 = <font class="keyword">new</font> MSLTree(P-&gt;GoalState);
00436  
00437   nn = T-&gt;Root();
00438   nn2 = T2-&gt;Root();
00439 
00440   i = 0;
00441   connected = <font class="keyword">false</font>;
00442   <font class="keywordflow">while</font> ((i &lt; NumNodes) &amp;&amp; (!connected)) {
00443     rx = <a class="code" href="class_RRT.html#b4">ChooseState</a>();
00444     <a class="code" href="class_RRT.html#b2">Extend</a>(rx,T,nn);
00445     <a class="code" href="class_RRT.html#b2">Extend</a>(rx,T2,nn2,<font class="keyword">false</font>);  <font class="comment">// false means reverse-time integrate</font>
00446 
00447     <font class="keywordflow">if</font> (<a class="code" href="class_Planner.html#a7">GapSatisfied</a>(nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),nn2-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>())) {
00448       cout &lt;&lt; <font class="stringliteral">"CONNECTED!!  MSLNodes: "</font> &lt;&lt; 
00449         T-&gt;Size() + T2-&gt;Size() &lt;&lt; <font class="stringliteral">"\n"</font>;
00450       connected = <font class="keyword">true</font>;
00451       <a class="code" href="class_RRTDual.html#b0">RecoverSolution</a>(nn,nn2);
00452     }
00453 
00454     i++;
00455   }
00456   
00457   <font class="keywordflow">if</font> (!connected)
00458     cout &lt;&lt; <font class="stringliteral">"Failure to connect after "</font> &lt;&lt; 
00459       T-&gt;Size()+T2-&gt;Size() 
00460          &lt;&lt; <font class="stringliteral">" nodes\n"</font>;
00461   
00462   cout &lt;&lt; <font class="stringliteral">"Collision Detection Calls: "</font> &lt;&lt; SatisfiedCount &lt;&lt; <font class="stringliteral">"\n"</font>;
00463   
00464   <font class="comment">//total += i;</font>
00465   <font class="comment">// }</font>
00466   <font class="comment">//cout &lt;&lt; "Avg: " &lt;&lt; total/100 &lt;&lt; "\n";</font>
00467 
00468   CumulativePlanningTime += ((<font class="keywordtype">double</font>)<a class="code" href="util_C.html#a0">used_time</a>(t));
00469   cout &lt;&lt; <font class="stringliteral">"Planning Time: "</font> &lt;&lt; CumulativePlanningTime &lt;&lt; <font class="stringliteral">"s\n"</font>; 
00470   
00471   <font class="keywordflow">return</font> connected;
00472 }
00473 
00474 
00475 
00476 
00477 
00478 <font class="comment">// *********************************************************************</font>
00479 <font class="comment">// *********************************************************************</font>
00480 <font class="comment">// CLASS:     RRTExtExt</font>
00481 <font class="comment">// </font>
00482 <font class="comment">// A dual-tree planner in which computation is balanced between </font>
00483 <font class="comment">// exploring and connecting trees to each other.  Greedier verions</font>
00484 <font class="comment">// of this are RRTExtCon and RRTConCon.</font>
00485 <font class="comment">// *********************************************************************</font>
00486 <font class="comment">// *********************************************************************</font>
00487 
<a name="l00488"></a><a class="code" href="class_RRTExtExt.html#a0">00488</a> <a class="code" href="class_RRTExtExt.html#a0">RRTExtExt::RRTExtExt</a>(<a class="code" href="class_Problem.html">Problem</a> *p):<a class="code" href="class_RRTDual.html">RRTDual</a>(p) {
00489 }
00490 
00491 
<a name="l00492"></a><a class="code" href="class_RRTExtExt.html#a2">00492</a> <font class="keywordtype">bool</font> <a class="code" href="class_RRTExtExt.html#a2">RRTExtExt::Plan</a>()<font class="keyword">
</font>00493 <font class="keyword"></font>{
00494   <font class="keywordtype">int</font> i;
00495   <a class="code" href="class_MSLVector.html">MSLVector</a> u_best,nx,nx2;
00496   <a class="code" href="class_MSLNode.html">MSLNode</a> *nn,*nn2;
00497   <font class="keywordtype">bool</font> connected;
00498 
00499   connected = <font class="keyword">false</font>;
00500 
00501   <font class="keywordtype">float</font> t = <a class="code" href="util_C.html#a0">used_time</a>();
00502 
00503   <font class="comment">//int total = 0;</font>
00504   <font class="comment">//for (int j=0; j &lt; 100; j++) {</font>
00505   
00506   <font class="keywordflow">if</font> (!T)
00507     T = <font class="keyword">new</font> MSLTree(P-&gt;InitialState);
00508   <font class="keywordflow">if</font> (!T2)
00509     T2 = <font class="keyword">new</font> MSLTree(P-&gt;GoalState);
00510 
00511   nn = T-&gt;Root();
00512   nn2 = T2-&gt;Root();
00513 
00514   i = 0;
00515   connected = <font class="keyword">false</font>;
00516   <font class="keywordflow">while</font> ((i &lt; NumNodes) &amp;&amp; (!connected)) {
00517     <font class="keywordflow">if</font> (<a class="code" href="class_RRT.html#b2">Extend</a>(<a class="code" href="class_RRT.html#b4">ChooseState</a>(),T,nn)) {
00518       <font class="keywordflow">if</font> (<a class="code" href="class_RRT.html#b2">Extend</a>(nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),T2,nn2,<font class="keyword">false</font>)) {
00519         i++;
00520         <font class="keywordflow">if</font> (<a class="code" href="class_Planner.html#a7">GapSatisfied</a>(nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),nn2-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>())) {
00521           cout &lt;&lt; <font class="stringliteral">"CONNECTED!!  MSLNodes: "</font> &lt;&lt; 
00522             T-&gt;Size() + T2-&gt;Size() &lt;&lt; <font class="stringliteral">"\n"</font>;
00523           connected = <font class="keyword">true</font>;
00524           <a class="code" href="class_RRTDual.html#b0">RecoverSolution</a>(nn,nn2);
00525         }
00526       }
00527     }
00528     i++;
00529 
00530     <font class="keywordflow">if</font> ((!connected) &amp;&amp; (<a class="code" href="class_RRT.html#b2">Extend</a>(<a class="code" href="class_RRT.html#b4">ChooseState</a>(),T2,nn,<font class="keyword">false</font>))) {
00531       <font class="keywordflow">if</font> (<a class="code" href="class_RRT.html#b2">Extend</a>(nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),T,nn2)) {
00532         i++;
00533         <font class="keywordflow">if</font> (<a class="code" href="class_Planner.html#a7">GapSatisfied</a>(nn2-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>())) {
00534           cout &lt;&lt; <font class="stringliteral">"CONNECTED!!  MSLNodes: "</font> &lt;&lt; 
00535             T-&gt;Size() + T2-&gt;Size();
00536           connected = <font class="keyword">true</font>;
00537           <a class="code" href="class_RRTDual.html#b0">RecoverSolution</a>(nn2,nn);
00538         }
00539       }
00540     }
00541   }
00542 
00543   i++;
00544 
00545   <font class="keywordflow">if</font> (!connected)
00546     cout &lt;&lt; <font class="stringliteral">"Failure to connect after "</font> &lt;&lt; 
00547       T-&gt;Size() + T2-&gt;Size()
00548          &lt;&lt; <font class="stringliteral">" nodes\n"</font>;
00549 
00550   cout &lt;&lt; <font class="stringliteral">"Collision Detection Calls: "</font> &lt;&lt; SatisfiedCount &lt;&lt; <font class="stringliteral">"\n"</font>;
00551 
00552   <font class="comment">//total += i;</font>
00553   <font class="comment">// }</font>
00554   <font class="comment">//cout &lt;&lt; "Avg: " &lt;&lt; total/100 &lt;&lt; "\n";</font>
00555   
00556   CumulativePlanningTime += ((<font class="keywordtype">double</font>)<a class="code" href="util_C.html#a0">used_time</a>(t));
00557   cout &lt;&lt; <font class="stringliteral">"Planning Time: "</font> &lt;&lt; CumulativePlanningTime &lt;&lt; <font class="stringliteral">"s\n"</font>; 
00558 
00559   <font class="keywordflow">return</font> connected;
00560 }
00561 
00562 
00563 
00564 
00565 <font class="comment">// *********************************************************************</font>
00566 <font class="comment">// *********************************************************************</font>
00567 <font class="comment">// CLASS:     RRTGoalZoom</font>
00568 <font class="comment">// </font>
00569 <font class="comment">// Bias sampling towards a region that contains the goal.  The </font>
00570 <font class="comment">// region shrinks around the goal as the RRT comes nearer.  This</font>
00571 <font class="comment">// planner is based on a class project at Iowa State by Jun Qu in 1999.</font>
00572 <font class="comment">// *********************************************************************</font>
00573 <font class="comment">// *********************************************************************</font>
00574 
<a name="l00575"></a><a class="code" href="class_RRTGoalZoom.html#a0">00575</a> <a class="code" href="class_RRTGoalZoom.html#a0">RRTGoalZoom::RRTGoalZoom</a>(<a class="code" href="class_Problem.html">Problem</a> *p):<a class="code" href="class_RRT.html">RRT</a>(p) {
00576   GoalProb = 0.05;
00577   ZoomProb = 0.5;
00578   ZoomFactor = 2.0;
00579 }
00580 
00581 
00582 <font class="comment">// Zoom using a square box</font>
<a name="l00583"></a><a class="code" href="class_RRTGoalZoom.html#b0">00583</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_RRTGoalZoom.html#b0">RRTGoalZoom::ChooseState</a>()<font class="keyword">
</font>00584 <font class="keyword"></font>{
00585   <font class="keywordtype">double</font> rv,r,diff;
00586   <a class="code" href="class_MSLVector.html">MSLVector</a> zx;
00587   <font class="keywordtype">int</font> i;
00588 
00589   R &gt;&gt; rv;
00590   diff = 0.0;
00591   zx = P-&gt;LowerState;  <font class="comment">// Initialize to anything</font>
00592 
00593   <font class="keywordflow">if</font> (rv &lt; GoalProb)
00594     <font class="keywordflow">return</font> P-&gt;GoalState;
00595   <font class="keywordflow">else</font> {
00596     <font class="keywordflow">if</font> (rv &lt; (ZoomProb+GoalProb)) {
00597       <font class="keywordflow">for</font> (i = 0; i &lt; P-&gt;GoalState.dim(); i++) {
00598         <font class="keywordflow">if</font> (fabs(P-&gt;GoalState[i] - BestState[i]) &gt; diff)
00599           diff = fabs(P-&gt;GoalState[i] - BestState[i]);
00600       }
00601       <font class="keywordflow">for</font> (i = 0; i &lt; P-&gt;GoalState.dim(); i++) {
00602         R &gt;&gt; r;
00603         zx[i] += P-&gt;GoalState[i] - diff + 2.0*r*ZoomFactor*diff;
00604       }
00605       <font class="keywordflow">return</font> zx;
00606     }
00607     <font class="keywordflow">else</font>
00608       <font class="keywordflow">return</font> <a class="code" href="class_Planner.html#b0">RandomState</a>();
00609   }
00610   
00611 }
00612 
00613 
00614 <font class="comment">// *********************************************************************</font>
00615 <font class="comment">// *********************************************************************</font>
00616 <font class="comment">// CLASS:     RRTPolar</font>
00617 <font class="comment">// </font>
00618 <font class="comment">// Instead of random sampling, attempt to gradually bias samples</font>
00619 <font class="comment">// toward the goal.</font>
00620 <font class="comment">// *********************************************************************</font>
00621 <font class="comment">// *********************************************************************</font>
00622 
<a name="l00623"></a><a class="code" href="class_RRTPolar.html#a0">00623</a> <a class="code" href="class_RRTPolar.html#a0">RRTPolar::RRTPolar</a>(<a class="code" href="class_Problem.html">Problem</a> *p):<a class="code" href="class_RRT.html">RRT</a>(p) {
00624   <font class="comment">// RadiusExp = 1.0/(P-&gt;InitialState.dim() - 1);</font>
00625   RadiusExp = 1.0;
00626 }
00627 
00628 
00629 
00630 
00631 
00632 
00633 <font class="comment">// This implementation ignores C-space topology, VERY BAD!</font>
<a name="l00634"></a><a class="code" href="class_RRTPolar.html#b0">00634</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_RRTPolar.html#b0">RRTPolar::ChooseState</a>()<font class="keyword">
</font>00635 <font class="keyword"></font>{
00636   <font class="keywordtype">double</font> r,w;
00637   <a class="code" href="class_MSLVector.html">MSLVector</a> zx;
00638   <font class="keywordtype">int</font> i,j;
00639   <font class="keywordtype">bool</font> success;
00640   
00641   w = 0.0;
00642   zx = P-&gt;GoalState;  <font class="comment">// Initialize to anything</font>
00643 
00644   success = <font class="keyword">false</font>;
00645 
00646   <font class="keywordflow">while</font> (!success) {
00647     <font class="keywordflow">for</font> (i = 0; i &lt; P-&gt;GoalState.dim(); i++) {
00648       <font class="comment">// Generate sample from N(0,1)</font>
00649       zx[i] = 0.0;
00650       <font class="keywordflow">for</font> (j = 0; j &lt; 12; j++) {
00651         R &gt;&gt; r; zx[i] += r;
00652       }
00653       zx[i] -= 6.0;
00654       w += zx[i]*zx[i];
00655     }
00656     
00657     w = sqrt(w);
00658     
00659     <font class="comment">//cout &lt;&lt; "RadiusExp: " &lt;&lt; RadiusExp;</font>
00660     
00661     R &gt;&gt; r;  <font class="comment">// Radius</font>
00662     r = pow(r,RadiusExp);
00663     <font class="keywordflow">for</font> (i = 0; i &lt; P-&gt;GoalState.dim(); i++) {
00664       zx[i] = (P-&gt;UpperState[i] - P-&gt;LowerState[i])*
00665         sqrt(P-&gt;GoalState.dim())*r*zx[i]/w + 
00666         P-&gt;GoalState[i];
00667     }
00668     
00669     <font class="comment">// Check if sample is within bounds</font>
00670     success = <font class="keyword">true</font>;
00671     <font class="keywordflow">for</font> (i = 0; i &lt; P-&gt;GoalState.dim(); i++) {
00672       <font class="keywordflow">if</font> ((zx[i] &gt;= P-&gt;UpperState[i])||(zx[i] &lt;= P-&gt;LowerState[i]))
00673         success = <font class="keyword">false</font>;
00674     }
00675   }
00676 
00677   <font class="keywordflow">return</font> zx;
00678 }
00679 
00680 
00681 
<a name="l00682"></a><a class="code" href="class_RRTPolar.html#b1">00682</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_RRTPolar.html#b1">RRTPolar::SelectInput</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2, 
00683                                  <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;nx_best, <font class="keywordtype">bool</font> &amp;success)<font class="keyword">
</font>00684 <font class="keyword"></font>{
00685   <a class="code" href="class_MSLVector.html">MSLVector</a> u_best,nx;
00686   list&lt;MSLVector&gt;::iterator u;
00687   <font class="keywordtype">double</font> d,dg,dmax,d_min;
00688   success = <font class="keyword">false</font>;
00689   d_min = INFINITY;
00690   dg  = P-&gt;Metric(x1,x2);
00691   dmax  = P-&gt;Metric(P-&gt;LowerState,P-&gt;UpperState);
00692   list&lt;MSLVector&gt; il = P-&gt;GetInputs(x1);
00693   <a class="code" href="defs_h.html#a8">forall</a>(u,il)<font class="keyword"> </font>{
00694     <font class="comment">//nx = P-&gt;Integrate(x1,u,PlannerDeltaT*sqrt(dg/dmax));  // Slow down near goal</font>
00695     nx = P-&gt;Integrate(x1,*u,PlannerDeltaT);
00696     d  = P-&gt;Metric(nx,x2);
00697     <font class="keywordflow">if</font> ((d &lt; d_min)&amp;&amp;(P-&gt;Satisfied(nx))&amp;&amp;(x1 != nx)) 
00698       {
00699         d_min = d; u_best = *u; nx_best = nx; success = <font class="keyword">true</font>;
00700       }
00701   }
00702   
00703   <font class="comment">//cout &lt;&lt; "u_best: " &lt;&lt; u_best &lt;&lt; "\n");</font>
00704 
00705   <font class="keywordflow">return</font> u_best;
00706 }
00707 
00708 
00709 
00710 <font class="comment">// *********************************************************************</font>
00711 <font class="comment">// *********************************************************************</font>
00712 <font class="comment">// CLASS:     RRTHull</font>
00713 <font class="comment">// </font>
00714 <font class="comment">// A simple exploration of what happens to the RRT in a large disc.</font>
00715 <font class="comment">// Only works for 2DPoint model!!!!!</font>
00716 <font class="comment">// *********************************************************************</font>
00717 <font class="comment">// *********************************************************************</font>
00718 
<a name="l00719"></a><a class="code" href="class_RRTHull.html#a0">00719</a> <a class="code" href="class_RRTHull.html#a0">RRTHull::RRTHull</a>(<a class="code" href="class_Problem.html">Problem</a> *p):<a class="code" href="class_RRT.html">RRT</a>(p) {
00720   Radius = 100000000.0;
00721 }
00722 
00723 
00724 
<a name="l00725"></a><a class="code" href="class_RRTHull.html#b0">00725</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_RRTHull.html#b0">RRTHull::ChooseState</a>()<font class="keyword"> </font>{
00726   <font class="keywordtype">double</font> theta;
00727   <a class="code" href="class_MSLVector.html">MSLVector</a> v(2);
00728 
00729   R &gt;&gt; theta;  theta *= 2.0*PI;
00730 
00731   v[0] = Radius*cos(theta);
00732   v[1] = Radius*sin(theta);
00733 
00734   <font class="keywordflow">return</font> v;
00735 }
00736 
00737 
00738 
00739 <font class="comment">// *********************************************************************</font>
00740 <font class="comment">// *********************************************************************</font>
00741 <font class="comment">// CLASS:     RRTExtCon</font>
00742 <font class="comment">// </font>
00743 <font class="comment">// The planner presented in Kuffner, LaValle, 2000.  There are two</font>
00744 <font class="comment">// trees, and the attempt to connect them is greedy.</font>
00745 <font class="comment">// *********************************************************************</font>
00746 <font class="comment">// *********************************************************************</font>
00747 
<a name="l00748"></a><a class="code" href="class_RRTExtCon.html#a0">00748</a> <a class="code" href="class_RRTExtCon.html#a0">RRTExtCon::RRTExtCon</a>(<a class="code" href="class_Problem.html">Problem</a> *p):<a class="code" href="class_RRTDual.html">RRTDual</a>(p) {
00749 }
00750 
00751 
00752 
<a name="l00753"></a><a class="code" href="class_RRTExtCon.html#a2">00753</a> <font class="keywordtype">bool</font> <a class="code" href="class_RRTExtCon.html#a2">RRTExtCon::Plan</a>()<font class="keyword">
</font>00754 <font class="keyword"></font>{
00755   <font class="keywordtype">int</font> i;
00756   <a class="code" href="class_MSLVector.html">MSLVector</a> nx,nx_prev;
00757   <a class="code" href="class_MSLNode.html">MSLNode</a> *nn,*nn2;
00758   <font class="keywordtype">bool</font> connected;
00759 
00760   connected = <font class="keyword">false</font>;
00761 
00762   <font class="keywordtype">float</font> t = <a class="code" href="util_C.html#a0">used_time</a>();
00763 
00764   <font class="keywordflow">if</font> (!T)
00765     T = <font class="keyword">new</font> MSLTree(P-&gt;InitialState);
00766   <font class="keywordflow">if</font> (!T2)
00767     T2 = <font class="keyword">new</font> MSLTree(P-&gt;GoalState);
00768 
00769   nn = T-&gt;Root();
00770   nn2 = T2-&gt;Root();
00771 
00772   i = 0;
00773   connected = <font class="keyword">false</font>;
00774   <font class="keywordflow">while</font> ((i &lt; NumNodes) &amp;&amp; (!connected)) {
00775     <font class="keywordflow">if</font> (<a class="code" href="class_RRT.html#b2">Extend</a>(<a class="code" href="class_RRT.html#b4">ChooseState</a>(),T,nn)) { 
00776       <font class="comment">// Update the goal RRT</font>
00777       <font class="keywordflow">if</font> (<a class="code" href="class_RRT.html#b3">Connect</a>(nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),T2,nn2,<font class="keyword">false</font>)) {
00778         <font class="keywordflow">if</font> (<a class="code" href="class_Planner.html#a7">GapSatisfied</a>(nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),nn2-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>())) {
00779           cout &lt;&lt; <font class="stringliteral">"CONNECTED!!  MSLNodes: "</font> &lt;&lt; 
00780             T-&gt;Size() + T2-&gt;Size()
00781                &lt;&lt; <font class="stringliteral">"\n"</font>;
00782           connected = <font class="keyword">true</font>;
00783           <a class="code" href="class_RRTDual.html#b0">RecoverSolution</a>(nn,nn2);
00784         }
00785       }
00786     }
00787     i++;
00788 
00789     <font class="keywordflow">if</font> ((!connected)&amp;&amp;(<a class="code" href="class_RRT.html#b2">Extend</a>(<a class="code" href="class_RRT.html#b4">ChooseState</a>(),T2,nn,<font class="keyword">false</font>))) { 
00790       <font class="comment">// Update the initial RRT</font>
00791       <font class="keywordflow">if</font> (<a class="code" href="class_RRT.html#b3">Connect</a>(nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),T,nn2)) { 
00792         <font class="keywordflow">if</font> (<a class="code" href="class_Planner.html#a7">GapSatisfied</a>(nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),nn2-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>())) {
00793           cout &lt;&lt; <font class="stringliteral">"CONNECTED!!  MSLNodes: "</font> &lt;&lt; 
00794             T-&gt;Size() + T2-&gt;Size() &lt;&lt; <font class="stringliteral">"\n"</font>;
00795           connected = <font class="keyword">true</font>;
00796           <a class="code" href="class_RRTDual.html#b0">RecoverSolution</a>(nn2,nn);
00797         }
00798       }
00799     }
00800     i++;
00801   }
00802 
00803   <font class="keywordflow">if</font> (!connected)
00804     cout &lt;&lt; <font class="stringliteral">"Failure to connect after "</font> &lt;&lt; T-&gt;Size() + T2-&gt;Size()
00805          &lt;&lt; <font class="stringliteral">" nodes\n"</font>;
00806 
00807   cout &lt;&lt; <font class="stringliteral">"Collision Detection Calls: "</font> &lt;&lt; SatisfiedCount &lt;&lt; <font class="stringliteral">"\n"</font>;
00808 
00809   CumulativePlanningTime += ((<font class="keywordtype">double</font>)<a class="code" href="util_C.html#a0">used_time</a>(t));
00810   cout &lt;&lt; <font class="stringliteral">"Planning Time: "</font> &lt;&lt; CumulativePlanningTime &lt;&lt; <font class="stringliteral">"s\n"</font>; 
00811 
00812   <font class="keywordflow">return</font> connected;
00813 }
00814 
00815 
00816 
00817 <font class="comment">// *********************************************************************</font>
00818 <font class="comment">// *********************************************************************</font>
00819 <font class="comment">// CLASS:     RRTConCon</font>
00820 <font class="comment">// </font>
00821 <font class="comment">// One the best dual-tree planners.  Be greedy in growing the trees</font>
00822 <font class="comment">// and in trying to connect them to each other.  This is usually the</font>
00823 <font class="comment">// fastest planner, but there is often a price for being greedy...</font>
00824 <font class="comment">// *********************************************************************</font>
00825 <font class="comment">// *********************************************************************</font>
00826 
<a name="l00827"></a><a class="code" href="class_RRTConCon.html#a0">00827</a> <a class="code" href="class_RRTConCon.html#a0">RRTConCon::RRTConCon</a>(<a class="code" href="class_Problem.html">Problem</a> *p):<a class="code" href="class_RRTDual.html">RRTDual</a>(p) {
00828 }
00829 
00830 
00831 
<a name="l00832"></a><a class="code" href="class_RRTConCon.html#a2">00832</a> <font class="keywordtype">bool</font> <a class="code" href="class_RRTConCon.html#a2">RRTConCon::Plan</a>()<font class="keyword">
</font>00833 <font class="keyword"></font>{
00834   <font class="keywordtype">int</font> i;
00835   <a class="code" href="class_MSLVector.html">MSLVector</a> nx,nx_prev;
00836   <a class="code" href="class_MSLNode.html">MSLNode</a> *nn,*nn2;
00837   <font class="keywordtype">bool</font> connected;
00838 
00839   connected = <font class="keyword">false</font>;
00840 
00841   <font class="comment">// Keep track of time</font>
00842   <font class="keywordtype">float</font> t = <a class="code" href="util_C.html#a0">used_time</a>();
00843 
00844   <font class="keywordflow">if</font> (!T)
00845     T = <font class="keyword">new</font> MSLTree(P-&gt;InitialState);
00846   <font class="keywordflow">if</font> (!T2)
00847     T2 = <font class="keyword">new</font> MSLTree(P-&gt;GoalState);
00848  
00849   nn = T-&gt;Root();
00850   nn2 = T2-&gt;Root();
00851 
00852   i = 0;
00853   connected = <font class="keyword">false</font>;
00854 
00855   <font class="keywordflow">while</font> ((i &lt; NumNodes) &amp;&amp; (!connected)) {
00856     <font class="keywordflow">if</font> (<a class="code" href="class_RRT.html#b3">Connect</a>(<a class="code" href="class_RRT.html#b4">ChooseState</a>(),T,nn)) { 
00857       <font class="comment">// Update the goal RRT</font>
00858       <font class="comment">//cout &lt;&lt; "nn: " &lt;&lt; nn-&gt;State() &lt;&lt; "  nn2: " &lt;&lt; nn2-&gt;State() &lt;&lt; "\n";</font>
00859       <font class="keywordflow">if</font> (<a class="code" href="class_RRT.html#b3">Connect</a>(nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),T2,nn2,<font class="keyword">false</font>)) {
00860         <font class="keywordflow">if</font> (<a class="code" href="class_Planner.html#a7">GapSatisfied</a>(nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),nn2-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>())) {
00861           cout &lt;&lt; <font class="stringliteral">"CONNECTED!!  MSLNodes: "</font> &lt;&lt; 
00862             T-&gt;Size()+T2-&gt;Size() &lt;&lt; <font class="stringliteral">"\n"</font>;
00863           connected = <font class="keyword">true</font>;
00864           <a class="code" href="class_RRTDual.html#b0">RecoverSolution</a>(nn,nn2); <font class="comment">// Defined in RRTDual</font>
00865         }
00866       }
00867     }
00868     i++;
00869 
00870     <font class="keywordflow">if</font> ((!connected)&amp;&amp;(<a class="code" href="class_RRT.html#b3">Connect</a>(<a class="code" href="class_RRT.html#b4">ChooseState</a>(),T2,nn,<font class="keyword">false</font>))) { 
00871       <font class="comment">// Update the initial RRT</font>
00872       <font class="keywordflow">if</font> (<a class="code" href="class_RRT.html#b3">Connect</a>(nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),T,nn2)) { 
00873         <font class="keywordflow">if</font> (<a class="code" href="class_Planner.html#a7">GapSatisfied</a>(nn-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>(),nn2-&gt;<a class="code" href="class_MSLNode.html#a0">State</a>())) {
00874           cout &lt;&lt; <font class="stringliteral">"CONNECTED!!  MSLNodes: "</font> &lt;&lt; 
00875             T-&gt;Size()+T2-&gt;Size() &lt;&lt; <font class="stringliteral">"\n"</font>;
00876           connected = <font class="keyword">true</font>;
00877           <a class="code" href="class_RRTDual.html#b0">RecoverSolution</a>(nn2,nn);
00878         }
00879       }
00880     }
00881     i++;
00882   }
00883 
00884   <font class="keywordflow">if</font> (!connected)
00885     cout &lt;&lt; <font class="stringliteral">"Failure to connect after "</font> &lt;&lt; 
00886       T-&gt;Size()+T2-&gt;Size() &lt;&lt; <font class="stringliteral">" nodes\n"</font>;
00887 
00888   cout &lt;&lt; <font class="stringliteral">"Collision Detection Calls: "</font> &lt;&lt; SatisfiedCount &lt;&lt; <font class="stringliteral">"\n"</font>;
00889 
00890   CumulativePlanningTime += ((<font class="keywordtype">double</font>)<a class="code" href="util_C.html#a0">used_time</a>(t));
00891   cout &lt;&lt; <font class="stringliteral">"Planning Time: "</font> &lt;&lt; CumulativePlanningTime &lt;&lt; <font class="stringliteral">"s\n"</font>; 
00892 
00893   <font class="keywordflow">return</font> connected;
00894 }
00895 
00896 
00897 
00898 <font class="comment">// *********************************************************************</font>
00899 <font class="comment">// *********************************************************************</font>
00900 <font class="comment">// CLASS:     RandomTree</font>
00901 <font class="comment">// </font>
00902 <font class="comment">// Technically not an RRT.  Pick a vertex and input at random.</font>
00903 <font class="comment">// *********************************************************************</font>
00904 <font class="comment">// *********************************************************************</font>
00905 
<a name="l00906"></a><a class="code" href="class_RandomTree.html#a0">00906</a> <a class="code" href="class_RandomTree.html#a0">RandomTree::RandomTree</a>(<a class="code" href="class_Problem.html">Problem</a> *p):<a class="code" href="class_RRT.html">RRT</a>(p) {
00907 }
00908 
00909 
<a name="l00910"></a><a class="code" href="class_RandomTree.html#b0">00910</a> <a class="code" href="class_MSLNode.html">MSLNode</a>* <a class="code" href="class_RandomTree.html#b0">RandomTree::SelectNode</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <a class="code" href="class_MSLTree.html">MSLTree</a> *t,
00911                                 <font class="keywordtype">bool</font> forward = <font class="keyword">true</font>)<font class="keyword"> </font>{
00912   cout &lt;&lt; <font class="stringliteral">"WARNING: RESULT NOT CORRECT!!!\n"</font>;
00913   cout &lt;&lt; <font class="stringliteral">"NEED TO FIX RandomTree::SelectNode\n"</font>;
00914 
00915   <font class="comment">//return g.choose_node();</font>
00916   <font class="keywordflow">return</font> t-&gt;<a class="code" href="class_MSLTree.html#a9">Root</a>();
00917 }
00918 
00919 
<a name="l00920"></a><a class="code" href="class_RandomTree.html#b1">00920</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_RandomTree.html#b1">RandomTree::SelectInput</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2, 
00921                                   <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;nx_best, <font class="keywordtype">bool</font> &amp;success,
00922                                   <font class="keywordtype">bool</font> forward = <font class="keyword">true</font>)<font class="keyword"> </font>{
00923   <font class="keywordtype">double</font> r;
00924   list&lt;MSLVector&gt; il;
00925   <font class="keywordtype">int</font> k;
00926   <a class="code" href="class_MSLVector.html">MSLVector</a> u_best;
00927 
00928   il = P-&gt;GetInputs(x1);
00929   R &gt;&gt; r;
00930 
00931   k = (<font class="keywordtype">int</font>) (r * il.size());
00932 
00933   cout &lt;&lt; <font class="stringliteral">"WARNING: RESULT NOT CORRECT!!!\n"</font>;
00934   cout &lt;&lt; <font class="stringliteral">"NEED TO FIX RandomTree::SelectInput\n"</font>;
00935   <font class="comment">//u_best = il.inf(il[k]);</font>
00936   u_best = il.front();
00937 
00938   nx_best = P-&gt;Integrate(x1,u_best,PlannerDeltaT);
00939   SatisfiedCount++;
00940 
00941   <font class="keywordflow">return</font> u_best;
00942   
00943 }
00944 
00945 
00946 
00947 
00948 
00949 
00950 
00951 
</div></pre><HEAD>
<TITLE>Motion Strategy Library</TITLE>
</HEAD>

<p>

<hr>

Web page maintained by 
<a href="http://janowiec.cs.iastate.edu/~lavalle">Steve LaValle</a><br>

Partial support provided by NSF CAREER Award IRI-970228 (LaValle),
Honda Research, and Iowa State University.<br>

Contributors:  Anna Atramentov, Peng Cheng, James Kuffner, Steve LaValle, and Libo Yang.<br>
