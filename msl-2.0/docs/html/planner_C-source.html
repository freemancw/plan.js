<HEAD>
<TITLE>Motion Strategy Library</TITLE>
</HEAD>

<body bgcolor="#ffffff">

<center><img src="msl.jpg"></center>

<p>


<!-- Generated by Doxygen 1.2.2 on Wed Aug 29 23:26:44 2001 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>planner.C</h1><a href="planner_C.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">//----------------------------------------------------------------------</font>
00002 <font class="comment">//               The Motion Strategy Library (MSL)</font>
00003 <font class="comment">//----------------------------------------------------------------------</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// Copyright (c) 1998-2000 Iowa State University and Steve LaValle.  </font>
00006 <font class="comment">// All Rights Reserved.</font>
00007 <font class="comment">// </font>
00008 <font class="comment">// Permission to use, copy, and distribute this software and its </font>
00009 <font class="comment">// documentation is hereby granted free of charge, provided that </font>
00010 <font class="comment">// (1) it is not a component of a commercial product, and </font>
00011 <font class="comment">// (2) this notice appears in all copies of the software and</font>
00012 <font class="comment">//     related documentation. </font>
00013 <font class="comment">// </font>
00014 <font class="comment">// Iowa State University and the author make no representations</font>
00015 <font class="comment">// about the suitability or fitness of this software for any purpose.  </font>
00016 <font class="comment">// It is provided "as is" without express or implied warranty.</font>
00017 <font class="comment">//----------------------------------------------------------------------</font>
00018 
00019 <font class="preprocessor">#include &lt;math.h&gt;</font>
00020 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00021 
00022 <font class="preprocessor">#include "<a class="code" href="planner_h.html">planner.h</a>"</font>
00023 <font class="preprocessor">#include "<a class="code" href="defs_h.html">defs.h</a>"</font>
00024 
00025 
00026 <font class="comment">// *********************************************************************</font>
00027 <font class="comment">// *********************************************************************</font>
00028 <font class="comment">// CLASS:     Planner base class</font>
00029 <font class="comment">// </font>
00030 <font class="comment">// *********************************************************************</font>
00031 <font class="comment">// *********************************************************************</font>
00032 
<a name="l00033"></a><a class="code" href="class_Planner.html#a0">00033</a> <a class="code" href="class_Planner.html#a0">Planner::Planner</a>(<a class="code" href="class_Problem.html">Problem</a> *problem):<a class="code" href="class_Solver.html">Solver</a>(problem) {
00034   T = NULL;
00035   T2 = NULL;
00036   Roadmap = NULL;
00037   <a class="code" href="class_Planner.html#a2">Reset</a>();
00038 }
00039 
00040 
<a name="l00041"></a><a class="code" href="class_Planner.html#a1">00041</a> <a class="code" href="class_Planner.html#a1">Planner::~Planner</a>()<font class="keyword"> </font>{
00042   <a class="code" href="class_Planner.html#a2">Reset</a>();
00043 }
00044 
<a name="l00045"></a><a class="code" href="class_Planner.html#a2">00045</a> <font class="keywordtype">void</font> <a class="code" href="class_Planner.html#a2">Planner::Reset</a>()<font class="keyword"> </font>{
00046   <font class="keywordtype">int</font> i;
00047 
00048   NumNodes = 1000;
00049   std::ifstream fin;
00050 
00051   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(PlannerDeltaT,1.0);
00052 
00053   GapError = MSLVector(P-&gt;StateDim);
00054   <font class="keywordflow">for</font> (i = 0; i &lt; P-&gt;StateDim; i++)
00055     GapError[i] = 1.0;
00056   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(GapError);
00057 
00058   Path.clear();
00059   Policy.clear();
00060 
00061   fin.open((FilePath+<font class="stringliteral">"Holonomic"</font>).c_str());
00062   Holonomic = fin ? <font class="keyword">true</font> : <font class="keyword">false</font>; <font class="comment">// Nonholonomic by default</font>
00063   fin.close();
00064 
00065   CumulativePlanningTime = 0.0;
00066   CumulativeConstructTime = 0.0;
00067 
00068   <font class="keywordflow">if</font> (T)
00069     <font class="keyword">delete</font> T;
00070   <font class="keywordflow">if</font> (T2)
00071     <font class="keyword">delete</font> T2;
00072   T = NULL;
00073   T2 = NULL;
00074 
00075   <font class="keywordflow">if</font> (Roadmap)
00076     <font class="keyword">delete</font> Roadmap;
00077   Roadmap = NULL;
00078 }
00079 
00080 
<a name="l00081"></a><a class="code" href="class_Planner.html#b0">00081</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Planner.html#b0">Planner::RandomState</a>()<font class="keyword"> </font>{
00082   <font class="keywordtype">int</font> i;
00083   <font class="keywordtype">double</font> r;
00084   <a class="code" href="class_MSLVector.html">MSLVector</a> rx;
00085 
00086   rx = P-&gt;LowerState;
00087   <font class="keywordflow">for</font> (i = 0; i &lt; P-&gt;StateDim; i++) {
00088       R &gt;&gt; r; 
00089       rx[i] += r * (P-&gt;UpperState[i] - P-&gt;LowerState[i]);
00090     }
00091 
00092   <font class="keywordflow">return</font> rx;
00093 }
00094 
00095 
00096 
<a name="l00097"></a><a class="code" href="class_Planner.html#b1">00097</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Planner.html#b1">Planner::NormalState</a>(<a class="code" href="class_MSLVector.html">MSLVector</a> mean, <font class="keywordtype">double</font> sd = 0.5)<font class="keyword"> </font>{
00098   <font class="keywordtype">int</font> i,j;
00099   <font class="keywordtype">double</font> r;
00100   <a class="code" href="class_MSLVector.html">MSLVector</a> rx;
00101   <font class="keywordtype">bool</font> success = <font class="keyword">false</font>;
00102 
00103   rx = mean;
00104   <font class="keywordflow">for</font> (i = 0; i &lt; P-&gt;StateDim; i++) {
00105     success = <font class="keyword">false</font>;
00106     <font class="keywordflow">while</font> (!success) {
00107       rx[i] = 0.0;
00108       <font class="keywordflow">for</font> (j = 0; j &lt; 12; j++) {  <font class="comment">// Increase 12 here and below for more accuracy</font>
00109         R &gt;&gt; r; rx[i] += r;
00110       }
00111       rx[i] = (rx[i] - 12/2)*sd*(P-&gt;UpperState[i]-P-&gt;LowerState[i])+mean[i];
00112       <font class="keywordflow">if</font> ((rx[i] &lt;= P-&gt;UpperState[i])&amp;&amp;(rx[i] &gt;= P-&gt;LowerState[i]))
00113         success = <font class="keyword">true</font>;
00114     }
00115   }
00116 
00117   <font class="keywordflow">return</font> rx;
00118 }
00119 
00120 
00121 
<a name="l00122"></a><a class="code" href="class_Planner.html#a7">00122</a> <font class="keywordtype">bool</font> <a class="code" href="class_Planner.html#a7">Planner::GapSatisfied</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2)<font class="keyword"> </font>{
00123   <a class="code" href="class_MSLVector.html">MSLVector</a> x;
00124   <font class="keywordtype">int</font> i;
00125 
00126   x = P-&gt;StateDifference(x1,x2);
00127   <font class="keywordflow">for</font> (i = 0; i &lt; P-&gt;StateDim; i++) {
00128     <font class="keywordflow">if</font> (fabs(x[i]) &gt; GapError[i])
00129       <font class="keywordflow">return</font> <font class="keyword">false</font>;
00130   }
00131 
00132   <font class="keywordflow">return</font> <font class="keyword">true</font>;
00133 }
00134 
00135 
00136 
00137 <font class="comment">// *********************************************************************</font>
00138 <font class="comment">// *********************************************************************</font>
00139 <font class="comment">// CLASS:     IncrementalPlanner base class</font>
00140 <font class="comment">// </font>
00141 <font class="comment">// *********************************************************************</font>
00142 <font class="comment">// *********************************************************************</font>
00143 
<a name="l00144"></a><a class="code" href="class_IncrementalPlanner.html#a0">00144</a> <a class="code" href="class_IncrementalPlanner.html#a0">IncrementalPlanner::IncrementalPlanner</a>(<a class="code" href="class_Problem.html">Problem</a> *problem):<a class="code" href="class_Planner.html">Planner</a>(problem) {
00145 }
00146 
<a name="l00147"></a><a class="code" href="class_IncrementalPlanner.html#a2">00147</a> <font class="keywordtype">void</font> <a class="code" href="class_IncrementalPlanner.html#a2">IncrementalPlanner::Construct</a>()<font class="keyword"> </font>{
00148   cout &lt;&lt; <font class="stringliteral">"  Incremental planners do not use Construct.\n"</font>;
00149   cout &lt;&lt; <font class="stringliteral">"  Try Plan.\n"</font>;
00150 }
00151 
00152 
<a name="l00153"></a><a class="code" href="class_IncrementalPlanner.html#a3">00153</a> <font class="keywordtype">void</font> <a class="code" href="class_IncrementalPlanner.html#a3">IncrementalPlanner::RecordSolution</a>(<font class="keyword">const</font> list&lt;MSLNode*&gt; &amp;glist, 
00154                                         <font class="keyword">const</font> list&lt;MSLNode*&gt; &amp;g2list)<font class="keyword">
</font>00155 <font class="keyword"></font>{
00156   list&lt;MSLNode*&gt;::const_iterator n,nfirst,nlast;
00157   <font class="keywordtype">double</font> ptime;
00158 
00159   Path.clear();
00160   Policy.clear();
00161 
00162   ptime = 0.0; TimeList.clear();
00163   nfirst = glist.begin();
00164 
00165   <a class="code" href="defs_h.html#a8">forall</a>(n,glist)<font class="keyword"> </font>{
00166     Path.push_back((*n)-&gt;State());
00167     <font class="keywordflow">if</font> (n != nfirst) {
00168       Policy.push_back((*n)-&gt;Input());
00169     }
00170     ptime += (*n)-&gt;Time();
00171     TimeList.push_back(ptime);
00172   }
00173 
00174   <font class="comment">// The GapState is always comes from last node in glist</font>
00175   GapState = Path.back();
00176 
00177   <font class="comment">// Make a dummy input to get from GapState to the next state</font>
00178   Policy.push_back(P-&gt;GetInputs().front());
00179 
00180   <font class="keywordflow">if</font> (g2list.size() == 0) {
00181     <font class="comment">// Push the goal state onto the end (jumps the gap)</font>
00182     Path.push_back(P-&gt;GoalState);
00183   }
00184   <font class="keywordflow">else</font> { <font class="comment">// Using two graphs</font>
00185     ptime += PlannerDeltaT; <font class="comment">// Add a time step for the gap</font>
00186     nlast = g2list.end();
00187     <a class="code" href="defs_h.html#a8">forall</a>(n,g2list)<font class="keyword"> </font>{
00188       Path.push_back((*n)-&gt;State());
00189       <font class="keywordflow">if</font> (n != nlast) {
00190         Policy.push_back((*n)-&gt;Input());
00191       }
00192     TimeList.push_back(ptime);
00193     ptime += (*n)-&gt;Time();
00194     }
00195   }
00196 
00197   <font class="comment">//cout &lt;&lt; "Path: " &lt;&lt; Path &lt;&lt; "\n";</font>
00198   <font class="comment">//cout &lt;&lt; "Policy: " &lt;&lt; Policy &lt;&lt; "\n";</font>
00199   <font class="comment">//cout &lt;&lt; "TimeList: " &lt;&lt; TimeList &lt;&lt; "\n";</font>
00200 }
00201 
00202 
00203 
<a name="l00204"></a><a class="code" href="class_IncrementalPlanner.html#a4">00204</a> <font class="keywordtype">void</font> <a class="code" href="class_IncrementalPlanner.html#a3">IncrementalPlanner::RecordSolution</a>(<font class="keyword">const</font> list&lt;MSLNode*&gt; &amp;glist)<font class="keyword">
</font>00205 <font class="keyword"></font>{
00206   list&lt;MSLNode*&gt; emptylist;
00207   emptylist.clear(); <font class="comment">// Make sure it is clear</font>
00208 
00209   <a class="code" href="class_IncrementalPlanner.html#a3">RecordSolution</a>(glist,emptylist);
00210 }
00211 
00212 
00213 
<a name="l00214"></a><a class="code" href="class_IncrementalPlanner.html#a5">00214</a> <font class="keywordtype">void</font> <a class="code" href="class_IncrementalPlanner.html#a5">IncrementalPlanner::WriteGraphs</a>(ofstream &amp;fout)<font class="keyword">
</font>00215 <font class="keyword"></font>{
00216   <font class="keywordflow">if</font> (T)
00217     fout &lt;&lt; *T &lt;&lt; <font class="stringliteral">"\n\n\n"</font>;
00218   <font class="keywordflow">if</font> (T2)
00219     fout &lt;&lt; *T2;
00220 }
00221 
00222 
00223 
<a name="l00224"></a><a class="code" href="class_IncrementalPlanner.html#a6">00224</a> <font class="keywordtype">void</font> <a class="code" href="class_IncrementalPlanner.html#a6">IncrementalPlanner::ReadGraphs</a>(ifstream &amp;fin)<font class="keyword">
</font>00225 <font class="keyword"></font>{
00226   <font class="keywordflow">if</font> (T)
00227     <font class="keyword">delete</font> T;
00228   <font class="keywordflow">if</font> (T2)
00229     <font class="keyword">delete</font> T2;
00230 
00231   T = <font class="keyword">new</font> MSLTree();
00232   T2 = <font class="keyword">new</font> MSLTree();
00233 
00234   fin &gt;&gt; *T &gt;&gt; *T2;
00235 }
00236 
00237 
00238 
00239 
00240 <font class="comment">// *********************************************************************</font>
00241 <font class="comment">// *********************************************************************</font>
00242 <font class="comment">// CLASS:     RoadmapPlanner base class</font>
00243 <font class="comment">// </font>
00244 <font class="comment">// *********************************************************************</font>
00245 <font class="comment">// *********************************************************************</font>
00246 
<a name="l00247"></a><a class="code" href="class_RoadmapPlanner.html#a0">00247</a> <a class="code" href="class_RoadmapPlanner.html#a0">RoadmapPlanner::RoadmapPlanner</a>(<a class="code" href="class_Problem.html">Problem</a> *problem):<a class="code" href="class_Planner.html">Planner</a>(problem) {
00248 }
00249 
00250 
00251 
00252 
<a name="l00253"></a><a class="code" href="class_RoadmapPlanner.html#a2">00253</a> <font class="keywordtype">void</font> <a class="code" href="class_RoadmapPlanner.html#a2">RoadmapPlanner::WriteGraphs</a>(ofstream &amp;fout)<font class="keyword">
</font>00254 <font class="keyword"></font>{
00255   fout &lt;&lt; *Roadmap &lt;&lt; <font class="stringliteral">"\n\n\n"</font>;
00256 }
00257 
00258 
00259 
<a name="l00260"></a><a class="code" href="class_RoadmapPlanner.html#a3">00260</a> <font class="keywordtype">void</font> <a class="code" href="class_RoadmapPlanner.html#a3">RoadmapPlanner::ReadGraphs</a>(ifstream &amp;fin)<font class="keyword">
</font>00261 <font class="keyword"></font>{
00262   <font class="keywordflow">if</font> (Roadmap)
00263     <font class="keyword">delete</font> Roadmap;
00264 
00265   Roadmap = <font class="keyword">new</font> MSLGraph();
00266   fin &gt;&gt; *Roadmap;
00267 }
00268 
00269 
00270 
00271 
00272 
</div></pre><HEAD>
<TITLE>Motion Strategy Library</TITLE>
</HEAD>

<p>

<hr>

Web page maintained by 
<a href="http://janowiec.cs.iastate.edu/~lavalle">Steve LaValle</a><br>

Partial support provided by NSF CAREER Award IRI-970228 (LaValle),
Honda Research, and Iowa State University.<br>

Contributors:  Anna Atramentov, Peng Cheng, James Kuffner, Steve LaValle, and Libo Yang.<br>
