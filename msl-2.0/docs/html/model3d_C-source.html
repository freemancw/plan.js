<HEAD>
<TITLE>Motion Strategy Library</TITLE>
</HEAD>

<body bgcolor="#ffffff">

<center><img src="msl.jpg"></center>

<p>


<!-- Generated by Doxygen 1.2.2 on Wed Aug 29 23:26:44 2001 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>model3d.C</h1><a href="model3d_C.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">//----------------------------------------------------------------------</font>
00002 <font class="comment">//               The Motion Strategy Library (MSL)</font>
00003 <font class="comment">//----------------------------------------------------------------------</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// Copyright (c) 1998-2000 Iowa State University and Steve LaValle.  </font>
00006 <font class="comment">// All Rights Reserved.</font>
00007 <font class="comment">// </font>
00008 <font class="comment">// Permission to use, copy, and distribute this software and its </font>
00009 <font class="comment">// documentation is hereby granted free of charge, provided that </font>
00010 <font class="comment">// (1) it is not a component of a commercial product, and </font>
00011 <font class="comment">// (2) this notice appears in all copies of the software and</font>
00012 <font class="comment">//     related documentation. </font>
00013 <font class="comment">// </font>
00014 <font class="comment">// Iowa State University and the author make no representations</font>
00015 <font class="comment">// about the suitability or fitness of this software for any purpose.  </font>
00016 <font class="comment">// It is provided "as is" without express or implied warranty.</font>
00017 <font class="comment">//----------------------------------------------------------------------</font>
00018 
00019 <font class="preprocessor">#include &lt;fstream.h&gt;</font>
00020 <font class="preprocessor">#include &lt;math.h&gt;</font>
00021 
00022 <font class="preprocessor">#include "<a class="code" href="model3d_h.html">model3d.h</a>"</font>
00023 <font class="preprocessor">#include "<a class="code" href="defs_h.html">defs.h</a>"</font>
00024 
00025 
00026 <font class="comment">// *********************************************************************</font>
00027 <font class="comment">// *********************************************************************</font>
00028 <font class="comment">// CLASS:     Model3D</font>
00029 <font class="comment">// </font>
00030 <font class="comment">// *********************************************************************</font>
00031 <font class="comment">// *********************************************************************</font>
00032 
00033 
<a name="l00034"></a><a class="code" href="class_Model3D.html#a0">00034</a> <a class="code" href="class_Model3D.html#a0">Model3D::Model3D</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model.html">Model</a>(path) {
00035 }
00036 
00037 
00038 
00039 <font class="comment">// *********************************************************************</font>
00040 <font class="comment">// *********************************************************************</font>
00041 <font class="comment">// CLASS:     Model3DRigid</font>
00042 <font class="comment">// </font>
00043 <font class="comment">// *********************************************************************</font>
00044 <font class="comment">// *********************************************************************</font>
00045 
00046 
00047 <font class="comment">// Constructor</font>
<a name="l00048"></a><a class="code" href="class_Model3DRigid.html#a0">00048</a> <a class="code" href="class_Model3DRigid.html#a0">Model3DRigid::Model3DRigid</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model3D.html">Model3D</a>(path) {
00049   <a class="code" href="class_MSLVector.html">MSLVector</a> u;
00050 
00051   StateDim = 6;
00052   InputDim = 6;
00053 
00054   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(LowerState,MSLVector(StateDim));
00055   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(UpperState,MSLVector(StateDim));
00056 
00057   <font class="comment">// Make inputs</font>
00058   Inputs.clear();
00059   u = MSLVector(6);
00060   u[0] = 1.0; u[1] = 0.0; u[2] = 0.0; u[3] = 0.0; u[4] = 0.0; u[5] = 0.0;
00061   Inputs.push_back(u);
00062 
00063   u = MSLVector(6);
00064   u[0] = -1.0; u[1] = 0.0; u[2] = 0.0; u[3] = 0.0; u[4] = 0.0; u[5] = 0.0;
00065   Inputs.push_back(u);
00066 
00067   u = MSLVector(6);
00068   u[0] = 0.0; u[1] = 1.0; u[2] = 0.0; u[3] = 0.0; u[4] = 0.0; u[5] = 0.0;
00069   Inputs.push_back(u);
00070 
00071   u = MSLVector(6);
00072   u[0] = 0.0; u[1] = -1.0; u[2] = 0.0; u[3] = 0.0; u[4] = 0.0; u[5] = 0.0;
00073   Inputs.push_back(u);
00074 
00075   u = MSLVector(6);
00076   u[0] = 0.0; u[1] = 0.0; u[2] = 1.0; u[3] = 0.0; u[4] = 0.0; u[5] = 0.0;
00077   Inputs.push_back(u);
00078 
00079   u = MSLVector(6);
00080   u[0] = 0.0; u[1] = 0.0; u[2] = -1.0; u[3] = 0.15; u[4] = 0.0; u[5] = 0.0;
00081   Inputs.push_back(u);
00082 
00083   u = MSLVector(6);
00084   u[0] = 0.0; u[1] = 0.0; u[2] = -1.0; u[3] = -0.15; u[4] = 0.0; u[5] = 0.0;
00085   Inputs.push_back(u);
00086 
00087   u = MSLVector(6);
00088   u[0] = 0.0; u[1] = 0.0; u[2] = 0.0; u[3] = 0.0; u[4] = 0.15; u[5] = 0.0;
00089   Inputs.push_back(u);
00090 
00091   u = MSLVector(6);
00092   u[0] = 0.0; u[1] = 0.0; u[2] = 0.0; u[3] = 0.0; u[4] = -0.15; u[5] = 0.0;
00093   Inputs.push_back(u);
00094 
00095   u = MSLVector(6);
00096   u[0] = 0.0; u[1] = 0.0; u[2] = 0.0; u[3] = 0.0; u[4] = 0.0; u[5] = 0.15;
00097   Inputs.push_back(u);
00098 
00099   u = MSLVector(6);
00100   u[0] = 0.0; u[1] = 0.0; u[2] = 0.0; u[3] = 0.0; u[4] = 0.0; u[5] = -0.15;
00101   Inputs.push_back(u);
00102 }
00103 
00104 
<a name="l00105"></a><a class="code" href="class_Model3DRigid.html#a3">00105</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model3DRigid.html#a3">Model3DRigid::StateTransitionEquation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u)<font class="keyword"> </font>{
00106 
00107   <a class="code" href="class_MSLVector.html">MSLVector</a> dx;
00108 
00109   dx = u;
00110 
00111   <font class="keywordflow">return</font> dx;
00112 }
00113 
00114 
00115 
<a name="l00116"></a><a class="code" href="class_Model3DRigid.html#a4">00116</a> <font class="keywordtype">double</font> <a class="code" href="class_Model3DRigid.html#a4">Model3DRigid::Metric</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2)<font class="keyword"> </font>{
00117 
00118   <font class="keywordtype">double</font> fd;
00119 
00120   fd = fabs(x1[3]-x2[3]);
00121   <font class="keywordtype">double</font> dtheta1 = <a class="code" href="defs_h.html#a3">min</a>(fd,2.0*PI - fd);
00122   fd = fabs(x1[4]-x2[4]);
00123   <font class="keywordtype">double</font> dtheta2 = <a class="code" href="defs_h.html#a3">min</a>(fd,2.0*PI - fd);
00124   fd = fabs(x1[5]-x2[5]);
00125   <font class="keywordtype">double</font> dtheta3 = <a class="code" href="defs_h.html#a3">min</a>(fd,2.0*PI - fd);
00126 
00127   <font class="keywordflow">return</font> sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(x1[0] - x2[0]) + <a class="code" href="defs_h.html#a2">sqr</a>(x1[1] - x2[1]) + <a class="code" href="defs_h.html#a2">sqr</a>(x1[2] - x2[2]) +
00128               <a class="code" href="defs_h.html#a2">sqr</a>(50.0/PI*dtheta1) + <a class="code" href="defs_h.html#a2">sqr</a>(50.0/PI*dtheta2) +
00129               <a class="code" href="defs_h.html#a2">sqr</a>(50.0/PI*dtheta3));
00130   <font class="comment">//  return sqrt(sqr(x1[0] - x2[0]) + sqr(x1[1] - x2[1]) + sqr(x1[2] - x2[2]) +</font>
00131   <font class="comment">//          sqr(dtheta1) + sqr(dtheta2) +</font>
00132   <font class="comment">//          sqr(dtheta3));</font>
00133 }
00134 
00135 
<a name="l00136"></a><a class="code" href="class_Model3DRigid.html#a2">00136</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model3DRigid.html#a2">Model3DRigid::Integrate</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u, <font class="keyword">const</font> <font class="keywordtype">double</font> &amp;h)<font class="keyword">
</font>00137 <font class="keyword"></font>{
00138   <font class="keywordflow">return</font> <a class="code" href="class_Model.html#b1">EulerIntegrate</a>(x,u,h);
00139 }
00140 
00141 
<a name="l00142"></a><a class="code" href="class_Model3DRigid.html#a5">00142</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model3DRigid.html#a5">Model3DRigid::LinearInterpolate</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2, <font class="keyword">const</font> <font class="keywordtype">double</font> &amp;a)<font class="keyword"></font>{
00143   <a class="code" href="class_MSLVector.html">MSLVector</a> v;
00144 
00145   v = (1.0-a)*x1 + a*x2;
00146 
00147   <font class="keywordflow">if</font> (fabs(x2[3] - x1[3]) &gt; PI) {
00148     <font class="keywordflow">if</font> (x1[3] &gt; x2[3])
00149       v[3] = (1.0-a)*x1[3] + a*(x2[3]+2.0*PI);
00150     <font class="keywordflow">else</font>
00151       v[3] = (1.0-a)*(x1[3]+2.0*PI) + a*x2[3];
00152   }
00153 
00154   <font class="keywordflow">if</font> (v[3] &gt; PI)
00155     v[3] -= 2.0*PI;
00156 
00157   <font class="keywordflow">if</font> (fabs(x2[4] - x1[4]) &gt; PI) {
00158     <font class="keywordflow">if</font> (x1[4] &gt; x2[4])
00159       v[4] = (1.0-a)*x1[4] + a*(x2[4]+2.0*PI);
00160     <font class="keywordflow">else</font>
00161       v[4] = (1.0-a)*(x1[4]+2.0*PI) + a*x2[4];
00162   }
00163 
00164   <font class="keywordflow">if</font> (v[4] &gt; PI)
00165     v[4] -= 2.0*PI;
00166 
00167   <font class="keywordflow">if</font> (fabs(x2[5] - x1[5]) &gt; PI) {
00168     <font class="keywordflow">if</font> (x1[5] &gt; x2[5])
00169       v[5] = (1.0-a)*x1[5] + a*(x2[5]+2.0*PI);
00170     <font class="keywordflow">else</font>
00171       v[5] = (1.0-a)*(x1[5]+2.0*PI) + a*x2[5];
00172   }
00173 
00174   <font class="keywordflow">if</font> (v[5] &gt; PI)
00175     v[5] -= 2.0*PI;
00176 
00177 
00178   <font class="keywordflow">return</font> v;
00179 
00180 }
00181 
00182 
00183 
00184 
00185 
00186 <font class="comment">// *********************************************************************</font>
00187 <font class="comment">// *********************************************************************</font>
00188 <font class="comment">// CLASS:     Model3DRigidMulti</font>
00189 <font class="comment">// </font>
00190 <font class="comment">// *********************************************************************</font>
00191 <font class="comment">// *********************************************************************</font>
00192 
00193 
00194 <font class="comment">// Constructor</font>
<a name="l00195"></a><a class="code" href="class_Model3DRigidMulti.html#a0">00195</a> <a class="code" href="class_Model3DRigidMulti.html#a0">Model3DRigidMulti::Model3DRigidMulti</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model3DRigid.html">Model3DRigid</a>(path) {
00196   <a class="code" href="class_MSLVector.html">MSLVector</a> u;
00197   <font class="keywordtype">int</font> i,j;
00198 
00199   <a class="code" href="defs_h.html#a7">READ_PARAMETER_OR_ERROR</a>(NumBodies);
00200 
00201   StateDim = 6*NumBodies;
00202   InputDim = 6*NumBodies;
00203 
00204   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(LowerState,MSLVector(StateDim));
00205   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(UpperState,MSLVector(StateDim));
00206 
00207   u = MSLVector(StateDim);
00208   Inputs.clear();
00209   <font class="keywordflow">for</font> (i = 0; i &lt; StateDim; i++) {
00210     <font class="keywordflow">for</font> (j = 0; j &lt; StateDim; j++)
00211       u[j] = (i==j) ? 1.0 : 0.0; 
00212     Inputs.push_back(u);
00213     <font class="keywordflow">for</font> (j = 0; j &lt; StateDim; j++)
00214       u[j] = (i==j) ? -1.0 : 0.0; 
00215     Inputs.push_back(u);
00216   }
00217 }
00218 
00219 
00220 
00221 
<a name="l00222"></a><a class="code" href="class_Model3DRigidMulti.html#a2">00222</a> <font class="keywordtype">double</font> <a class="code" href="class_Model3DRigidMulti.html#a2">Model3DRigidMulti::Metric</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2)<font class="keyword"> </font>{
00223 
00224   <font class="keywordtype">double</font> d,fd,dtheta1,dtheta2,dtheta3;
00225   <font class="keywordtype">int</font> i;
00226 
00227   d = 0.0;
00228 
00229   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {
00230     fd = fabs(x1[6*i+3]-x2[6*i+3]);
00231     dtheta1 = <a class="code" href="defs_h.html#a3">min</a>(fd,2.0*PI - fd);
00232     fd = fabs(x1[6*i+4]-x2[6*i+4]);
00233     dtheta2 = <a class="code" href="defs_h.html#a3">min</a>(fd,2.0*PI - fd);
00234     fd = fabs(x1[6*i+5]-x2[6*i+5]);
00235     dtheta3 = <a class="code" href="defs_h.html#a3">min</a>(fd,2.0*PI - fd);
00236     d += <a class="code" href="defs_h.html#a2">sqr</a>(x1[6*i] - x2[6*i]);
00237     d += <a class="code" href="defs_h.html#a2">sqr</a>(x1[6*i+1] - x2[6*i+1]);
00238     d += <a class="code" href="defs_h.html#a2">sqr</a>(x1[6*i+2] - x2[6*i+2]);
00239     d += <a class="code" href="defs_h.html#a2">sqr</a>(dtheta1);
00240     d += <a class="code" href="defs_h.html#a2">sqr</a>(dtheta2);
00241     d += <a class="code" href="defs_h.html#a2">sqr</a>(dtheta3);
00242   }
00243 
00244   <font class="keywordflow">return</font> sqrt(d);
00245 }
00246 
00247 
00248 
<a name="l00249"></a><a class="code" href="class_Model3DRigidMulti.html#a3">00249</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model3DRigidMulti.html#a3">Model3DRigidMulti::LinearInterpolate</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2, <font class="keyword">const</font> <font class="keywordtype">double</font> &amp;a)<font class="keyword"></font>{
00250   <a class="code" href="class_MSLVector.html">MSLVector</a> v;
00251   <font class="keywordtype">int</font> i;
00252 
00253   v = (1.0-a)*x1 + a*x2;
00254 
00255   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {
00256     <font class="keywordflow">if</font> (fabs(x2[6*i+3] - x1[6*i+3]) &gt; PI) {
00257       <font class="keywordflow">if</font> (x1[6*i+3] &gt; x2[6*i+3])
00258         v[6*i+3] = (1.0-a)*x1[6*i+3] + a*(x2[6*i+3]+2.0*PI);
00259       <font class="keywordflow">else</font>
00260         v[6*i+3] = (1.0-a)*(x1[6*i+3]+2.0*PI) + a*x2[6*i+3];
00261     }
00262     
00263     <font class="keywordflow">if</font> (v[6*i+3] &gt; PI)
00264       v[6*i+3] -= 2.0*PI;
00265     
00266     <font class="keywordflow">if</font> (fabs(x2[6*i+4] - x1[6*i+4]) &gt; PI) {
00267       <font class="keywordflow">if</font> (x1[6*i+4] &gt; x2[6*i+4])
00268         v[6*i+4] = (1.0-a)*x1[6*i+4] + a*(x2[6*i+4]+2.0*PI);
00269       <font class="keywordflow">else</font>
00270         v[6*i+4] = (1.0-a)*(x1[6*i+4]+2.0*PI) + a*x2[6*i+4];
00271     }
00272     
00273     <font class="keywordflow">if</font> (v[6*i+4] &gt; PI)
00274       v[6*i+4] -= 2.0*PI;
00275     
00276     <font class="keywordflow">if</font> (fabs(x2[6*i+5] - x1[6*i+5]) &gt; PI) {
00277       <font class="keywordflow">if</font> (x1[6*i+5] &gt; x2[6*i+5])
00278         v[6*i+5] = (1.0-a)*x1[6*i+5] + a*(x2[6*i+5]+2.0*PI);
00279       <font class="keywordflow">else</font>
00280         v[6*i+5] = (1.0-a)*(x1[6*i+5]+2.0*PI) + a*x2[6*i+5];
00281     }
00282     
00283     <font class="keywordflow">if</font> (v[6*i+5] &gt; PI)
00284       v[6*i+5] -= 2.0*PI;
00285   }
00286 
00287   <font class="keywordflow">return</font> v;
00288 
00289 }
00290 
00291 
00292 
00293 
00294 <font class="comment">// *********************************************************************</font>
00295 <font class="comment">// *********************************************************************</font>
00296 <font class="comment">// CLASS:     Model3DRigidChain</font>
00297 <font class="comment">// A 3D kinematic chain of bodies</font>
00298 <font class="comment">//  </font>
00299 <font class="comment">// *********************************************************************</font>
00300 <font class="comment">// *********************************************************************</font>
00301 
<a name="l00302"></a><a class="code" href="class_Model3DRigidChain.html#a0">00302</a> <a class="code" href="class_Model3DRigidChain.html#a0">Model3DRigidChain::Model3DRigidChain</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model3DRigid.html">Model3DRigid</a>(path) {
00303 
00304   <font class="keywordtype">int</font> i;
00305   <a class="code" href="class_MSLVector.html">MSLVector</a> u;
00306   std::ifstream fin;
00307   
00308   <a class="code" href="defs_h.html#a7">READ_PARAMETER_OR_ERROR</a>(NumBodies);
00309   <a class="code" href="defs_h.html#a7">READ_PARAMETER_OR_ERROR</a>(StateDim);
00310   <a class="code" href="defs_h.html#a7">READ_PARAMETER_OR_ERROR</a>(DH);
00311 
00312   InputDim = StateDim; 
00313 
00314   StateIndices = vector&lt;int&gt;(StateDim);
00315   fin.open((FilePath + <font class="stringliteral">"StateIndices"</font>).c_str());
00316   <font class="keywordflow">if</font> (fin) {
00317     <font class="keywordflow">for</font> (i = 0; i &lt; StateDim; i++) {
00318       fin &gt;&gt; StateIndices[i];
00319     }
00320   }
00321   <font class="keywordflow">else</font> {
00322     cout &lt;&lt; <font class="stringliteral">"Error: No StateIndices file was found\n"</font>;
00323     exit(-1);
00324   }
00325   fin.close();
00326 
00327   LowerState = MSLVector(StateDim);
00328   UpperState = MSLVector(StateDim);
00329 
00330   <font class="keywordflow">for</font> (i = 0; i &lt; StateDim; i++)
00331     LowerState[i] = -1.0;
00332   <font class="keywordflow">for</font> (i = 0; i &lt; StateDim; i++) 
00333     UpperState[i] = 1.0;
00334 
00335   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(LowerState);
00336   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(UpperState);
00337 
00338   Inputs.clear();  <font class="comment">// Otherwise its parent constructor will make some inputs</font>
00339   <font class="keywordflow">for</font> (i = 0; i &lt; StateDim; i++) {
00340     u = MSLVector(StateDim);
00341     u[i] = 0.1;
00342     Inputs.push_back(u);
00343     u = MSLVector(StateDim);
00344     u[i] = -0.1;
00345     Inputs.push_back(u);
00346   }    
00347 
00348   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(Inputs);
00349 }
00350 
00351 
00352 
<a name="l00353"></a><a class="code" href="class_Model3DRigidChain.html#a3">00353</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model3DRigidChain.html#a3">Model3DRigidChain::StateToConfiguration</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> </font>{
00354   <a class="code" href="class_MSLVector.html">MSLVector</a> q;
00355   <a class="code" href="class_MSLVector.html">MSLVector</a> A, Alpha, D, Theta;
00356   <font class="keywordtype">int</font> i;
00357   <a class="code" href="class_MSLMatrix.html">MSLMatrix</a> r(4,4), rn(4,4), ro(4,4);
00358 
00359   q = MSLVector(6*NumBodies);
00360   A = MSLVector(NumBodies);
00361   D = MSLVector(NumBodies);
00362   Alpha = MSLVector(NumBodies);
00363   Theta = MSLVector(NumBodies);
00364 
00365   <font class="keywordflow">for</font> (i = 0; i &lt; StateDim; i++ ) {
00366     <font class="keywordflow">if</font> (StateIndices[i] != 0) {
00367       <font class="keywordtype">int</font> y = StateIndices[i];
00368       DH[y-1] = x[i];
00369     }
00370   } 
00371  
00372   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {
00373        Alpha[i] = DH[i];
00374        Theta[i] = DH[NumBodies*1+i];
00375        A[i] = DH[NumBodies*2+i];
00376        D[i] = DH[NumBodies*3+i];
00377   }
00378 
00379   <font class="keywordflow">for</font> (i = 0; i &lt; 4 ; i ++ ) {
00380     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j = 0 ; j &lt; 4 ; j ++ ) {
00381       <font class="keywordflow">if</font> (i==j) {r[i][j] = 1.0;}
00382       <font class="keywordflow">else</font> {r[i][j] = 0.0;}
00383     }
00384   }
00385   
00386   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {
00387     ro=r;
00388     rn[0][0] = cos(Theta[i]);
00389     rn[0][1] = -sin(Theta[i]);
00390     rn[0][2] = 0.0;
00391     rn[0][3] = A[i];
00392     rn[1][2] = -sin(Alpha[i]);
00393     rn[2][2] = cos(Alpha[i]);
00394     rn[3][2] = 0.0;
00395     rn[1][3] = rn[1][2]*D[i];
00396     rn[2][3] = rn[2][2]*D[i];
00397     rn[3][3] = 1.0;
00398     rn[1][0] = -rn[0][1]*rn[2][2];
00399     rn[2][0] = -rn[0][1]*(-rn[1][2]);
00400     rn[3][0] = 0.0;
00401     rn[1][1] = rn[0][0]*rn[2][2];
00402     rn[2][1] = rn[0][0]*(-rn[1][2]);
00403     rn[3][1] = 0.0;
00404   
00405     <font class="comment">//R = R*Rnew</font>
00406     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> k=0; k&lt;4; k++){
00407       <font class="keywordflow">for</font> (<font class="keywordtype">int</font> l=0; l&lt;4; l++) {
00408         r[k][l]=0.0 ;
00409         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> m=0; m&lt;4; m++){
00410           r[k][l]+=ro[k][m]*rn[m][l];
00411         }
00412       }
00413     }
00414 
00415     q[6*i] = r[0][3];
00416     q[6*i+1] = r[1][3];
00417     q[6*i+2] = r[2][3];
00418 
00419     q[6*i+4] = atan2(  -r[2][0], sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(r[0][0])+<a class="code" href="defs_h.html#a2">sqr</a>(r[1][0]))  );
00420     <font class="keywordflow">if</font> ( (q[6*i+4]&gt;0.0) &amp;&amp; (cos(q[6*i+4])==0.0) ) {
00421       q[6*i+5] = 0.0;
00422       q[6*i+3] = atan2(r[0][1], r[1][1]);
00423     }  
00424     <font class="keywordflow">else</font> {
00425       <font class="keywordflow">if</font> ( (q[6*i+4]&lt;0.0) &amp;&amp; (cos(q[6*i+4])==0.0) ) {
00426         q[6*i+5] = 0.0;
00427         q[6*i+3] = -atan2(r[0][1], r[1][1]);
00428       }
00429       <font class="keywordflow">else</font> {
00430         q[6*i+5] = atan2(  r[1][0]/cos(q[6*i+4]), r[0][0]/cos(q[6*i+4])  );
00431         q[6*i+3] = atan2(  r[2][1]/cos(q[6*i+4]), r[2][2]/cos(q[6*i+4])  );
00432       }
00433     }
00434     <font class="keywordflow">if</font> (q[6*i+3] &lt; 0.0)
00435       q[6*i+3] += 2.0*PI; <font class="comment">// Force the orientation into [0,2pi)</font>
00436     <font class="keywordflow">if</font> (q[6*i+4] &lt; 0.0)
00437       q[6*i+4] += 2.0*PI; <font class="comment">// Force the orientation into [0,2pi)</font>
00438     <font class="keywordflow">if</font> (q[6*i+5] &lt; 0.0)
00439       q[6*i+5] += 2.0*PI; <font class="comment">// Force the orientation into [0,2pi)</font>
00440   }
00441 
00442   <font class="keywordflow">return</font> q;
00443 }
00444 
00445 
00446 
<a name="l00447"></a><a class="code" href="class_Model3DRigidChain.html#a4">00447</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model3DRigidChain.html#a4">Model3DRigidChain::LinearInterpolate</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, 
00448                                             <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2, 
00449                                             <font class="keyword">const</font> <font class="keywordtype">double</font> &amp;a)<font class="keyword"> </font>{
00450   <font class="keywordflow">return</font> (1.0-a)*x1 + a*x2;
00451 }
00452 
00453 
<a name="l00454"></a><a class="code" href="class_Model3DRigidChain.html#a2">00454</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model3DRigidChain.html#a2">Model3DRigidChain::StateTransitionEquation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u)<font class="keyword"> </font>{
00455 
00456   <a class="code" href="class_MSLVector.html">MSLVector</a> dx(StateDim);
00457 
00458   dx = u;
00459   <font class="keywordflow">return</font> dx;
00460 }
00461 
00462 
00463 
<a name="l00464"></a><a class="code" href="class_Model3DRigidChain.html#a5">00464</a> <font class="keywordtype">double</font> <a class="code" href="class_Model3DRigidChain.html#a5">Model3DRigidChain::Metric</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2)<font class="keyword"> </font>{
00465 
00466   <font class="keywordtype">double</font> rho;
00467   <a class="code" href="class_MSLVector.html">MSLVector</a> dtheta(StateDim);
00468   <font class="keywordtype">int</font> i;
00469   
00470   rho = 0.0;
00471   <font class="keywordflow">for</font> ( i= 0 ; i &lt; StateDim; i++){
00472     <font class="keywordflow">if</font> (StateIndices[i] &gt; 2*NumBodies) { 
00473       rho += <a class="code" href="defs_h.html#a2">sqr</a>(x1[i] - x2[i]);
00474     }
00475     <font class="keywordflow">else</font> { 
00476       dtheta[i] = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[i]-x2[i]),2.0*PI - fabs(x1[i]-x2[i]));
00477       rho += <a class="code" href="defs_h.html#a2">sqr</a>(10.0/PI*dtheta[i]);
00478     }
00479   }
00480   rho = sqrt(rho);
00481 
00482   <font class="keywordflow">return</font> rho;
00483 }
00484 
00485 
00486 <font class="comment">// Make sure the joint position and limits are respected</font>
<a name="l00487"></a><a class="code" href="class_Model3DRigidChain.html#a6">00487</a> <font class="keywordtype">bool</font> <a class="code" href="class_Model3DRigidChain.html#a6">Model3DRigidChain::Satisfied</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> 
</font>00488 <font class="keyword"></font>{
00489   <font class="keywordtype">int</font> i;
00490 
00491   <font class="keywordflow">for</font> (i = 0; i &lt; StateDim; i++)
00492     <font class="keywordflow">if</font> ((x[i] &gt; UpperState[i]) || (x[i] &lt; LowerState[i]))
00493       <font class="keywordflow">return</font> <font class="keyword">false</font>;
00494 
00495   <font class="keywordflow">return</font> <font class="keyword">true</font>;
00496 }
00497 
00498 
00499 <font class="comment">// *********************************************************************</font>
00500 <font class="comment">// *********************************************************************</font>
00501 <font class="comment">// CLASS:     Model3DRigidChainTree</font>
00502 <font class="comment">// A 3D kinematic tree of bodies</font>
00503 <font class="comment">//  </font>
00504 <font class="comment">// *********************************************************************</font>
00505 <font class="comment">// *********************************************************************</font>
00506 
<a name="l00507"></a><a class="code" href="class_Model3DRigidTree.html#a0">00507</a> <a class="code" href="class_Model3DRigidTree.html#a0">Model3DRigidTree::Model3DRigidTree</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model3DRigid.html">Model3DRigid</a>(path) {
00508 
00509   <font class="keywordtype">int</font> i;
00510   <a class="code" href="class_MSLVector.html">MSLVector</a> u;
00511   std::ifstream fin;
00512 
00513   <a class="code" href="defs_h.html#a7">READ_PARAMETER_OR_ERROR</a>(NumBodies);
00514   <a class="code" href="defs_h.html#a7">READ_PARAMETER_OR_ERROR</a>(StateDim);
00515   <a class="code" href="defs_h.html#a7">READ_PARAMETER_OR_ERROR</a>(DH);
00516 
00517   InputDim = StateDim; 
00518 
00519   StateIndices = vector&lt;int&gt;(StateDim);
00520   fin.open((FilePath + <font class="stringliteral">"StateIndices"</font>).c_str());
00521   <font class="keywordflow">if</font> (fin) {
00522     <font class="keywordflow">for</font> (i = 0; i &lt; StateDim; i++) {
00523       fin &gt;&gt; StateIndices[i];
00524     }
00525   }
00526   <font class="keywordflow">else</font> {
00527     cout &lt;&lt; <font class="stringliteral">"Error: No StateIndices file was found\n"</font>;
00528     exit(-1);
00529   }
00530   fin.close();
00531 
00532 
00533   Parents = vector&lt;int&gt;(NumBodies);
00534   fin.open((FilePath + <font class="stringliteral">"Parents"</font>).c_str());
00535   <font class="keywordflow">if</font> (fin) {
00536     <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {
00537       fin &gt;&gt; Parents[i];
00538     }
00539   }
00540   <font class="keywordflow">else</font> {
00541     cout &lt;&lt; <font class="stringliteral">"Error: No Parents file was found\n"</font>;
00542     exit(-1);
00543   }
00544   fin.close();
00545 
00546 
00547   <font class="keywordflow">for</font> (i = 1; i &lt; NumBodies; i++) {
00548     <font class="keywordflow">if</font> (Parents[i] &gt;= i) { 
00549       cout &lt;&lt; <font class="stringliteral">"There is a mistake in Parents\n"</font>;
00550       exit(-1);
00551     }
00552   }
00553 
00554   LowerState = MSLVector(StateDim);
00555   UpperState = MSLVector(StateDim);
00556 
00557   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(LowerState);
00558   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(UpperState);
00559 
00560   Inputs.clear();  <font class="comment">// Otherwise its parent constructor will make some inputs</font>
00561   <font class="keywordflow">for</font> (i = 0; i &lt; StateDim; i++) {
00562     u = MSLVector(StateDim);
00563     u[i] = 0.1;
00564     Inputs.push_back(u);
00565     u = MSLVector(StateDim);
00566     u[i] = -0.1;
00567     Inputs.push_back(u);
00568   }    
00569 
00570   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(Inputs);
00571 }
00572 
00573 
00574 
<a name="l00575"></a><a class="code" href="class_Model3DRigidTree.html#a3">00575</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model3DRigidTree.html#a3">Model3DRigidTree::StateToConfiguration</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> </font>{
00576   <a class="code" href="class_MSLVector.html">MSLVector</a> q;
00577   <a class="code" href="class_MSLVector.html">MSLVector</a> A, Alpha, D, Theta;
00578   <font class="keywordtype">int</font> i;
00579   <a class="code" href="class_MSLMatrix.html">MSLMatrix</a> r(4,4), rn(4,4), ro(4,4);
00580 
00581   <a class="code" href="class_MSLMatrix.html">MSLMatrix</a> Tr[NumBodies];
00582 
00583   q = MSLVector(6*NumBodies);
00584   A = MSLVector(NumBodies);
00585   D = MSLVector(NumBodies);
00586   Alpha = MSLVector(NumBodies);
00587   Theta = MSLVector(NumBodies);
00588 
00589   <font class="keywordflow">for</font> (i = 0; i &lt; StateDim; i++ ) {
00590     <font class="keywordflow">if</font> (StateIndices[i] != 0) {
00591       <font class="keywordtype">int</font> y = StateIndices[i];
00592       DH[y-1] = x[i];
00593     }
00594   } 
00595  
00596   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++){
00597        Alpha[i] = DH[i];
00598        Theta[i] = DH[NumBodies*1+i];
00599        A[i] = DH[NumBodies*2+i];
00600        D[i] = DH[NumBodies*3+i];
00601   }
00602 
00603   <font class="keywordflow">for</font> (i = 0; i &lt; 4 ; i ++ ) {
00604     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> j = 0 ; j &lt; 4 ; j ++ ) {
00605       <font class="keywordflow">if</font> (i==j) {
00606         r[i][j] = 1.0;
00607       }
00608       <font class="keywordflow">else</font> {
00609         r[i][j] = 0.0;
00610       }
00611     }
00612   }
00613   ro = r;
00614 
00615   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++ ) {
00616 
00617     <font class="keywordtype">int</font> ParInd = Parents[i];
00618 
00619     rn[0][0] = cos(Theta[i]);
00620     rn[0][1] = -sin(Theta[i]);
00621     rn[0][2] = 0.0;
00622     rn[0][3] = A[i];
00623     rn[1][2] = -sin(Alpha[i]);
00624     rn[2][2] = cos(Alpha[i]);
00625     rn[3][2] = 0.0;
00626     rn[1][3] = rn[1][2]*D[i];
00627     rn[2][3] = rn[2][2]*D[i];
00628     rn[3][3] = 1.0;
00629     rn[1][0] = -rn[0][1]*rn[2][2];
00630     rn[2][0] = -rn[0][1]*(-rn[1][2]);
00631     rn[3][0] = 0.0;
00632     rn[1][1] = rn[0][0]*rn[2][2];
00633     rn[2][1] = rn[0][0]*(-rn[1][2]);
00634     rn[3][1] = 0.0;
00635   
00636     <font class="comment">//R = R*Rnew</font>
00637 
00638     <font class="keywordflow">if</font> (i != 0) { ro = Tr[ParInd];}
00639 
00640     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> k=0; k&lt;4; k++){
00641       <font class="keywordflow">for</font> (<font class="keywordtype">int</font> l=0; l&lt;4; l++) {
00642         r[k][l]=0.0 ;
00643         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> m=0; m&lt;4; m++){
00644             r[k][l]+=ro[k][m]*rn[m][l];
00645 
00646         }
00647       }
00648     }
00649 
00650     Tr[i] = r;
00651 
00652     <font class="comment">//Finding State coordinates</font>
00653     
00654     q[6*i] = r[0][3];
00655     q[6*i+1] = r[1][3];
00656     q[6*i+2] = r[2][3];
00657 
00658     q[6*i+4] = atan2(  -r[2][0], sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(r[0][0])+<a class="code" href="defs_h.html#a2">sqr</a>(r[1][0]))  );
00659     <font class="keywordflow">if</font> ( (q[6*i+4]&gt;0.0) &amp;&amp; (cos(q[6*i+4])==0.0) ) {
00660       q[6*i+5] = 0.0;
00661       q[6*i+3] = atan2(r[0][1], r[1][1]);
00662     }  
00663     <font class="keywordflow">else</font>{
00664       <font class="keywordflow">if</font> ( (q[6*i+4]&lt;0.0) &amp;&amp; (cos(q[6*i+4])==0.0) ) {
00665         q[6*i+5] = 0.0;
00666         q[6*i+3] = -atan2(r[0][1], r[1][1]);
00667       }
00668       <font class="keywordflow">else</font> {
00669         q[6*i+5] = atan2(  r[1][0]/cos(q[6*i+4]), r[0][0]/cos(q[6*i+4])  );
00670         q[6*i+3] = atan2(  r[2][1]/cos(q[6*i+4]), r[2][2]/cos(q[6*i+4])  );
00671       }
00672     }
00673     <font class="keywordflow">if</font> (q[6*i+3] &lt; 0.0)
00674       q[6*i+3] += 2.0*PI; <font class="comment">// Force the orientation into [0,2pi)</font>
00675     <font class="keywordflow">if</font> (q[6*i+4] &lt; 0.0)
00676       q[6*i+4] += 2.0*PI; <font class="comment">// Force the orientation into [0,2pi)</font>
00677     <font class="keywordflow">if</font> (q[6*i+5] &lt; 0.0)
00678       q[6*i+5] += 2.0*PI; <font class="comment">// Force the orientation into [0,2pi)</font>
00679   }
00680   <font class="keywordflow">return</font> q;
00681 }
00682 
00683 
00684 
<a name="l00685"></a><a class="code" href="class_Model3DRigidTree.html#a4">00685</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model3DRigidTree.html#a4">Model3DRigidTree::LinearInterpolate</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, 
00686                                             <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2, 
00687                                             <font class="keyword">const</font> <font class="keywordtype">double</font> &amp;a)<font class="keyword"> </font>{
00688   <font class="keywordflow">return</font> (1.0-a)*x1 + a*x2;
00689 }
00690 
00691 
<a name="l00692"></a><a class="code" href="class_Model3DRigidTree.html#a2">00692</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model3DRigidTree.html#a2">Model3DRigidTree::StateTransitionEquation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u)<font class="keyword"> </font>{
00693 
00694   <a class="code" href="class_MSLVector.html">MSLVector</a> dx(StateDim);
00695 
00696   dx = u;
00697   <font class="keywordflow">return</font> dx;
00698 }
00699 
00700 
00701 
<a name="l00702"></a><a class="code" href="class_Model3DRigidTree.html#a5">00702</a> <font class="keywordtype">double</font> <a class="code" href="class_Model3DRigidTree.html#a5">Model3DRigidTree::Metric</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2)<font class="keyword"> </font>{
00703 
00704   <font class="keywordtype">double</font> rho;
00705   <a class="code" href="class_MSLVector.html">MSLVector</a> dtheta(StateDim);
00706   <font class="keywordtype">int</font> i;
00707   
00708   rho = 0.0;
00709   <font class="keywordflow">for</font> (i = 0 ; i &lt; StateDim; i++){
00710     <font class="keywordflow">if</font> (StateIndices[i] &gt; 2*NumBodies) {
00711       rho += <a class="code" href="defs_h.html#a2">sqr</a>(x1[i] - x2[i]);
00712     }
00713     <font class="keywordflow">else</font> { 
00714       dtheta[i] = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[i]-x2[i]),2.0*PI - fabs(x1[i]-x2[i]));
00715       rho += <a class="code" href="defs_h.html#a2">sqr</a>(10.0/PI*dtheta[i]);
00716     }
00717   }
00718   rho = sqrt(rho);
00719 
00720   <font class="keywordflow">return</font> rho;
00721 }
00722 
00723 
00724 <font class="comment">// Make sure the joint position and limits are respected</font>
<a name="l00725"></a><a class="code" href="class_Model3DRigidTree.html#a6">00725</a> <font class="keywordtype">bool</font> <a class="code" href="class_Model3DRigidTree.html#a6">Model3DRigidTree::Satisfied</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> 
</font>00726 <font class="keyword"></font>{
00727   <font class="keywordtype">int</font> i;
00728 
00729   <font class="keywordflow">for</font> (i = 0; i &lt; StateDim; i++)
00730     <font class="keywordflow">if</font> ((x[i] &gt; UpperState[i]) || (x[i] &lt; LowerState[i]))
00731       <font class="keywordflow">return</font> <font class="keyword">false</font>;
00732 
00733   <font class="keywordflow">return</font> <font class="keyword">true</font>;
00734 }
</div></pre><HEAD>
<TITLE>Motion Strategy Library</TITLE>
</HEAD>

<p>

<hr>

Web page maintained by 
<a href="http://janowiec.cs.iastate.edu/~lavalle">Steve LaValle</a><br>

Partial support provided by NSF CAREER Award IRI-970228 (LaValle),
Honda Research, and Iowa State University.<br>

Contributors:  Anna Atramentov, Peng Cheng, James Kuffner, Steve LaValle, and Libo Yang.<br>
