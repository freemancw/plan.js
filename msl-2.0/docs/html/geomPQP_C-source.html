<HEAD>
<TITLE>Motion Strategy Library</TITLE>
</HEAD>

<body bgcolor="#ffffff">

<center><img src="msl.jpg"></center>

<p>


<!-- Generated by Doxygen 1.2.2 on Wed Aug 29 23:26:43 2001 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>geomPQP.C</h1><a href="geomPQP_C.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">//----------------------------------------------------------------------</font>
00002 <font class="comment">//               The Motion Strategy Library (MSL)</font>
00003 <font class="comment">//----------------------------------------------------------------------</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// Copyright (c) 1998-2000 Iowa State University and Steve LaValle.  </font>
00006 <font class="comment">// All Rights Reserved.</font>
00007 <font class="comment">// </font>
00008 <font class="comment">// Permission to use, copy, and distribute this software and its </font>
00009 <font class="comment">// documentation is hereby granted free of charge, provided that </font>
00010 <font class="comment">// (1) it is not a component of a commercial product, and </font>
00011 <font class="comment">// (2) this notice appears in all copies of the software and</font>
00012 <font class="comment">//     related documentation. </font>
00013 <font class="comment">// </font>
00014 <font class="comment">// Iowa State University and the author make no representations</font>
00015 <font class="comment">// about the suitability or fitness of this software for any purpose.  </font>
00016 <font class="comment">// It is provided "as is" without express or implied warranty.</font>
00017 <font class="comment">//----------------------------------------------------------------------</font>
00018 
00019 <font class="preprocessor">#include &lt;fstream.h&gt;</font>
00020 <font class="preprocessor">#include &lt;math.h&gt;</font>
00021 
00022 <font class="preprocessor">#include "<a class="code" href="geomPQP_h.html">geomPQP.h</a>"</font>
00023 <font class="preprocessor">#include "<a class="code" href="defs_h.html">defs.h</a>"</font>
00024 
00025 
00026 <font class="comment">// Define some useless stream defaults</font>
<a name="l00027"></a><a class="code" href="geomPQP_C.html#a0">00027</a> istream&amp; <a class="code" href="vector_C.html#a6">operator&gt;&gt; </a>(istream&amp; is, PQP_Model&amp; p)<font class="keyword"> </font>{ 
00028   <font class="comment">// Do nothing -- no reader available</font>
00029   <font class="keywordflow">return</font> is; 
00030 }
00031 
<a name="l00032"></a><a class="code" href="geomPQP_C.html#a1">00032</a> ostream&amp; <a class="code" href="vector_C.html#a5">operator&lt;&lt; </a>(ostream&amp; os, <font class="keyword">const</font> PQP_Model&amp; p)<font class="keyword"> </font>{ 
00033   os &lt;&lt; <font class="stringliteral">"PQP_Model "</font>;
00034   <font class="keywordflow">return</font> os; 
00035 }
00036 
00037 
00038 
00039 
00040 <font class="comment">// *********************************************************************</font>
00041 <font class="comment">// *********************************************************************</font>
00042 <font class="comment">// CLASS:     GeomPQP</font>
00043 <font class="comment">// </font>
00044 <font class="comment">// *********************************************************************</font>
00045 <font class="comment">// *********************************************************************</font>
00046 
00047 
<a name="l00048"></a><a class="code" href="class_GeomPQP.html#a0">00048</a> <a class="code" href="class_GeomPQP.html#a0">GeomPQP::GeomPQP</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Geom.html">Geom</a>(path) {
00049 
00050   <font class="comment">// Define empty transformation for obstacles</font>
00051   TO[0]=TO[1]=TO[2]=0.0;
00052   RO[0][0]=RO[1][1]=RO[2][2]=1.0;
00053   RO[0][1]=RO[0][2]=RO[1][0]= RO[1][2]= RO[2][0]= RO[2][1]=0.0;
00054 
00055   NumBodies = 1; <font class="comment">// Default</font>
00056 }
00057 
00058 
00059 
00060 
<a name="l00061"></a><a class="code" href="class_GeomPQP.html#a2">00061</a> <font class="keywordtype">void</font> <a class="code" href="class_GeomPQP.html#a2">GeomPQP::LoadEnvironment</a>(string path)<font class="keyword"></font>{
00062 
00063   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(Obst);
00064 
00065   <font class="keywordtype">int</font> i=0;
00066   list&lt;MSLTriangle&gt;::iterator t;
00067 
00068   Ob.BeginModel();
00069   PQP_REAL p1[3],p2[3],p3[3];
00070   <a class="code" href="defs_h.html#a8">forall</a>(t,Obst)<font class="keyword"> </font>{
00071     p1[0] = (PQP_REAL) t-&gt;p1.xcoord();
00072     p1[1] = (PQP_REAL) t-&gt;p1.ycoord();
00073     p1[2] = (PQP_REAL) t-&gt;p1.zcoord();
00074     p2[0] = (PQP_REAL) t-&gt;p2.xcoord();
00075     p2[1] = (PQP_REAL) t-&gt;p2.ycoord();
00076     p2[2] = (PQP_REAL) t-&gt;p2.zcoord();
00077     p3[0] = (PQP_REAL) t-&gt;p3.xcoord();
00078     p3[1] = (PQP_REAL) t-&gt;p3.ycoord();
00079     p3[2] = (PQP_REAL) t-&gt;p3.zcoord();
00080     Ob.AddTri(p1,p2,p3,i);
00081     i++;
00082   }
00083   Ob.EndModel();
00084 }
00085 
00086 
00087 
<a name="l00088"></a><a class="code" href="class_GeomPQP.html#a3">00088</a> <font class="keywordtype">void</font> <a class="code" href="class_GeomPQP.html#a3">GeomPQP::LoadRobot</a>(string path)<font class="keyword"></font>{
00089 
00090   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(Robot);
00091 
00092   <font class="keywordtype">int</font> i=0;
00093   list&lt;MSLTriangle&gt;::iterator t;
00094 
00095   Ro.BeginModel();
00096   PQP_REAL p1[3],p2[3],p3[3];
00097   <a class="code" href="defs_h.html#a8">forall</a>(t,Robot)<font class="keyword"></font>{
00098     p1[0] = (PQP_REAL) t-&gt;p1.xcoord();
00099     p1[1] = (PQP_REAL) t-&gt;p1.ycoord();
00100     p1[2] = (PQP_REAL) t-&gt;p1.zcoord();
00101     p2[0] = (PQP_REAL) t-&gt;p2.xcoord();
00102     p2[1] = (PQP_REAL) t-&gt;p2.ycoord();
00103     p2[2] = (PQP_REAL) t-&gt;p2.zcoord();
00104     p3[0] = (PQP_REAL) t-&gt;p3.xcoord();
00105     p3[1] = (PQP_REAL) t-&gt;p3.ycoord();
00106     p3[2] = (PQP_REAL) t-&gt;p3.zcoord();
00107     Ro.AddTri(p1,p2,p3,i);
00108     i++;
00109   }
00110   Ro.EndModel();
00111 }
00112 
00113 
00114 
00115 
00116 <font class="comment">// *********************************************************************</font>
00117 <font class="comment">// *********************************************************************</font>
00118 <font class="comment">// CLASS:     GeomPQP2D</font>
00119 <font class="comment">// </font>
00120 <font class="comment">// *********************************************************************</font>
00121 <font class="comment">// *********************************************************************</font>
00122 
<a name="l00123"></a><a class="code" href="class_GeomPQP2D.html#a0">00123</a> <a class="code" href="class_GeomPQP2D.html#a0">GeomPQP2D::GeomPQP2D</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_GeomPQP.html">GeomPQP</a>(path) {
00124 
00125   <a class="code" href="class_GeomPQP2D.html#a2">LoadEnvironment</a>(FilePath);
00126 }
00127 
00128 
<a name="l00129"></a><a class="code" href="class_GeomPQP2D.html#a2">00129</a> <font class="keywordtype">void</font> <a class="code" href="class_GeomPQP2D.html#a2">GeomPQP2D::LoadEnvironment</a>(string path)<font class="keyword"> 
</font>00130 <font class="keyword"></font>{
00131   std::ifstream fin;
00132 
00133   Obst.clear();
00134   fin.open((FilePath+<font class="stringliteral">"Obst"</font>).c_str());
00135   <font class="keywordflow">if</font> (fin) {
00136     fin &gt;&gt; ObstPolygons;
00137     <font class="comment">// Make triangles to store in Obst</font>
00138     Obst = <a class="code" href="triangle_h.html#a0">PolygonsToTriangles</a>(ObstPolygons,3.0);
00139   }
00140   fin.close();
00141 
00142   <font class="keywordtype">int</font> i=0;
00143   list&lt;MSLTriangle&gt;::iterator t;
00144 
00145   Ob.BeginModel();
00146   PQP_REAL p1[3],p2[3],p3[3];
00147   <a class="code" href="defs_h.html#a8">forall</a>(t,Obst)<font class="keyword"> </font>{
00148     p1[0] = (PQP_REAL) t-&gt;p1.xcoord();
00149     p1[1] = (PQP_REAL) t-&gt;p1.ycoord();
00150     p1[2] = (PQP_REAL) t-&gt;p1.zcoord();
00151     p2[0] = (PQP_REAL) t-&gt;p2.xcoord();
00152     p2[1] = (PQP_REAL) t-&gt;p2.ycoord();
00153     p2[2] = (PQP_REAL) t-&gt;p2.zcoord();
00154     p3[0] = (PQP_REAL) t-&gt;p3.xcoord();
00155     p3[1] = (PQP_REAL) t-&gt;p3.ycoord();
00156     p3[2] = (PQP_REAL) t-&gt;p3.zcoord();
00157     Ob.AddTri(p1,p2,p3,i);
00158     i++;
00159   }
00160   Ob.EndModel();
00161 
00162   <font class="comment">//cout &lt;&lt; "Obstacle region:\n" &lt;&lt; ObstPolygons &lt;&lt; "\n";</font>
00163   <font class="comment">//cout &lt;&lt; "Number of polygons: " &lt;&lt; ObstPolygons.size() &lt;&lt; "\n";</font>
00164 }
00165 
00166 
00167 
<a name="l00168"></a><a class="code" href="class_GeomPQP2D.html#a3">00168</a> <font class="keywordtype">void</font> <a class="code" href="class_GeomPQP2D.html#a3">GeomPQP2D::LoadRobot</a>(string path)<font class="keyword"></font>{
00169   std::ifstream fin;
00170 
00171   Robot.clear();
00172   fin.open((FilePath+<font class="stringliteral">"Robot"</font>).c_str());
00173   <font class="keywordflow">if</font> (fin) {
00174     fin &gt;&gt; RobotPolygons;
00175     <font class="comment">// Make triangles to store in Robot</font>
00176     Robot = <a class="code" href="triangle_h.html#a0">PolygonsToTriangles</a>(RobotPolygons,3.0);
00177   }
00178   fin.close();
00179 
00180   <font class="keywordtype">int</font> i=0;
00181   list&lt;MSLTriangle&gt;::iterator t;
00182 
00183   Ro.BeginModel();
00184   PQP_REAL p1[3],p2[3],p3[3];
00185   <a class="code" href="defs_h.html#a8">forall</a>(t,Robot)<font class="keyword"></font>{
00186     p1[0] = (PQP_REAL) t-&gt;p1.xcoord();
00187     p1[1] = (PQP_REAL) t-&gt;p1.ycoord();
00188     p1[2] = (PQP_REAL) t-&gt;p1.zcoord();
00189     p2[0] = (PQP_REAL) t-&gt;p2.xcoord();
00190     p2[1] = (PQP_REAL) t-&gt;p2.ycoord();
00191     p2[2] = (PQP_REAL) t-&gt;p2.zcoord();
00192     p3[0] = (PQP_REAL) t-&gt;p3.xcoord();
00193     p3[1] = (PQP_REAL) t-&gt;p3.ycoord();
00194     p3[2] = (PQP_REAL) t-&gt;p3.zcoord();
00195     Ro.AddTri(p1,p2,p3,i);
00196     i++;
00197   }
00198   Ro.EndModel();
00199 }
00200 
00201 
00202 
00203 <font class="comment">// *********************************************************************</font>
00204 <font class="comment">// *********************************************************************</font>
00205 <font class="comment">// CLASS:     GeomPQP2DPoint</font>
00206 <font class="comment">// </font>
00207 <font class="comment">// *********************************************************************</font>
00208 <font class="comment">// *********************************************************************</font>
00209 
<a name="l00210"></a><a class="code" href="class_GeomPQP2DPoint.html#a0">00210</a> <a class="code" href="class_GeomPQP2DPoint.html#a0">GeomPQP2DPoint::GeomPQP2DPoint</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_GeomPQP2D.html">GeomPQP2D</a>(path) {
00211 
00212   MaxDeviates = MSLVector(1.0,1.0);  <font class="comment">// Translation only</font>
00213 
00214   TR[2]=0.0;
00215   RR[0][0]=RR[1][1]=RR[2][2]=1.0;
00216   RR[0][1]=RR[0][2]=RR[1][0]= RR[1][2]= RR[2][0]= RR[2][1]=0.0;
00217 
00218 }
00219 
00220 
00221 
<a name="l00222"></a><a class="code" href="class_GeomPQP2DPoint.html#a2">00222</a> <font class="keywordtype">bool</font> <a class="code" href="class_GeomPQP2DPoint.html#a2">GeomPQP2DPoint::CollisionFree</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q)<font class="keyword"></font>{
00223 
00224   TR[0]=(PQP_REAL)q[0];
00225   TR[1]=(PQP_REAL)q[1];
00226 
00227   PQP_CollideResult cres;  
00228   PQP_Collide(&amp;cres,RR,TR,&amp;Ro,RO,TO,&amp;Ob,PQP_FIRST_CONTACT);
00229 
00230   <font class="keywordflow">return</font> (cres.NumPairs() == 0);
00231 }
00232 
00233 
00234 
<a name="l00235"></a><a class="code" href="class_GeomPQP2DPoint.html#a3">00235</a> <font class="keywordtype">double</font> <a class="code" href="class_GeomPQP2DPoint.html#a3">GeomPQP2DPoint::DistanceComp</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q)<font class="keyword"></font>{
00236 
00237   TR[0]=(PQP_REAL)q[0];
00238   TR[1]=(PQP_REAL)q[1];
00239 
00240   PQP_DistanceResult dres;  
00241   PQP_Distance(&amp;dres,RR,TR,&amp;Ro,RO,TO,&amp;Ob,0.0,0.0);
00242 
00243   <font class="keywordflow">return</font> dres.Distance();
00244 }
00245 
00246 
00247 
00248 <font class="comment">// *********************************************************************</font>
00249 <font class="comment">// *********************************************************************</font>
00250 <font class="comment">// CLASS:     GeomPQP2DRigid</font>
00251 <font class="comment">// </font>
00252 <font class="comment">// *********************************************************************</font>
00253 <font class="comment">// *********************************************************************</font>
00254 
<a name="l00255"></a><a class="code" href="class_GeomPQP2DRigid.html#a0">00255</a> <a class="code" href="class_GeomPQP2DRigid.html#a0">GeomPQP2DRigid::GeomPQP2DRigid</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_GeomPQP2D.html">GeomPQP2D</a>(path) {
00256 
00257   <font class="comment">// Compute the maximum deviates -- 2D with rotation</font>
00258   <font class="keywordtype">double</font> dmax = 0.0;
00259   <font class="keywordtype">double</font> mag;
00260   list&lt;MSLTriangle&gt;::iterator tr;
00261 
00262   <a class="code" href="class_GeomPQP2D.html#a3">LoadRobot</a>(path);
00263 
00264   <a class="code" href="defs_h.html#a8">forall</a>(tr,Robot)<font class="keyword"> </font>{
00265     <font class="comment">// Find maximum effective radius; ignore z distance here</font>
00266     mag = sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p1.xcoord())+<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p1.ycoord()));
00267     <font class="keywordflow">if</font> (mag &gt; dmax) 
00268       dmax = mag;
00269     mag = sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p2.xcoord())+<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p2.ycoord()));
00270     <font class="keywordflow">if</font> (mag &gt; dmax) 
00271       dmax = mag;
00272   }
00273 
00274   MaxDeviates = MSLVector(1.0,1.0,dmax);
00275 
00276 }
00277 
00278 
<a name="l00279"></a><a class="code" href="class_GeomPQP2DRigid.html#a5">00279</a> <font class="keywordtype">void</font> <a class="code" href="class_GeomPQP2DRigid.html#a5">GeomPQP2DRigid::SetTransformation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q)<font class="keyword"></font>{
00280 
00281   <font class="comment">// Set translation</font>
00282   TR[0] = (PQP_REAL)q[0];
00283   TR[1] = (PQP_REAL)q[1];
00284   TR[2] = 0.0;
00285 
00286   <font class="comment">// Set yaw rotation</font>
00287   RR[0][0] = (PQP_REAL)(cos(q[2]));
00288   RR[0][1] = (PQP_REAL)(-sin(q[2]));
00289   RR[0][2] = 0.0;
00290   RR[1][0] = (PQP_REAL)(sin(q[2]));
00291   RR[1][1] = (PQP_REAL)(cos(q[2]));
00292   RR[1][2] = 0.0;
00293   RR[2][0] = 0.0;
00294   RR[2][1] = 0.0;
00295   RR[2][2] = 1.0;
00296  
00297 }
00298 
00299 
<a name="l00300"></a><a class="code" href="class_GeomPQP2DRigid.html#a2">00300</a> <font class="keywordtype">bool</font> <a class="code" href="class_GeomPQP2DRigid.html#a2">GeomPQP2DRigid::CollisionFree</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q)<font class="keyword"></font>{
00301 
00302   <a class="code" href="class_GeomPQP2DRigid.html#a5">SetTransformation</a>(q);
00303 
00304   PQP_CollideResult cres;  
00305   PQP_Collide(&amp;cres,RR,TR,&amp;Ro,RO,TO,&amp;Ob,PQP_FIRST_CONTACT);
00306 
00307   <font class="keywordflow">return</font> (cres.NumPairs() == 0);
00308 }
00309 
00310 
<a name="l00311"></a><a class="code" href="class_GeomPQP2DRigid.html#a3">00311</a> <font class="keywordtype">double</font> <a class="code" href="class_GeomPQP2DRigid.html#a3">GeomPQP2DRigid::DistanceComp</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q)<font class="keyword"></font>{
00312 
00313   <a class="code" href="class_GeomPQP2DRigid.html#a5">SetTransformation</a>(q);
00314 
00315   PQP_DistanceResult dres;  
00316   PQP_Distance(&amp;dres,RR,TR,&amp;Ro,RO,TO,&amp;Ob,0.0,0.0);
00317 
00318   <font class="keywordflow">return</font> dres.Distance();
00319 }
00320 
00321 
00322 
00323 
<a name="l00324"></a><a class="code" href="class_GeomPQP2DRigid.html#a4">00324</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_GeomPQP2DRigid.html#a4">GeomPQP2DRigid::ConfigurationDifference</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q1, 
00325                                                     <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q2)<font class="keyword">
</font>00326 <font class="keyword"></font>{
00327   <a class="code" href="class_MSLVector.html">MSLVector</a> dq(3);
00328 
00329   dq[0] = q2[0] - q1[0];
00330   dq[1] = q2[1] - q1[1];
00331 
00332   <font class="keywordflow">if</font> (fabs(q1[2]-q2[2]) &lt; PI)
00333     dq[2] = q2[2] - q1[2];
00334   <font class="keywordflow">else</font> {
00335     <font class="keywordflow">if</font> (q1[2] &lt; q2[2])
00336       dq[2] = -(2.0*PI - fabs(q1[2]-q2[2]));
00337     <font class="keywordflow">else</font>
00338       dq[2] = (2.0*PI - fabs(q1[2]-q2[2]));
00339   }
00340 
00341   <font class="keywordflow">return</font> dq;
00342 }
00343 
00344 
00345 
00346 <font class="comment">// *********************************************************************</font>
00347 <font class="comment">// *********************************************************************</font>
00348 <font class="comment">// CLASS:     GeomPQP2DRigidMulti</font>
00349 <font class="comment">// </font>
00350 <font class="comment">// *********************************************************************</font>
00351 <font class="comment">// *********************************************************************</font>
00352 
<a name="l00353"></a><a class="code" href="class_GeomPQP2DRigidMulti.html#a0">00353</a> <a class="code" href="class_GeomPQP2DRigidMulti.html#a0">GeomPQP2DRigidMulti::GeomPQP2DRigidMulti</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_GeomPQP2DRigid.html">GeomPQP2DRigid</a>(path) {
00354   
00355   <font class="comment">// FilePath is set in the base class</font>
00356   <a class="code" href="class_GeomPQP2D.html#a2">LoadEnvironment</a>(FilePath);
00357   <a class="code" href="class_GeomPQP2DRigidMulti.html#a4">LoadRobot</a>(FilePath);
00358   
00359   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(CollisionPairs);
00360 }
00361 
00362 
00363 
<a name="l00364"></a><a class="code" href="class_GeomPQP2DRigidMulti.html#a4">00364</a> <font class="keywordtype">void</font> <a class="code" href="class_GeomPQP2DRigidMulti.html#a4">GeomPQP2DRigidMulti::LoadRobot</a>(string path)<font class="keyword"> </font>{
00365   <font class="keywordtype">int</font> i,j;
00366   string fname;
00367   list&lt;MSLPolygon&gt; pl;
00368 
00369   <font class="keywordtype">char</font>* s = <font class="keyword">new</font> <font class="keywordtype">char</font>[50];
00370 
00371   <font class="comment">// First check how many robot parts there are Robot0, Robot1, ...</font>
00372   i = 0;
00373   sprintf(s,<font class="stringliteral">"%sRobot%d"</font>,FilePath.c_str(),i);
00374   <font class="keywordflow">while</font> (<a class="code" href="util_C.html#a6">is_file</a>(s)) {
00375     i++;
00376     sprintf(s,<font class="stringliteral">"%sRobot%d"</font>,FilePath.c_str(),i);
00377   }
00378 
00379   NumBodies = i;
00380   
00381   <font class="keywordflow">if</font> (NumBodies == 0)
00382     cout &lt;&lt; <font class="stringliteral">"ERROR: No robot files at "</font> &lt;&lt; FilePath &lt;&lt; <font class="stringliteral">"\n"</font>;
00383   
00384   Robot = vector&lt;list&lt;MSLTriangle&gt; &gt;(NumBodies);
00385   Ro = vector&lt;PQP_Model&gt;(NumBodies);
00386   
00387   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {
00388     
00389     sprintf(s,<font class="stringliteral">"%sRobot%d"</font>,FilePath.c_str(),i);
00390     std::ifstream fin(s);
00391     pl.clear();
00392     fin &gt;&gt; pl;
00393 
00394     Robot[i] = <a class="code" href="triangle_h.html#a0">PolygonsToTriangles</a>(pl,5.0);
00395     j=0;
00396     list&lt;MSLTriangle&gt;::iterator t;
00397     
00398     Ro[i].BeginModel();
00399     PQP_REAL p1[3],p2[3],p3[3];
00400     <a class="code" href="defs_h.html#a8">forall</a>(t,Robot[i])<font class="keyword"></font>{
00401       p1[0] = (PQP_REAL) t-&gt;p1.xcoord();
00402       p1[1] = (PQP_REAL) t-&gt;p1.ycoord();
00403       p1[2] = (PQP_REAL) t-&gt;p1.zcoord();
00404       p2[0] = (PQP_REAL) t-&gt;p2.xcoord();
00405       p2[1] = (PQP_REAL) t-&gt;p2.ycoord();
00406       p2[2] = (PQP_REAL) t-&gt;p2.zcoord();
00407       p3[0] = (PQP_REAL) t-&gt;p3.xcoord();
00408       p3[1] = (PQP_REAL) t-&gt;p3.ycoord();
00409       p3[2] = (PQP_REAL) t-&gt;p3.zcoord();
00410       Ro[i].AddTri(p1,p2,p3,j);
00411       j++;
00412     }
00413     Ro[i].EndModel();
00414   }
00415 }
00416 
00417 
<a name="l00418"></a><a class="code" href="class_GeomPQP2DRigidMulti.html#a2">00418</a> <font class="keywordtype">bool</font> <a class="code" href="class_GeomPQP2DRigidMulti.html#a2">GeomPQP2DRigidMulti::CollisionFree</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q)<font class="keyword"></font>{
00419   <font class="keywordtype">int</font> i,j;
00420   list&lt;MSLVector&gt;::iterator v;
00421 
00422   PQP_CollideResult cres;  
00423   <a class="code" href="class_GeomPQP2DRigidMulti.html#a5">SetTransformation</a>(q);
00424 
00425   <font class="comment">// Check for collisions with obstacles</font>
00426   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {    
00427     PQP_Collide(&amp;cres,RR[i],TR[i],&amp;Ro[i],RO,TO,&amp;Ob,PQP_FIRST_CONTACT);    
00428     <font class="keywordflow">if</font> (cres.NumPairs() &gt;= 1)
00429       <font class="keywordflow">return</font> <font class="keyword">false</font>;
00430   }
00431   
00432   <font class="comment">// Check for pairwise collisions</font>
00433   <a class="code" href="defs_h.html#a8">forall</a>(v,CollisionPairs)<font class="keyword"> </font>{
00434     i = (<font class="keywordtype">int</font>) v-&gt;operator[](0); 
00435     j = (<font class="keywordtype">int</font>) v-&gt;operator[](1);
00436     PQP_Collide(&amp;cres,RR[i],TR[i],&amp;Ro[i],RR[j],TR[j],&amp;Ro[j],PQP_FIRST_CONTACT);    
00437     <font class="keywordflow">if</font> (cres.NumPairs() &gt;= 1)
00438       <font class="keywordflow">return</font> <font class="keyword">false</font>;
00439   }
00440 
00441   <font class="keywordflow">return</font> <font class="keyword">true</font>;
00442 }
00443 
00444 
<a name="l00445"></a><a class="code" href="class_GeomPQP2DRigidMulti.html#a3">00445</a> <font class="keywordtype">double</font> <a class="code" href="class_GeomPQP2DRigidMulti.html#a3">GeomPQP2DRigidMulti::DistanceComp</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q)<font class="keyword"></font>{
00446   <font class="keywordtype">int</font> i,j;
00447   list&lt;MSLVector&gt;::iterator v;
00448   <font class="keywordtype">double</font> dist = INFINITY;
00449 
00450   PQP_DistanceResult dres;  
00451   <a class="code" href="class_GeomPQP2DRigidMulti.html#a5">SetTransformation</a>(q);
00452 
00453   <font class="comment">// Check for collisions with obstacles</font>
00454   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {    
00455     PQP_Distance(&amp;dres,RR[i],TR[i],&amp;Ro[i],RO,TO,&amp;Ob,0.0,0.0);    
00456     <font class="keywordflow">if</font> (dres.Distance() &lt; dist)
00457       dist = dres.Distance();
00458   }
00459   
00460   <font class="comment">// Check for pairwise collisions</font>
00461   <a class="code" href="defs_h.html#a8">forall</a>(v,CollisionPairs)<font class="keyword"> </font>{
00462     i = (<font class="keywordtype">int</font>) v-&gt;operator[](0); 
00463     j = (<font class="keywordtype">int</font>) v-&gt;operator[](1);
00464     PQP_Distance(&amp;dres,RR[i],TR[i],&amp;Ro[i],RR[j],TR[j],&amp;Ro[j],0.0,0.0);    
00465     <font class="keywordflow">if</font> (dres.Distance() &lt; dist)
00466       dist = dres.Distance();
00467   }
00468 
00469   <font class="keywordflow">return</font> dist;
00470 }
00471 
00472 
<a name="l00473"></a><a class="code" href="class_GeomPQP2DRigidMulti.html#a5">00473</a> <font class="keywordtype">void</font> <a class="code" href="class_GeomPQP2DRigidMulti.html#a5">GeomPQP2DRigidMulti::SetTransformation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q)<font class="keyword"></font>{
00474 
00475   <font class="keywordtype">int</font> i;
00476   <a class="code" href="class_MSLVector.html">MSLVector</a> qi(3);
00477 
00478   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {
00479     <font class="comment">// Get the configuration</font>
00480     qi[0] = q[i*3]; qi[1] = q[i*3+1]; 
00481     qi[2] = q[i*3+2]; 
00482     
00483     <font class="comment">// Set translation</font>
00484     TR[i][0]=(PQP_REAL)qi[0];
00485     TR[i][1]=(PQP_REAL)qi[1];
00486     TR[i][2]=0.0;
00487     
00488     <font class="comment">// Set yaw rotation</font>
00489     RR[i][0][0] = (PQP_REAL)(cos(qi[2]));
00490     RR[i][0][1] = (PQP_REAL)(-sin(qi[2]));
00491     RR[i][0][2] = 0.0;
00492     RR[i][1][0] = (PQP_REAL)(sin(qi[2]));
00493     RR[i][1][1] = (PQP_REAL)(cos(qi[2]));
00494     RR[i][1][2] = 0.0;
00495     RR[i][2][0] = 0.0;
00496     RR[i][2][1] = 0.0;
00497     RR[i][2][2] = 1.0;    
00498   }
00499 }
00500 
00501 
00502 
00503 <font class="comment">// *********************************************************************</font>
00504 <font class="comment">// *********************************************************************</font>
00505 <font class="comment">// CLASS:     GeomPQP3DRigid</font>
00506 <font class="comment">// </font>
00507 <font class="comment">// *********************************************************************</font>
00508 <font class="comment">// *********************************************************************</font>
00509 
<a name="l00510"></a><a class="code" href="class_GeomPQP3DRigid.html#a0">00510</a> <a class="code" href="class_GeomPQP3DRigid.html#a0">GeomPQP3DRigid::GeomPQP3DRigid</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_GeomPQP.html">GeomPQP</a>(path) {
00511 
00512   <a class="code" href="class_GeomPQP.html#a2">LoadEnvironment</a>(FilePath);
00513   <a class="code" href="class_GeomPQP.html#a3">LoadRobot</a>(FilePath);
00514 
00515   <font class="comment">// Compute the maximum deviates -- 2D with rotation</font>
00516   MaxDeviates = MSLVector(6);
00517   MaxDeviates[0] = 1.0;
00518   MaxDeviates[1] = 1.0;
00519   MaxDeviates[2] = 1.0;
00520   <font class="keywordtype">double</font> dmax1 = 0.0;
00521   <font class="keywordtype">double</font> dmax2 = 0.0;
00522   <font class="keywordtype">double</font> dmax3 = 0.0;
00523   <font class="keywordtype">double</font> mag;
00524 
00525   list&lt;MSLTriangle&gt;::iterator tr;
00526 
00527   <a class="code" href="defs_h.html#a8">forall</a>(tr,Robot)<font class="keyword"> </font>{
00528     <font class="comment">// Check roll deviations</font>
00529     mag = sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p1.ycoord())+<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p1.zcoord()));
00530     <font class="keywordflow">if</font> (mag &gt; dmax1) 
00531       dmax1 = mag;
00532     mag = sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p2.ycoord())+<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p2.zcoord()));
00533     <font class="keywordflow">if</font> (mag &gt; dmax1) 
00534       dmax1 = mag;
00535     mag = sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p3.ycoord())+<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p3.zcoord()));
00536     <font class="keywordflow">if</font> (mag &gt; dmax1) 
00537       dmax1 = mag;
00538     <font class="comment">// Check pitch deviations</font>
00539     mag = sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p1.xcoord())+<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p1.zcoord()));
00540     <font class="keywordflow">if</font> (mag &gt; dmax2) 
00541       dmax2 = mag;
00542     mag = sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p2.xcoord())+<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p2.zcoord()));
00543     <font class="keywordflow">if</font> (mag &gt; dmax2) 
00544       dmax2 = mag;
00545     mag = sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p3.xcoord())+<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p3.zcoord()));
00546     <font class="keywordflow">if</font> (mag &gt; dmax2) 
00547       dmax2 = mag;
00548     <font class="comment">// Check yaw deviations</font>
00549     mag = sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p1.xcoord())+<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p1.ycoord()));
00550     <font class="keywordflow">if</font> (mag &gt; dmax3) 
00551       dmax3 = mag;
00552     mag = sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p2.xcoord())+<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p2.ycoord()));
00553     <font class="keywordflow">if</font> (mag &gt; dmax3) 
00554       dmax3 = mag;
00555     mag = sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p3.xcoord())+<a class="code" href="defs_h.html#a2">sqr</a>(tr-&gt;p3.ycoord()));
00556     <font class="keywordflow">if</font> (mag &gt; dmax3) 
00557       dmax3 = mag;
00558   }
00559 
00560   MaxDeviates[3] = dmax1;
00561   MaxDeviates[4] = dmax2;
00562   MaxDeviates[5] = dmax3;
00563 
00564   <font class="comment">//cout &lt;&lt; "MD: " &lt;&lt; MaxDeviates &lt;&lt; "\n";</font>
00565 }
00566 
00567 
<a name="l00568"></a><a class="code" href="class_GeomPQP3DRigid.html#a2">00568</a> <font class="keywordtype">bool</font> <a class="code" href="class_GeomPQP3DRigid.html#a2">GeomPQP3DRigid::CollisionFree</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q)<font class="keyword"></font>{
00569 
00570   <a class="code" href="class_GeomPQP3DRigid.html#a5">SetTransformation</a>(q);
00571 
00572 
00573   PQP_CollideResult cres;  
00574   PQP_Collide(&amp;cres,RR,TR,&amp;Ro,RO,TO,&amp;Ob,PQP_FIRST_CONTACT);
00575 
00576   <font class="keywordflow">return</font> (cres.NumPairs() == 0);
00577 }
00578 
00579 
00580 
00581 
<a name="l00582"></a><a class="code" href="class_GeomPQP3DRigid.html#a3">00582</a> <font class="keywordtype">double</font> <a class="code" href="class_GeomPQP3DRigid.html#a3">GeomPQP3DRigid::DistanceComp</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q)<font class="keyword"></font>{
00583 
00584   <a class="code" href="class_GeomPQP3DRigid.html#a5">SetTransformation</a>(q);
00585 
00586   PQP_DistanceResult dres;  
00587   PQP_Distance(&amp;dres,RR,TR,&amp;Ro,RO,TO,&amp;Ob,0.0,0.0);
00588 
00589   <font class="keywordflow">return</font> dres.Distance();
00590 }
00591 
00592 
00593 
00594 
<a name="l00595"></a><a class="code" href="class_GeomPQP3DRigid.html#a4">00595</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_GeomPQP3DRigid.html#a4">GeomPQP3DRigid::ConfigurationDifference</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q1, 
00596                                                 <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q2)<font class="keyword">
</font>00597 <font class="keyword"></font>{
00598   <a class="code" href="class_MSLVector.html">MSLVector</a> dq(6);
00599 
00600   dq[0] = q2[0] - q1[0];
00601   dq[1] = q2[1] - q1[1];
00602   dq[1] = q2[1] - q1[1];
00603 
00604   <font class="keywordflow">if</font> (fabs(q1[3]-q2[3]) &lt; PI)
00605     dq[3] = q2[3] - q1[3];
00606   <font class="keywordflow">else</font> {
00607     <font class="keywordflow">if</font> (q1[3] &lt; q2[3])
00608       dq[3] = -(2.0*PI - fabs(q1[3]-q2[3]));
00609     <font class="keywordflow">else</font>
00610       dq[3] = (2.0*PI - fabs(q1[3]-q2[3]));
00611   }
00612 
00613   <font class="keywordflow">if</font> (fabs(q1[4]-q2[4]) &lt; PI)
00614     dq[4] = q2[4] - q1[4];
00615   <font class="keywordflow">else</font> {
00616     <font class="keywordflow">if</font> (q1[4] &lt; q2[4])
00617       dq[4] = -(2.0*PI - fabs(q1[4]-q2[4]));
00618     <font class="keywordflow">else</font>
00619       dq[4] = (2.0*PI - fabs(q1[4]-q2[4]));
00620   }
00621 
00622   <font class="keywordflow">if</font> (fabs(q1[5]-q2[5]) &lt; PI)
00623     dq[5] = q2[5] - q1[5];
00624   <font class="keywordflow">else</font> {
00625     <font class="keywordflow">if</font> (q1[5] &lt; q2[5])
00626       dq[5] = -(2.0*PI - fabs(q1[5]-q2[5]));
00627     <font class="keywordflow">else</font>
00628       dq[5] = (2.0*PI - fabs(q1[5]-q2[5]));
00629   }
00630 
00631   <font class="keywordflow">return</font> dq;
00632 }
00633 
00634 
00635 
<a name="l00636"></a><a class="code" href="class_GeomPQP3DRigid.html#a5">00636</a> <font class="keywordtype">void</font> <a class="code" href="class_GeomPQP3DRigid.html#a5">GeomPQP3DRigid::SetTransformation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q)<font class="keyword"></font>{
00637 
00638   <font class="comment">// Set translation</font>
00639   TR[0]=(PQP_REAL)q[0];
00640   TR[1]=(PQP_REAL)q[1];
00641   TR[2]=(PQP_REAL)q[2];
00642 
00643   <font class="comment">// Set rotation</font>
00644   RR[0][0]=(PQP_REAL)(cos(q[5])*cos(q[4]));
00645   RR[0][1]=(PQP_REAL)(cos(q[5])*sin(q[4])*sin(q[3])-sin(q[5])*cos(q[3]));
00646   RR[0][2]=(PQP_REAL)(cos(q[5])*sin(q[4])*cos(q[3])+sin(q[5])*sin(q[3]));
00647   RR[1][0]=(PQP_REAL)(sin(q[5])*cos(q[4]));
00648   RR[1][1]=(PQP_REAL)(sin(q[5])*sin(q[4])*sin(q[3])+cos(q[5])*cos(q[3]));
00649   RR[1][2]=(PQP_REAL)(sin(q[5])*sin(q[4])*cos(q[3])-cos(q[5])*sin(q[3]));
00650   RR[2][0]=(PQP_REAL)((-1)*sin(q[4]));
00651   RR[2][1]=(PQP_REAL)(cos(q[4])*sin(q[3]));
00652   RR[2][2]=(PQP_REAL)(cos(q[4])*cos(q[3]));
00653 
00654 }
00655 
00656 
00657 
00658 
00659 
00660 <font class="comment">// *********************************************************************</font>
00661 <font class="comment">// *********************************************************************</font>
00662 <font class="comment">// CLASS:     GeomPQP3DRigidMulti</font>
00663 <font class="comment">// </font>
00664 <font class="comment">// *********************************************************************</font>
00665 <font class="comment">// *********************************************************************</font>
00666 
<a name="l00667"></a><a class="code" href="class_GeomPQP3DRigidMulti.html#a0">00667</a> <a class="code" href="class_GeomPQP3DRigidMulti.html#a0">GeomPQP3DRigidMulti::GeomPQP3DRigidMulti</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_GeomPQP3DRigid.html">GeomPQP3DRigid</a>(path) {
00668 
00669   <a class="code" href="class_GeomPQP.html#a2">LoadEnvironment</a>(FilePath);
00670   <a class="code" href="class_GeomPQP3DRigidMulti.html#a4">LoadRobot</a>(FilePath);
00671 
00672   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(CollisionPairs);
00673 }
00674 
00675 
00676 
<a name="l00677"></a><a class="code" href="class_GeomPQP3DRigidMulti.html#a4">00677</a> <font class="keywordtype">void</font> <a class="code" href="class_GeomPQP3DRigidMulti.html#a4">GeomPQP3DRigidMulti::LoadRobot</a>(string path)<font class="keyword"></font>{
00678   <font class="keywordtype">int</font> i,j;
00679   string fname;
00680 
00681   <font class="keywordtype">char</font>* s = <font class="keyword">new</font> <font class="keywordtype">char</font>[50];
00682 
00683   <font class="comment">// First check how many robot parts there are Robot0, Robot1, ...</font>
00684   i = 0;
00685   sprintf(s,<font class="stringliteral">"%sRobot%d"</font>,FilePath.c_str(),i);
00686   <font class="keywordflow">while</font> (<a class="code" href="util_C.html#a6">is_file</a>(s)) {
00687     i++;
00688     sprintf(s,<font class="stringliteral">"%sRobot%d"</font>,FilePath.c_str(),i);
00689   }
00690 
00691   NumBodies = i;
00692   
00693   <font class="keywordflow">if</font> (NumBodies == 0)
00694     cout &lt;&lt; <font class="stringliteral">"ERROR: No robot files at "</font> &lt;&lt; FilePath &lt;&lt; <font class="stringliteral">"\n"</font>;
00695   
00696   Robot = vector&lt;list&lt;MSLTriangle&gt; &gt;(NumBodies);
00697   Ro = vector&lt;PQP_Model&gt;(NumBodies);
00698   
00699   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {
00700     
00701     sprintf(s,<font class="stringliteral">"%sRobot%d"</font>,FilePath.c_str(),i);
00702     std::ifstream fin(s);
00703     fin &gt;&gt; Robot[i];
00704     
00705     j=0;
00706     list&lt;MSLTriangle&gt;::iterator t;
00707     
00708     Ro[i].BeginModel();
00709     PQP_REAL p1[3],p2[3],p3[3];
00710     <a class="code" href="defs_h.html#a8">forall</a>(t,Robot[i])<font class="keyword"></font>{
00711       p1[0] = (PQP_REAL) t-&gt;p1.xcoord();
00712       p1[1] = (PQP_REAL) t-&gt;p1.ycoord();
00713       p1[2] = (PQP_REAL) t-&gt;p1.zcoord();
00714       p2[0] = (PQP_REAL) t-&gt;p2.xcoord();
00715       p2[1] = (PQP_REAL) t-&gt;p2.ycoord();
00716       p2[2] = (PQP_REAL) t-&gt;p2.zcoord();
00717       p3[0] = (PQP_REAL) t-&gt;p3.xcoord();
00718       p3[1] = (PQP_REAL) t-&gt;p3.ycoord();
00719       p3[2] = (PQP_REAL) t-&gt;p3.zcoord();
00720       Ro[i].AddTri(p1,p2,p3,j);
00721       j++;
00722     }
00723     Ro[i].EndModel();
00724   }
00725 }
00726 
00727 
<a name="l00728"></a><a class="code" href="class_GeomPQP3DRigidMulti.html#a2">00728</a> <font class="keywordtype">bool</font> <a class="code" href="class_GeomPQP3DRigidMulti.html#a2">GeomPQP3DRigidMulti::CollisionFree</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q)<font class="keyword"></font>{
00729   <font class="keywordtype">int</font> i,j;
00730   list&lt;MSLVector&gt;::iterator v;
00731 
00732   PQP_CollideResult cres;  
00733   <a class="code" href="class_GeomPQP3DRigidMulti.html#a5">SetTransformation</a>(q);
00734 
00735   <font class="comment">// Check for collisions with obstacles</font>
00736   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {    
00737     PQP_Collide(&amp;cres,RR[i],TR[i],&amp;Ro[i],RO,TO,&amp;Ob,PQP_FIRST_CONTACT);    
00738     <font class="keywordflow">if</font> (cres.NumPairs() &gt;= 1)
00739       <font class="keywordflow">return</font> <font class="keyword">false</font>;
00740   }
00741   
00742   <font class="comment">// Check for pairwise collisions</font>
00743   <a class="code" href="defs_h.html#a8">forall</a>(v,CollisionPairs)<font class="keyword"> </font>{
00744     i = (<font class="keywordtype">int</font>) v-&gt;operator[](0); 
00745     j = (<font class="keywordtype">int</font>) v-&gt;operator[](1);
00746     PQP_Collide(&amp;cres,RR[i],TR[i],&amp;Ro[i],RR[j],TR[j],&amp;Ro[j],PQP_FIRST_CONTACT);    
00747     <font class="keywordflow">if</font> (cres.NumPairs() &gt;= 1)
00748       <font class="keywordflow">return</font> <font class="keyword">false</font>;
00749   }
00750 
00751   <font class="keywordflow">return</font> <font class="keyword">true</font>;
00752 }
00753 
00754 
<a name="l00755"></a><a class="code" href="class_GeomPQP3DRigidMulti.html#a3">00755</a> <font class="keywordtype">double</font> <a class="code" href="class_GeomPQP3DRigidMulti.html#a3">GeomPQP3DRigidMulti::DistanceComp</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q)<font class="keyword"></font>{
00756   <font class="keywordtype">int</font> i,j;
00757   list&lt;MSLVector&gt;::iterator v;
00758   <font class="keywordtype">double</font> dist = INFINITY;
00759 
00760   PQP_DistanceResult dres;  
00761   <a class="code" href="class_GeomPQP3DRigidMulti.html#a5">SetTransformation</a>(q);
00762 
00763   <font class="comment">// Check for collisions with obstacles</font>
00764   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {    
00765     PQP_Distance(&amp;dres,RR[i],TR[i],&amp;Ro[i],RO,TO,&amp;Ob,0.0,0.0);    
00766     <font class="keywordflow">if</font> (dres.Distance() &lt; dist)
00767       dist = dres.Distance();
00768   }
00769   
00770   <font class="comment">// Check for pairwise collisions</font>
00771   <a class="code" href="defs_h.html#a8">forall</a>(v,CollisionPairs)<font class="keyword"> </font>{
00772     i = (<font class="keywordtype">int</font>) v-&gt;operator[](0); 
00773     j = (<font class="keywordtype">int</font>) v-&gt;operator[](1);
00774     PQP_Distance(&amp;dres,RR[i],TR[i],&amp;Ro[i],RR[j],TR[j],&amp;Ro[j],0.0,0.0);    
00775     <font class="keywordflow">if</font> (dres.Distance() &lt; dist)
00776       dist = dres.Distance();
00777   }
00778 
00779   <font class="keywordflow">return</font> dist;
00780 }
00781 
00782 
<a name="l00783"></a><a class="code" href="class_GeomPQP3DRigidMulti.html#a5">00783</a> <font class="keywordtype">void</font> <a class="code" href="class_GeomPQP3DRigidMulti.html#a5">GeomPQP3DRigidMulti::SetTransformation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;q)<font class="keyword"></font>{
00784 
00785   <font class="keywordtype">int</font> i;
00786   <a class="code" href="class_MSLVector.html">MSLVector</a> qi(6);
00787 
00788   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {
00789     <font class="comment">// Get the configuration</font>
00790     qi[0] = q[i*6]; qi[1] = q[i*6+1]; qi[2] = q[i*6+2]; 
00791     qi[3] = q[i*6+3]; qi[4] = q[i*6+4]; qi[5] = q[i*6+5]; 
00792     
00793     <font class="comment">// Set translation</font>
00794     TR[i][0]=(PQP_REAL)qi[0];
00795     TR[i][1]=(PQP_REAL)qi[1];
00796     TR[i][2]=(PQP_REAL)qi[2];
00797     
00798     <font class="comment">// Set rotation</font>
00799     RR[i][0][0]=(PQP_REAL)(cos(qi[5])*cos(qi[4]));
00800     RR[i][0][1]=(PQP_REAL)(cos(qi[5])*sin(qi[4])*sin(qi[3])-sin(qi[5])*cos(qi[3]));
00801     RR[i][0][2]=(PQP_REAL)(cos(qi[5])*sin(qi[4])*cos(qi[3])+sin(qi[5])*sin(qi[3]));
00802     RR[i][1][0]=(PQP_REAL)(sin(qi[5])*cos(qi[4]));
00803     RR[i][1][1]=(PQP_REAL)(sin(qi[5])*sin(qi[4])*sin(qi[3])+cos(qi[5])*cos(qi[3]));
00804     RR[i][1][2]=(PQP_REAL)(sin(qi[5])*sin(qi[4])*cos(qi[3])-cos(qi[5])*sin(qi[3]));
00805     RR[i][2][0]=(PQP_REAL)((-1)*sin(qi[4]));
00806     RR[i][2][1]=(PQP_REAL)(cos(qi[4])*sin(qi[3]));
00807     RR[i][2][2]=(PQP_REAL)(cos(qi[4])*cos(qi[3]));
00808   }
00809 }
00810 
</div></pre><HEAD>
<TITLE>Motion Strategy Library</TITLE>
</HEAD>

<p>

<hr>

Web page maintained by 
<a href="http://janowiec.cs.iastate.edu/~lavalle">Steve LaValle</a><br>

Partial support provided by NSF CAREER Award IRI-970228 (LaValle),
Honda Research, and Iowa State University.<br>

Contributors:  Anna Atramentov, Peng Cheng, James Kuffner, Steve LaValle, and Libo Yang.<br>
