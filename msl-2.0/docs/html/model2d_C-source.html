<HEAD>
<TITLE>Motion Strategy Library</TITLE>
</HEAD>

<body bgcolor="#ffffff">

<center><img src="msl.jpg"></center>

<p>


<!-- Generated by Doxygen 1.2.2 on Wed Aug 29 23:26:43 2001 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>model2d.C</h1><a href="model2d_C.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">//----------------------------------------------------------------------</font>
00002 <font class="comment">//               The Motion Strategy Library (MSL)</font>
00003 <font class="comment">//----------------------------------------------------------------------</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// Copyright (c) 1998-2000 Iowa State University and Steve LaValle.  </font>
00006 <font class="comment">// All Rights Reserved.</font>
00007 <font class="comment">// </font>
00008 <font class="comment">// Permission to use, copy, and distribute this software and its </font>
00009 <font class="comment">// documentation is hereby granted free of charge, provided that </font>
00010 <font class="comment">// (1) it is not a component of a commercial product, and </font>
00011 <font class="comment">// (2) this notice appears in all copies of the software and</font>
00012 <font class="comment">//     related documentation. </font>
00013 <font class="comment">// </font>
00014 <font class="comment">// Iowa State University and the author make no representations</font>
00015 <font class="comment">// about the suitability or fitness of this software for any purpose.  </font>
00016 <font class="comment">// It is provided "as is" without express or implied warranty.</font>
00017 <font class="comment">//----------------------------------------------------------------------</font>
00018 
00019 <font class="preprocessor">#include &lt;fstream.h&gt;</font>
00020 <font class="preprocessor">#include &lt;math.h&gt;</font>
00021 
00022 <font class="preprocessor">#include "<a class="code" href="model2d_h.html">model2d.h</a>"</font>
00023 
00024 <font class="preprocessor">#include "<a class="code" href="defs_h.html">defs.h</a>"</font>
00025 
<a name="l00026"></a><a class="code" href="model2d_C.html#a0">00026</a> <font class="preprocessor">#define NUM_INPUTS_2DPOINT 50
</font><a name="l00027"></a><a class="code" href="model2d_C.html#a1">00027</a> <font class="preprocessor"></font><font class="preprocessor">#define NUM_INPUTS_2DRIGID 8
</font>00028 <font class="preprocessor"></font>
00029 
00030 <font class="comment">// *********************************************************************</font>
00031 <font class="comment">// *********************************************************************</font>
00032 <font class="comment">// CLASS:     Model2D</font>
00033 <font class="comment">// </font>
00034 <font class="comment">// *********************************************************************</font>
00035 <font class="comment">// *********************************************************************</font>
00036 
00037 
00038 
<a name="l00039"></a><a class="code" href="class_Model2D.html#a0">00039</a> <a class="code" href="class_Model2D.html#a0">Model2D::Model2D</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model.html">Model</a>(path) {
00040 }
00041 
00042 
<a name="l00043"></a><a class="code" href="class_Model2D.html#a2">00043</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2D.html#a2">Model2D::StateToConfiguration</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> 
</font>00044 <font class="keyword"></font>{
00045   <a class="code" href="class_MSLVector.html">MSLVector</a> q(3);
00046 
00047   q[0] = x[0]; q[1] = x[1]; q[2] = 0.0;
00048 
00049   <font class="keywordflow">return</font> q;
00050 }
00051 
00052 
00053 
00054 <font class="comment">// *********************************************************************</font>
00055 <font class="comment">// *********************************************************************</font>
00056 <font class="comment">// CLASS:     Model2DPoint</font>
00057 <font class="comment">// </font>
00058 <font class="comment">// *********************************************************************</font>
00059 <font class="comment">// *********************************************************************</font>
00060 
00061 
00062 <font class="comment">// Constructor</font>
<a name="l00063"></a><a class="code" href="class_Model2DPoint.html#a0">00063</a> <a class="code" href="class_Model2DPoint.html#a0">Model2DPoint::Model2DPoint</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model2D.html">Model2D</a>(path) {
00064   <font class="keywordtype">double</font> theta;
00065 
00066   StateDim = 2;
00067   InputDim = 2;
00068 
00069   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(LowerState,MSLVector(0.0,0.0));
00070   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(UpperState,MSLVector(100.0,100.0));
00071 
00072   <font class="comment">// Make the list of Inputs</font>
00073   Inputs.clear();
00074   <font class="keywordflow">for</font> (theta = 0.0; theta &lt; 2.0*PI; theta += 2.0*PI/NUM_INPUTS_2DPOINT) {
00075     Inputs.push_back(MSLVector(cos(theta),sin(theta)));
00076   }
00077 
00078   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(Inputs);
00079 
00080 }
00081 
00082 
00083 
00084 
<a name="l00085"></a><a class="code" href="class_Model2DPoint.html#a3">00085</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DPoint.html#a3">Model2DPoint::StateTransitionEquation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u)<font class="keyword"> </font>{
00086 
00087   <a class="code" href="class_MSLVector.html">MSLVector</a> dx(2);
00088 
00089   dx = u;
00090   <font class="keywordflow">return</font> dx;
00091 }
00092 
00093 
00094 
<a name="l00095"></a><a class="code" href="class_Model2DPoint.html#a4">00095</a> <font class="keywordtype">double</font> <a class="code" href="class_Model2DPoint.html#a4">Model2DPoint::Metric</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2)<font class="keyword"> </font>{
00096 
00097   <font class="keywordtype">double</font> rho;
00098 
00099   rho = (x1 - x2).length();
00100 
00101   <font class="keywordflow">return</font> rho;
00102 }
00103 
00104 
00105 
00106 
00107 
<a name="l00108"></a><a class="code" href="class_Model2DPoint.html#a2">00108</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DPoint.html#a2">Model2DPoint::Integrate</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u, <font class="keyword">const</font> <font class="keywordtype">double</font> &amp;h)<font class="keyword">
</font>00109 <font class="keyword"></font>{
00110   <font class="keywordflow">return</font> <a class="code" href="class_Model.html#b1">EulerIntegrate</a>(x,u,h);
00111 }
00112 
00113 
00114 
00115 <font class="comment">// *********************************************************************</font>
00116 <font class="comment">// *********************************************************************</font>
00117 <font class="comment">// CLASS:     Model::Model2DPointCar</font>
00118 <font class="comment">// </font>
00119 <font class="comment">// *********************************************************************</font>
00120 <font class="comment">// *********************************************************************</font>
00121 
00122 
00123 <font class="comment">// Constructor</font>
<a name="l00124"></a><a class="code" href="class_Model2DPointCar.html#a0">00124</a> <a class="code" href="class_Model2DPointCar.html#a0">Model2DPointCar::Model2DPointCar</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model2DPoint.html">Model2DPoint</a>(path) {
00125   <font class="keywordtype">double</font> alpha;
00126 
00127   StateDim = 3;
00128   InputDim = 2;
00129 
00130   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(LowerState,MSLVector(0.0,0.0,0.0));
00131   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(UpperState,MSLVector(100.0,100.0,2.0*PI));
00132 
00133   MaxSteeringAngle = PI/6.0;
00134   CarLength = 4.0;
00135 
00136   <font class="comment">// Make the list of Inputs</font>
00137   Inputs.clear();  <font class="comment">// Otherwise its parent constructor will make some inputs</font>
00138   <font class="keywordflow">for</font> (alpha = -MaxSteeringAngle; alpha &lt;= MaxSteeringAngle; 
00139        alpha += 2.0*MaxSteeringAngle/6.0) {
00140     Inputs.push_back(MSLVector(1.0,alpha));
00141     Inputs.push_back(MSLVector(-1.0,alpha)); 
00142   }
00143 
00144   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(Inputs);
00145 
00146 }
00147 
00148 
00149 
<a name="l00150"></a><a class="code" href="class_Model2DPointCar.html#a3">00150</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DPointCar.html#a3">Model2DPointCar::StateTransitionEquation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u)<font class="keyword"> </font>{
00151 
00152   <a class="code" href="class_MSLVector.html">MSLVector</a> dx(3);
00153 
00154   dx[0] = u[0]*cos(x[2]);
00155   dx[1] = u[0]*sin(x[2]);
00156   dx[2] = u[0]*tan(u[1])/CarLength;
00157   <font class="keywordflow">return</font> dx;
00158 }
00159 
00160 
00161 
<a name="l00162"></a><a class="code" href="class_Model2DPointCar.html#a4">00162</a> <font class="keywordtype">double</font> <a class="code" href="class_Model2DPointCar.html#a4">Model2DPointCar::Metric</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2)<font class="keyword"> </font>{
00163 
00164   <font class="keywordtype">double</font> rho,dtheta;
00165   
00166   dtheta = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[2]-x2[2]),2.0*PI - fabs(x1[2]-x2[2]));
00167 
00168   rho = sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(x1[0] - x2[0]) + <a class="code" href="defs_h.html#a2">sqr</a>(x1[1] - x2[1]) + 50.0/PI*<a class="code" href="defs_h.html#a2">sqr</a>(dtheta));
00169 
00170   <font class="keywordflow">return</font> rho;
00171 }
00172 
00173 
00174 
<a name="l00175"></a><a class="code" href="class_Model2DPointCar.html#a2">00175</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DPointCar.html#a2">Model2DPointCar::Integrate</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u, 
00176                                   <font class="keyword">const</font> <font class="keywordtype">double</font> &amp;h)<font class="keyword"> </font>{
00177   <a class="code" href="class_MSLVector.html">MSLVector</a> nx(3);
00178 
00179   nx = <a class="code" href="class_Model.html#b0">RungeKuttaIntegrate</a>(x,u,h);
00180 
00181   <font class="comment">// Make sure the S^1 topology is preserved for 2D rotation</font>
00182   <font class="keywordflow">if</font> (nx[2] &gt; 2.0*PI)
00183     nx[2] -= 2.0*PI;
00184   <font class="keywordflow">if</font> (nx[2] &lt; 0.0)
00185     nx[2] += 2.0*PI;
00186 
00187   <font class="keywordflow">return</font> nx;
00188 }
00189 
00190 
00191 
00192 <font class="comment">// *********************************************************************</font>
00193 <font class="comment">// *********************************************************************</font>
00194 <font class="comment">// CLASS:     Model2DRigid</font>
00195 <font class="comment">// </font>
00196 <font class="comment">// *********************************************************************</font>
00197 <font class="comment">// *********************************************************************</font>
00198 
00199 
00200 
00201 <font class="comment">// Constructor</font>
<a name="l00202"></a><a class="code" href="class_Model2DRigid.html#a0">00202</a> <a class="code" href="class_Model2DRigid.html#a0">Model2DRigid::Model2DRigid</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model2D.html">Model2D</a>(path) {
00203   <font class="keywordtype">double</font> theta;
00204 
00205   StateDim = 3;
00206   InputDim = 3;
00207 
00208   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(LowerState,MSLVector(0.0,0.0,0.0));
00209   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(UpperState,MSLVector(100.0,100.0,2.0*PI));
00210 
00211   <font class="comment">// Make the list of Inputs</font>
00212   Inputs.clear();
00213   <font class="keywordflow">for</font> (theta = 0.0; theta &lt; 2.0*PI; theta += 2.0*PI/NUM_INPUTS_2DRIGID) {
00214     Inputs.push_back(MSLVector(cos(theta),sin(theta),0.0));
00215   }
00216   Inputs.push_back(MSLVector(0.0,0.0,-0.1));
00217   Inputs.push_back(MSLVector(0.0,0.0,0.1));
00218 
00219   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(Inputs);
00220 
00221 }
00222 
00223 
00224 
<a name="l00225"></a><a class="code" href="class_Model2DRigid.html#a3">00225</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigid.html#a3">Model2DRigid::StateTransitionEquation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u)<font class="keyword"> </font>{
00226 
00227   <a class="code" href="class_MSLVector.html">MSLVector</a> dx(3);
00228 
00229   dx = u;
00230   <font class="keywordflow">return</font> dx;
00231 }
00232 
00233 
00234 
<a name="l00235"></a><a class="code" href="class_Model2DRigid.html#a5">00235</a> <font class="keywordtype">double</font> <a class="code" href="class_Model2DRigid.html#a5">Model2DRigid::Metric</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2)<font class="keyword"> </font>{
00236 
00237   <font class="keywordtype">double</font> fd = fabs(x1[2]-x2[2]);
00238   <font class="keywordtype">double</font> dtheta = <a class="code" href="defs_h.html#a3">min</a>(fd,2.0*PI - fd);
00239 
00240   <font class="keywordflow">return</font> sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(x1[0] - x2[0]) + <a class="code" href="defs_h.html#a2">sqr</a>(x1[1] - x2[1]) + <a class="code" href="defs_h.html#a2">sqr</a>(50.0/PI*dtheta));
00241 
00242 }
00243 
00244 
00245 
00246 <font class="comment">// Handle S^1 topology properly (for rotation)</font>
<a name="l00247"></a><a class="code" href="class_Model2DRigid.html#a4">00247</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigid.html#a4">Model2DRigid::LinearInterpolate</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2, 
00248                                        <font class="keyword">const</font> <font class="keywordtype">double</font> &amp;a)<font class="keyword"> </font>{
00249 
00250   <a class="code" href="class_MSLVector.html">MSLVector</a> v;
00251 
00252   v = (1.0-a)*x1 + a*x2;
00253 
00254   <font class="keywordflow">if</font> (fabs(x2[2] - x1[2]) &gt; PI) {
00255     <font class="keywordflow">if</font> (x1[2] &gt; x2[2])
00256       v[2] = (1.0-a)*x1[2] + a*(x2[2]+2.0*PI);
00257     <font class="keywordflow">else</font>
00258       v[2] = (1.0-a)*(x1[2]+2.0*PI) + a*x2[2];
00259   }
00260 
00261   <font class="keywordflow">if</font> (v[2] &gt; 2.0*PI)
00262     v[2] -= 2.0*PI;
00263 
00264   <font class="keywordflow">return</font> v;
00265 }
00266 
00267 
00268 
<a name="l00269"></a><a class="code" href="class_Model2DRigid.html#a2">00269</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigid.html#a2">Model2DRigid::Integrate</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u, <font class="keyword">const</font> <font class="keywordtype">double</font> &amp;h)<font class="keyword">
</font>00270 <font class="keyword"></font>{
00271   <a class="code" href="class_MSLVector.html">MSLVector</a> nx(3);
00272 
00273   nx = <a class="code" href="class_Model.html#b0">RungeKuttaIntegrate</a>(x,u,h);
00274 
00275   <font class="comment">// Make sure the S^1 topology is preserved for 2D rotation</font>
00276   <font class="keywordflow">if</font> (nx[2] &gt; 2.0*PI)
00277     nx[2] -= 2.0*PI;
00278   <font class="keywordflow">if</font> (nx[2] &lt; 0.0)
00279     nx[2] += 2.0*PI;
00280 
00281   <font class="keywordflow">return</font> nx;
00282 }
00283 
00284 
<a name="l00285"></a><a class="code" href="class_Model2DRigid.html#a6">00285</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigid.html#a6">Model2DRigid::StateToConfiguration</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> 
</font>00286 <font class="keyword"></font>{
00287   <a class="code" href="class_MSLVector.html">MSLVector</a> q(3);
00288 
00289   q[0] = x[0]; q[1] = x[1]; q[2] = x[2];
00290 
00291   <font class="keywordflow">return</font> q;
00292 }
00293 
00294 
00295 <font class="comment">// *********************************************************************</font>
00296 <font class="comment">// *********************************************************************</font>
00297 <font class="comment">// CLASS:     Model2DRigidCar</font>
00298 <font class="comment">// </font>
00299 <font class="comment">// *********************************************************************</font>
00300 <font class="comment">// *********************************************************************</font>
00301 
00302 
00303 <font class="comment">// Constructor</font>
<a name="l00304"></a><a class="code" href="class_Model2DRigidCar.html#a0">00304</a> <a class="code" href="class_Model2DRigidCar.html#a0">Model2DRigidCar::Model2DRigidCar</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model2DRigid.html">Model2DRigid</a>(path) {
00305   <font class="keywordtype">double</font> alpha;
00306 
00307   StateDim = 3;
00308   InputDim = 2;
00309 
00310   MaxSteeringAngle = PI/12.0;
00311   CarLength = 2.0;
00312 
00313   <font class="comment">// Make the list of Inputs</font>
00314   Inputs.clear();  <font class="comment">// Otherwise its parent constructor will make some inputs</font>
00315   <font class="keywordflow">for</font> (alpha = -MaxSteeringAngle; alpha &lt;= MaxSteeringAngle; 
00316        alpha += 2.0*MaxSteeringAngle/6.0) {
00317     Inputs.push_back(MSLVector(1.0,alpha)); 
00318     Inputs.push_back(MSLVector(-1.0,alpha)); 
00319   }
00320 
00321   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(Inputs);
00322 
00323 }
00324 
00325 
<a name="l00326"></a><a class="code" href="class_Model2DRigidCar.html#a2">00326</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidCar.html#a2">Model2DRigidCar::StateTransitionEquation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u)<font class="keyword"> </font>{
00327 
00328   <a class="code" href="class_MSLVector.html">MSLVector</a> dx(3);
00329   dx[0] = u[0]*cos(x[2]);
00330   dx[1] = u[0]*sin(x[2]);
00331   dx[2] = u[0]*tan(u[1])/CarLength;
00332   <font class="keywordflow">return</font> dx;
00333 }
00334 
00335 
00336 <font class="comment">// *********************************************************************</font>
00337 <font class="comment">// *********************************************************************</font>
00338 <font class="comment">// CLASS:     Model2DRigidCarForward</font>
00339 <font class="comment">// </font>
00340 <font class="comment">// *********************************************************************</font>
00341 <font class="comment">// *********************************************************************</font>
00342 
<a name="l00343"></a><a class="code" href="class_Model2DRigidCarForward.html#a0">00343</a> <a class="code" href="class_Model2DRigidCarForward.html#a0">Model2DRigidCarForward::Model2DRigidCarForward</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model2DRigidCar.html">Model2DRigidCar</a>(path) {
00344   <font class="keywordtype">double</font> alpha;
00345 
00346   StateDim = 3;
00347   InputDim = 2;
00348 
00349   Inputs.clear();  <font class="comment">// Otherwise its parent constructor will make some inputs</font>
00350   <font class="keywordflow">for</font> (alpha = -MaxSteeringAngle; alpha &lt;= MaxSteeringAngle; 
00351        alpha += 2.0*MaxSteeringAngle/6.0) {
00352     Inputs.push_back(MSLVector(1.0,alpha)); 
00353   }
00354 
00355   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(Inputs);
00356 
00357 }
00358 
00359 
00360 <font class="comment">// *********************************************************************</font>
00361 <font class="comment">// *********************************************************************</font>
00362 <font class="comment">// CLASS:     Model2DRigidCarSmooth</font>
00363 <font class="comment">//  Smooth steering </font>
00364 <font class="comment">// *********************************************************************</font>
00365 <font class="comment">// *********************************************************************</font>
00366 
00367 
<a name="l00368"></a><a class="code" href="class_Model2DRigidCarSmooth.html#a0">00368</a> <a class="code" href="class_Model2DRigidCarSmooth.html#a0">Model2DRigidCarSmooth::Model2DRigidCarSmooth</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model2DRigidCar.html">Model2DRigidCar</a>(path) {
00369 
00370   StateDim = 4;
00371   InputDim = 2;
00372   
00373   LowerState = MSLVector(4);
00374   UpperState = MSLVector(4);
00375 
00376   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(SteeringSpeed,0.05);
00377 
00378 
00379   LowerState[0] = 0.0; LowerState[1] = 0.0; LowerState[2] = 0.0; 
00380   LowerState[3] = -MaxSteeringAngle;
00381   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(LowerState);
00382 
00383   UpperState[0] = 100.0; UpperState[1] = 100.0; UpperState[2] = 2.0*PI; 
00384   UpperState[3] = MaxSteeringAngle;
00385   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(LowerState);
00386 
00387   <font class="comment">// Make the list of Inputs</font>
00388   Inputs.clear();  <font class="comment">// Otherwise its parent constructor will make some inputs</font>
00389   Inputs.push_back(MSLVector(1.0,0.0)); <font class="comment">// Keep the steering angle fixed</font>
00390   Inputs.push_back(MSLVector(-1.0,0.0)); <font class="comment">// Keep the steering angle fixed</font>
00391   Inputs.push_back(MSLVector(1.0,SteeringSpeed)); 
00392   Inputs.push_back(MSLVector(-1.0,SteeringSpeed)); 
00393   Inputs.push_back(MSLVector(1.0,-SteeringSpeed)); 
00394   Inputs.push_back(MSLVector(-1.0,-SteeringSpeed)); 
00395 
00396   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(Inputs);
00397 
00398 }
00399 
00400 
00401 
<a name="l00402"></a><a class="code" href="class_Model2DRigidCarSmooth.html#a2">00402</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidCarSmooth.html#a2">Model2DRigidCarSmooth::StateTransitionEquation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u)<font class="keyword"> </font>{
00403 
00404   <a class="code" href="class_MSLVector.html">MSLVector</a> dx(4);
00405 
00406   dx[0] = u[0]*cos(x[2]);
00407   dx[1] = u[0]*sin(x[2]);
00408   dx[2] = u[0]*tan(x[3])/CarLength;
00409   dx[3] = u[1];
00410 
00411   <font class="comment">//cout &lt;&lt; "DX: " &lt;&lt; dx &lt;&lt; "\n";</font>
00412 
00413   <font class="keywordflow">return</font> dx;
00414 }
00415 
00416 
00417 
00418 
<a name="l00419"></a><a class="code" href="class_Model2DRigidCarSmooth.html#a3">00419</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidCarSmooth.html#a3">Model2DRigidCarSmooth::Integrate</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u, <font class="keyword">const</font> <font class="keywordtype">double</font> &amp;h)<font class="keyword">
</font>00420 <font class="keyword"></font>{
00421   <font class="keywordflow">return</font> <a class="code" href="class_Model.html#b0">RungeKuttaIntegrate</a>(x,u,h);
00422 }
00423 
00424 
<a name="l00425"></a><a class="code" href="class_Model2DRigidCarSmooth.html#a4">00425</a> <font class="keywordtype">double</font> <a class="code" href="class_Model2DRigidCarSmooth.html#a4">Model2DRigidCarSmooth::Metric</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2)<font class="keyword"> </font>{
00426 
00427   <font class="keywordtype">double</font> rho,dphi,dtheta;
00428 
00429   dphi = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[3]-x2[3]),2.0*PI - fabs(x1[3]-x2[3]));
00430   dtheta = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[2]-x2[2]),2.0*PI - fabs(x1[2]-x2[2]));
00431 
00432   rho = sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(x1[0] - x2[0]) + <a class="code" href="defs_h.html#a2">sqr</a>(x1[1] - x2[1]) +
00433     <a class="code" href="defs_h.html#a2">sqr</a>(2.0/PI*dphi) +
00434     <a class="code" href="defs_h.html#a2">sqr</a>(50.0/PI*dtheta));
00435 
00436   <font class="keywordflow">return</font> rho;
00437 }
00438 
00439 
<a name="l00440"></a><a class="code" href="class_Model2DRigidCarSmooth.html#a5">00440</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidCarSmooth.html#a5">Model2DRigidCarSmooth::StateToConfiguration</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> 
</font>00441 <font class="keyword"></font>{
00442   <a class="code" href="class_MSLVector.html">MSLVector</a> q(3);
00443 
00444   q[0] = x[0]; q[1] = x[1]; q[2] = x[2];
00445 
00446   <font class="keywordflow">return</font> q;
00447 }
00448 
00449 
<a name="l00450"></a><a class="code" href="class_Model2DRigidCarSmooth.html#a6">00450</a> <font class="keywordtype">bool</font> <a class="code" href="class_Model2DRigidCarSmooth.html#a6">Model2DRigidCarSmooth::Satisfied</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> 
</font>00451 <font class="keyword"></font>{
00452   <font class="keywordflow">return</font> ((x[3] &lt; UpperState[3])&amp;&amp; <font class="comment">// Steering is too sharp!</font>
00453           (x[3] &gt; LowerState[3]));
00454 }
00455 
00456 
00457 <font class="comment">// *********************************************************************</font>
00458 <font class="comment">// *********************************************************************</font>
00459 <font class="comment">// CLASS:     Model2DRigidCarSmoothTrailer</font>
00460 <font class="comment">//  Smooth steering </font>
00461 <font class="comment">// *********************************************************************</font>
00462 <font class="comment">// *********************************************************************</font>
00463 
00464 
<a name="l00465"></a><a class="code" href="class_Model2DRigidCarSmoothTrailer.html#a0">00465</a> <a class="code" href="class_Model2DRigidCarSmoothTrailer.html#a0">Model2DRigidCarSmoothTrailer::Model2DRigidCarSmoothTrailer</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model2DRigidCarSmooth.html">Model2DRigidCarSmooth</a>(path) {
00466   
00467   StateDim = 5;
00468   InputDim = 2;
00469 
00470   LowerState = MSLVector(5);
00471   UpperState = MSLVector(5);
00472 
00473   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(HitchLength,10.0);
00474   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(HitchMaxAngle,PI/2.0); <font class="comment">// From 0 to PI</font>
00475 
00476 
00477   LowerState[0] = 0.0; LowerState[1] = 0.0; LowerState[2] = 0.0; 
00478   LowerState[3] = -MaxSteeringAngle; LowerState[4] = 0.0;
00479   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(LowerState);
00480 
00481   UpperState[0] = 100.0; UpperState[1] = 100.0; UpperState[2] = 2.0*PI; 
00482   UpperState[3] = MaxSteeringAngle; UpperState[4] = 2.0*PI;
00483   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(UpperState);
00484 
00485 }
00486 
00487 
00488 
<a name="l00489"></a><a class="code" href="class_Model2DRigidCarSmoothTrailer.html#a2">00489</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidCarSmoothTrailer.html#a2">Model2DRigidCarSmoothTrailer::StateTransitionEquation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u)<font class="keyword"> </font>{
00490 
00491   <a class="code" href="class_MSLVector.html">MSLVector</a> dx(5);
00492 
00493   dx[0] = u[0]*cos(x[2]);
00494   dx[1] = u[0]*sin(x[2]);
00495   dx[2] = u[0]*tan(x[3])/CarLength;
00496   dx[3] = u[1];
00497   dx[4] = u[0]*sin(x[2] - x[4])/HitchLength;
00498   <font class="keywordflow">return</font> dx;
00499 }
00500 
00501 
00502 
00503 
<a name="l00504"></a><a class="code" href="class_Model2DRigidCarSmoothTrailer.html#a3">00504</a> <font class="keywordtype">double</font> <a class="code" href="class_Model2DRigidCarSmoothTrailer.html#a3">Model2DRigidCarSmoothTrailer::Metric</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2)<font class="keyword"> </font>{
00505 
00506   <font class="keywordtype">double</font> rho,dphi,dtheta,dtheta1;
00507 
00508   dphi = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[3]-x2[3]),2.0*PI - fabs(x1[3]-x2[3]));
00509   dtheta = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[2]-x2[2]),2.0*PI - fabs(x1[2]-x2[2]));
00510   dtheta1 = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[4]-x2[4]),2.0*PI - fabs(x1[4]-x2[4]));
00511 
00512   rho = sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(x1[0] - x2[0]) + 
00513              <a class="code" href="defs_h.html#a2">sqr</a>(x1[1] - x2[1]) +
00514              <a class="code" href="defs_h.html#a2">sqr</a>(2.0/PI*dphi) +
00515              <a class="code" href="defs_h.html#a2">sqr</a>(5.0/PI*dtheta) +
00516              <a class="code" href="defs_h.html#a2">sqr</a>(5.0/PI*dtheta1));
00517 
00518   <font class="keywordflow">return</font> rho;
00519 }
00520 
00521 
<a name="l00522"></a><a class="code" href="class_Model2DRigidCarSmoothTrailer.html#a4">00522</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidCarSmoothTrailer.html#a4">Model2DRigidCarSmoothTrailer::StateToConfiguration</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> 
</font>00523 <font class="keyword"></font>{
00524   <a class="code" href="class_MSLVector.html">MSLVector</a> q(6);  <font class="comment">// Two bodies</font>
00525 
00526   <font class="comment">// The car config</font>
00527   q[0] = x[0]; q[1] = x[1]; q[2] = x[2];
00528 
00529   <font class="comment">// The trailer config</font>
00530   q[3] = -cos(x[4])*HitchLength+x[0];
00531   q[4] = -sin(x[4])*HitchLength+x[1];
00532   q[5] = x[4];
00533 
00534   <font class="keywordflow">return</font> q;
00535 }
00536 
00537 
<a name="l00538"></a><a class="code" href="class_Model2DRigidCarSmoothTrailer.html#a5">00538</a> <font class="keywordtype">bool</font> <a class="code" href="class_Model2DRigidCarSmoothTrailer.html#a5">Model2DRigidCarSmoothTrailer::Satisfied</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> 
</font>00539 <font class="keyword"></font>{
00540   <font class="keywordflow">return</font> ((x[3] &lt; UpperState[3])&amp;&amp; <font class="comment">// Steering is too sharp!</font>
00541           (x[3] &gt; LowerState[3])&amp;&amp;
00542           (cos(x[2]-x[4]) &gt;= cos(HitchMaxAngle)));
00543 }
00544 
00545 
00546 <font class="comment">// *********************************************************************</font>
00547 <font class="comment">// *********************************************************************</font>
00548 <font class="comment">// CLASS:     Model2DRigidCarSmooth2Trailers</font>
00549 <font class="comment">//  Smooth steering </font>
00550 <font class="comment">// *********************************************************************</font>
00551 <font class="comment">// *********************************************************************</font>
00552 
00553 
<a name="l00554"></a><a class="code" href="class_Model2DRigidCarSmooth2Trailers.html#a0">00554</a> <a class="code" href="class_Model2DRigidCarSmooth2Trailers.html#a0">Model2DRigidCarSmooth2Trailers::Model2DRigidCarSmooth2Trailers</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model2DRigidCarSmoothTrailer.html">Model2DRigidCarSmoothTrailer</a>(path) {
00555   
00556   StateDim = 6;
00557   InputDim = 2;
00558 
00559   LowerState = MSLVector(6);
00560   UpperState = MSLVector(6);
00561 
00562   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(Hitch2Length,10.0);
00563   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(Hitch2MaxAngle,PI/2.0); <font class="comment">// From 0 to PI</font>
00564 
00565   LowerState[0] = 0.0; LowerState[1] = 0.0; LowerState[2] = 0.0; 
00566   LowerState[3] = -MaxSteeringAngle; LowerState[4] = 0.0;
00567   LowerState[5] = 0.0;
00568   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(LowerState);
00569 
00570   UpperState[0] = 100.0; UpperState[1] = 100.0; UpperState[2] = 2.0*PI; 
00571   UpperState[3] = MaxSteeringAngle; UpperState[4] = 2.0*PI;
00572   UpperState[5] = 2.0*PI;
00573   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(UpperState);
00574 
00575 }
00576 
00577 
00578 
<a name="l00579"></a><a class="code" href="class_Model2DRigidCarSmooth2Trailers.html#a2">00579</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidCarSmooth2Trailers.html#a2">Model2DRigidCarSmooth2Trailers::StateTransitionEquation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u)<font class="keyword"> </font>{
00580 
00581   <a class="code" href="class_MSLVector.html">MSLVector</a> dx(6);
00582 
00583   dx[0] = u[0]*cos(x[2]);
00584   dx[1] = u[0]*sin(x[2]);
00585   dx[2] = u[0]*tan(x[3])/CarLength;
00586   dx[3] = u[1];
00587   dx[4] = u[0]*sin(x[2] - x[4])/HitchLength;
00588   dx[5] = u[0]*cos(x[2] - x[4])*sin(x[4] - x[5])/Hitch2Length;
00589   <font class="keywordflow">return</font> dx;
00590 }
00591 
00592 
00593 
<a name="l00594"></a><a class="code" href="class_Model2DRigidCarSmooth2Trailers.html#a3">00594</a> <font class="keywordtype">double</font> <a class="code" href="class_Model2DRigidCarSmooth2Trailers.html#a3">Model2DRigidCarSmooth2Trailers::Metric</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2)<font class="keyword"> </font>{
00595 
00596   <font class="keywordtype">double</font> rho,dphi,dtheta,dtheta1,dtheta2;
00597 
00598   dphi = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[3]-x2[3]),2.0*PI - fabs(x1[3]-x2[3]));
00599   dtheta = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[2]-x2[2]),2.0*PI - fabs(x1[2]-x2[2]));
00600   dtheta1 = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[4]-x2[4]),2.0*PI - fabs(x1[4]-x2[4]));
00601   dtheta2 = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[5]-x2[5]),2.0*PI - fabs(x1[5]-x2[5]));
00602 
00603   rho = sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(x1[0] - x2[0]) + <a class="code" href="defs_h.html#a2">sqr</a>(x1[1] - x2[1]) +
00604     <a class="code" href="defs_h.html#a2">sqr</a>(2.0/PI*dphi) +
00605     <a class="code" href="defs_h.html#a2">sqr</a>(5.0/PI*dtheta) +
00606     <a class="code" href="defs_h.html#a2">sqr</a>(5.0/PI*dtheta1) +
00607     <a class="code" href="defs_h.html#a2">sqr</a>(5.0/PI*dtheta2));
00608 
00609   <font class="keywordflow">return</font> rho;
00610 }
00611 
00612 
<a name="l00613"></a><a class="code" href="class_Model2DRigidCarSmooth2Trailers.html#a4">00613</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidCarSmooth2Trailers.html#a4">Model2DRigidCarSmooth2Trailers::StateToConfiguration</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> 
</font>00614 <font class="keyword"></font>{
00615   <a class="code" href="class_MSLVector.html">MSLVector</a> q(9);  <font class="comment">// Three bodies</font>
00616 
00617   <font class="comment">// The car config</font>
00618   q[0] = x[0]; q[1] = x[1]; q[2] = x[2];
00619 
00620   <font class="comment">// The 1st trailer config</font>
00621   q[3] = -cos(x[4])*HitchLength+x[0];
00622   q[4] = -sin(x[4])*HitchLength+x[1];
00623   q[5] = x[4];
00624 
00625   <font class="comment">// The 2nd trailer config</font>
00626   q[6] = -cos(x[5])*Hitch2Length+q[3];
00627   q[7] = -sin(x[5])*Hitch2Length+q[4];
00628   q[8] = x[5];
00629 
00630   <font class="keywordflow">return</font> q;
00631 }
00632 
00633 
<a name="l00634"></a><a class="code" href="class_Model2DRigidCarSmooth2Trailers.html#a5">00634</a> <font class="keywordtype">bool</font> <a class="code" href="class_Model2DRigidCarSmooth2Trailers.html#a5">Model2DRigidCarSmooth2Trailers::Satisfied</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> 
</font>00635 <font class="keyword"></font>{
00636   <font class="keywordflow">return</font> ((x[3] &lt; UpperState[3])&amp;&amp; <font class="comment">// Steering is too sharp!</font>
00637           (x[3] &gt; LowerState[3])&amp;&amp;
00638           (cos(x[2]-x[4]) &gt;= cos(HitchMaxAngle))&amp;&amp;
00639           (cos(x[4]-x[5]) &gt;= cos(Hitch2MaxAngle)));
00640 }
00641 
00642 
00643 <font class="comment">// *********************************************************************</font>
00644 <font class="comment">// *********************************************************************</font>
00645 <font class="comment">// CLASS:     Model2DRigidCarSmooth3Trailers</font>
00646 <font class="comment">//  Smooth steering </font>
00647 <font class="comment">// *********************************************************************</font>
00648 <font class="comment">// *********************************************************************</font>
00649 
00650 
<a name="l00651"></a><a class="code" href="class_Model2DRigidCarSmooth3Trailers.html#a0">00651</a> <a class="code" href="class_Model2DRigidCarSmooth3Trailers.html#a0">Model2DRigidCarSmooth3Trailers::Model2DRigidCarSmooth3Trailers</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model2DRigidCarSmooth2Trailers.html">Model2DRigidCarSmooth2Trailers</a>(path) {
00652   
00653   StateDim = 7;
00654   InputDim = 2;
00655 
00656   LowerState = MSLVector(7);
00657   UpperState = MSLVector(7);
00658 
00659   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(Hitch3Length,10.0);
00660   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(Hitch3MaxAngle,PI/2.0); <font class="comment">// From 0 to PI</font>
00661 
00662   LowerState[0] = 0.0; LowerState[1] = 0.0; LowerState[2] = 0.0; 
00663   LowerState[3] = -MaxSteeringAngle; LowerState[4] = 0.0;
00664   LowerState[5] = 0.0; LowerState[6] = 0.0;
00665   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(LowerState);
00666 
00667   UpperState[0] = 100.0; UpperState[1] = 100.0; UpperState[2] = 2.0*PI; 
00668   UpperState[3] = MaxSteeringAngle; UpperState[4] = 2.0*PI;
00669   UpperState[5] = 2.0*PI; UpperState[6] = 2.0*PI;
00670   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(UpperState);
00671 
00672 }
00673 
00674 
00675 
<a name="l00676"></a><a class="code" href="class_Model2DRigidCarSmooth3Trailers.html#a2">00676</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidCarSmooth3Trailers.html#a2">Model2DRigidCarSmooth3Trailers::StateTransitionEquation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u)<font class="keyword"> </font>{
00677 
00678   <a class="code" href="class_MSLVector.html">MSLVector</a> dx(7);
00679 
00680   dx[0] = u[0]*cos(x[2]);
00681   dx[1] = u[0]*sin(x[2]);
00682   dx[2] = u[0]*tan(x[3])/CarLength;
00683   dx[3] = u[1];
00684   dx[4] = u[0]*sin(x[2] - x[4])/HitchLength;
00685   dx[5] = u[0]*cos(x[2] - x[4])*sin(x[4] - x[5])/Hitch2Length;
00686   dx[6] = u[0]*cos(x[2] - x[4])*cos(x[4] - x[5])*sin(x[5]-x[6])/Hitch3Length;
00687   <font class="keywordflow">return</font> dx;
00688 }
00689 
00690 
00691 
00692 
<a name="l00693"></a><a class="code" href="class_Model2DRigidCarSmooth3Trailers.html#a3">00693</a> <font class="keywordtype">double</font> <a class="code" href="class_Model2DRigidCarSmooth3Trailers.html#a3">Model2DRigidCarSmooth3Trailers::Metric</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2)<font class="keyword"> </font>{
00694 
00695   <font class="keywordtype">double</font> rho,dphi,dtheta,dtheta1,dtheta2,dtheta3;
00696 
00697   dphi = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[3]-x2[3]),2.0*PI - fabs(x1[3]-x2[3]));
00698   dtheta = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[2]-x2[2]),2.0*PI - fabs(x1[2]-x2[2]));
00699   dtheta1 = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[4]-x2[4]),2.0*PI - fabs(x1[4]-x2[4]));
00700   dtheta2 = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[5]-x2[5]),2.0*PI - fabs(x1[5]-x2[5]));
00701   dtheta3 = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[6]-x2[6]),2.0*PI - fabs(x1[6]-x2[6]));
00702 
00703   rho = sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(x1[0] - x2[0]) + <a class="code" href="defs_h.html#a2">sqr</a>(x1[1] - x2[1]) +
00704     <a class="code" href="defs_h.html#a2">sqr</a>(2.0/PI*dphi) +
00705     <a class="code" href="defs_h.html#a2">sqr</a>(5.0/PI*dtheta) +
00706     <a class="code" href="defs_h.html#a2">sqr</a>(5.0/PI*dtheta1) +
00707     <a class="code" href="defs_h.html#a2">sqr</a>(5.0/PI*dtheta2) +
00708     <a class="code" href="defs_h.html#a2">sqr</a>(5.0/PI*dtheta3));
00709 
00710   <font class="keywordflow">return</font> rho;
00711 }
00712 
00713 
00714 
<a name="l00715"></a><a class="code" href="class_Model2DRigidCarSmooth3Trailers.html#a4">00715</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidCarSmooth3Trailers.html#a4">Model2DRigidCarSmooth3Trailers::StateToConfiguration</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> 
</font>00716 <font class="keyword"></font>{
00717   <a class="code" href="class_MSLVector.html">MSLVector</a> q(12);  <font class="comment">// Four bodies</font>
00718 
00719   <font class="comment">// The car config</font>
00720   q[0] = x[0]; q[1] = x[1]; q[2] = x[2];
00721 
00722   <font class="comment">// The 1st trailer config</font>
00723   q[3] = -cos(x[4])*HitchLength+x[0];
00724   q[4] = -sin(x[4])*HitchLength+x[1];
00725   q[5] = x[4];
00726 
00727   <font class="comment">// The 2nd trailer config</font>
00728   q[6] = -cos(x[5])*Hitch2Length+q[3];
00729   q[7] = -sin(x[5])*Hitch2Length+q[4];
00730   q[8] = x[5];
00731 
00732   <font class="comment">// The 3rd trailer config</font>
00733   q[9]  = -cos(x[6])*Hitch3Length+q[6];
00734   q[10] = -sin(x[6])*Hitch3Length+q[7];
00735   q[11] = x[6];
00736 
00737   <font class="keywordflow">return</font> q;
00738 }
00739 
00740 
<a name="l00741"></a><a class="code" href="class_Model2DRigidCarSmooth3Trailers.html#a5">00741</a> <font class="keywordtype">bool</font> <a class="code" href="class_Model2DRigidCarSmooth3Trailers.html#a5">Model2DRigidCarSmooth3Trailers::Satisfied</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> 
</font>00742 <font class="keyword"></font>{
00743   <font class="keywordflow">return</font> ((x[3] &lt; UpperState[3])&amp;&amp; <font class="comment">// Steering is too sharp!</font>
00744           (x[3] &gt; LowerState[3])&amp;&amp;
00745           (cos(x[2]-x[4]) &gt;= cos(HitchMaxAngle))&amp;&amp;
00746           (cos(x[4]-x[5]) &gt;= cos(Hitch2MaxAngle))&amp;&amp;
00747           (cos(x[5]-x[6]) &gt;= cos(Hitch3MaxAngle)));
00748 }
00749 
00750 
00751 <font class="comment">// *********************************************************************</font>
00752 <font class="comment">// *********************************************************************</font>
00753 <font class="comment">// CLASS:     Model2DRigidDyncar</font>
00754 <font class="comment">//  </font>
00755 <font class="comment">// *********************************************************************</font>
00756 <font class="comment">// *********************************************************************</font>
00757 
00758 <font class="comment">// Constructor</font>
<a name="l00759"></a><a class="code" href="class_Model2DRigidDyncar.html#a0">00759</a> <a class="code" href="class_Model2DRigidDyncar.html#a0">Model2DRigidDyncar::Model2DRigidDyncar</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model2DRigid.html">Model2DRigid</a>(path) {
00760   <font class="keywordtype">double</font> alpha;
00761   <a class="code" href="class_MSLVector.html">MSLVector</a> v;
00762 
00763   StateDim = 5;
00764   InputDim = 1;
00765   Mass = 100.0;
00766   CAF = 17000.0;
00767   CAR = 20000.0;
00768   Adist = 4.0;
00769   Bdist = 5.0;
00770   Izz = 1600.0;
00771 
00772   WorldScale = 0.1;
00773   Speed = 88.0;   <font class="comment">// Feet per sec</font>
00774   
00775   LowerState = MSLVector(5);
00776   UpperState = MSLVector(5);
00777 
00778   LowerState[0] = -50.0; LowerState[1] = -5.0; LowerState[2] = 0.0; 
00779   LowerState[3] = -1000.0; LowerState[4] = 0.0;
00780   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(LowerState);
00781 
00782   UpperState[0] = 50.0; UpperState[1] = 5.0; UpperState[2] = 1000.0; 
00783   UpperState[3] = 0.0; UpperState[4] = 2.0*PI;
00784   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(UpperState);
00785 
00786   MaxSteeringAngle = 0.6;
00787 
00788   <font class="comment">// Make the list of 1D Inputs</font>
00789   Inputs.clear();  <font class="comment">// Otherwise its parent constructor will make some inputs</font>
00790   <font class="keywordflow">for</font> (alpha = -MaxSteeringAngle; alpha &lt;= MaxSteeringAngle; 
00791        alpha += 2.0*MaxSteeringAngle/24.0) {
00792     v = MSLVector(1); v[0] = alpha;
00793     Inputs.push_back(v);
00794   }
00795 
00796   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(Inputs);
00797 
00798 }
00799 
00800 
00801 <font class="comment">// This is xdot = f(x,u) for a 5dof state-space, and 1dof input</font>
00802 <font class="comment">//  Model taken from Jim Bernard...</font>
00803 <font class="comment">// alphaf = (v + a*r)/u - deltaf</font>
00804 <font class="comment">// alphar = (v-b*r)/u</font>
00805 <font class="comment">// FYF = -CAF*alphaf</font>
00806 <font class="comment">// FYR = -CAR*alphar</font>
00807 <font class="comment">// vdot = -u*r  + (FYF + FYR)/m</font>
00808 <font class="comment">// rdot = (FYF*a - FYR*b)/Izz</font>
00809 <font class="comment">// Xdot = u*cos(psi) - v*sin(psi)</font>
00810 <font class="comment">// Ydot = u*sin(spi) + v*cos(psi)</font>
00811 <font class="comment">// psidot = r</font>
00812 <font class="comment">// </font>
00813 <font class="comment">// m = mass of car, say about 100 slugs</font>
00814 <font class="comment">// CAF = front cornering stiffness in pounds per radiaof the tires, say about</font>
00815 <font class="comment">// 17000</font>
00816 <font class="comment">// CAR = rear cornering stiffness, say about 20000</font>
00817 <font class="comment">// a is dist from mass center to front tires, say 4 feet</font>
00818 <font class="comment">// b is dist from mass center to rear tires, say 5 feet</font>
00819 <font class="comment">// Izz is yaw moment of intertia, say about 1600 slug ft**2</font>
00820 <font class="comment">// u is forward speed which is assumed constant, input is in feet/sec</font>
00821 <font class="comment">// delta is your input, it is the steer angle of the tires in radians.</font>
00822 
<a name="l00823"></a><a class="code" href="class_Model2DRigidDyncar.html#a4">00823</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidDyncar.html#a4">Model2DRigidDyncar::StateTransitionEquation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u)<font class="keyword">
</font>00824 <font class="keyword"></font>{
00825   <font class="keywordtype">double</font> alphaf,alphar,fyf,fyr,v,r,psi;
00826   <a class="code" href="class_MSLVector.html">MSLVector</a> dx(5);
00827 
00828   v = x[0]; r = x[1]; psi = x[4];
00829 
00830   alphaf = (v + Adist * r) / Speed - u[0];
00831   alphar = (v - Bdist * r) / Speed;
00832   fyf = -CAF * alphaf;
00833   fyr = -CAR * alphar;
00834 
00835   <font class="comment">/* Transfer the velocity */</font>
00836   dx[0] = -Speed * r  + (fyf + fyr) / Mass;
00837   dx[1] = (fyf * Adist - fyr * Bdist) / Izz;
00838   dx[2] = Speed * cos(psi) - v * sin(psi);
00839   dx[3] = Speed * sin(psi) + v * cos(psi);
00840   dx[4] = r;
00841 
00842   <font class="comment">//cout &lt;&lt; "x: " &lt;&lt; x &lt;&lt; "  Dx: " &lt;&lt; dx &lt;&lt; "  u: " &lt;&lt; u[0] &lt;&lt; "\n";</font>
00843 
00844   <font class="keywordflow">return</font> dx;
00845 }
00846 
00847 
00848 
<a name="l00849"></a><a class="code" href="class_Model2DRigidDyncar.html#a5">00849</a> <font class="keywordtype">double</font> <a class="code" href="class_Model2DRigidDyncar.html#a5">Model2DRigidDyncar::Metric</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2)<font class="keyword"> </font>{
00850   <font class="keywordtype">double</font> d;
00851 
00852   <font class="comment">// Position difference</font>
00853   d =  <a class="code" href="defs_h.html#a2">sqr</a>((x1[2] - x2[2]) / (UpperState[2] - LowerState[2]));
00854   d += <a class="code" href="defs_h.html#a2">sqr</a>((x1[3] - x2[3]) / (UpperState[3] - LowerState[3]));
00855 
00856   <font class="comment">// Orientation difference</font>
00857   d += <a class="code" href="defs_h.html#a2">sqr</a>(<a class="code" href="defs_h.html#a3">min</a>(fabs(x1[4]-x2[4]),2.0*PI - fabs(x1[4]-x2[4]))/2.0/PI);
00858 
00859   <font class="comment">// Velocities</font>
00860   d += <a class="code" href="defs_h.html#a2">sqr</a>((x1[0] - x2[0]) / (UpperState[0] - LowerState[0]));
00861   d += <a class="code" href="defs_h.html#a2">sqr</a>((x1[1] - x2[1]) / (UpperState[1] - LowerState[1]));
00862 
00863 
00864   <font class="keywordflow">return</font> sqrt(d);
00865 }
00866 
00867 
00868 
<a name="l00869"></a><a class="code" href="class_Model2DRigidDyncar.html#a2">00869</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidDyncar.html#a2">Model2DRigidDyncar::Integrate</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u, <font class="keyword">const</font> <font class="keywordtype">double</font> &amp;h)<font class="keyword">
</font>00870 <font class="keyword"></font>{
00871   <font class="keywordflow">return</font> <a class="code" href="class_Model.html#b0">RungeKuttaIntegrate</a>(x,u,h);
00872 }
00873 
00874 
00875 <font class="comment">// NOTE: This neglects the S^1 effect of orientation!!</font>
<a name="l00876"></a><a class="code" href="class_Model2DRigidDyncar.html#a3">00876</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidDyncar.html#a3">Model2DRigidDyncar::StateToConfiguration</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> </font>{
00877   <font class="keywordflow">return</font> MSLVector(x[2]*WorldScale,-x[3]*WorldScale,2.0*PI-x[4]); 
00878 }
00879 
00880 
<a name="l00881"></a><a class="code" href="class_Model2DRigidDyncar.html#a6">00881</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidDyncar.html#a6">Model2DRigidDyncar::LinearInterpolate</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, 
00882                                              <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2, 
00883                                              <font class="keyword">const</font> <font class="keywordtype">double</font> &amp;a)<font class="keyword"> </font>{
00884 
00885   <a class="code" href="class_MSLVector.html">MSLVector</a> v;
00886 
00887   v = (1.0-a)*x1 + a*x2;
00888 
00889   <font class="keywordflow">if</font> (fabs(x2[4] - x1[4]) &gt; PI) {
00890     <font class="keywordflow">if</font> (x1[4] &gt; x2[4])
00891       v[4] = (1.0-a)*x1[4] + a*(x2[4]+2.0*PI);
00892     <font class="keywordflow">else</font>
00893       v[4] = (1.0-a)*(x1[4]+2.0*PI) + a*x2[4];
00894   }
00895 
00896   <font class="keywordflow">if</font> (v[4] &gt; 2.0*PI)
00897     v[4] -= 2.0*PI;
00898 
00899   <font class="keywordflow">return</font> v;
00900 }
00901 
00902 
00903 
00904 <font class="comment">// *********************************************************************</font>
00905 <font class="comment">// *********************************************************************</font>
00906 <font class="comment">// CLASS:     Model2DRigidDyncarNtire</font>
00907 <font class="comment">//  </font>
00908 <font class="comment">// *********************************************************************</font>
00909 <font class="comment">// *********************************************************************</font>
00910 
00911 <font class="comment">// Constructor</font>
<a name="l00912"></a><a class="code" href="class_Model2DRigidDyncarNtire.html#a0">00912</a> <a class="code" href="class_Model2DRigidDyncarNtire.html#a0">Model2DRigidDyncarNtire::Model2DRigidDyncarNtire</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model2DRigidDyncar.html">Model2DRigidDyncar</a>(path) {
00913   <font class="keywordtype">double</font> alpha;
00914   <a class="code" href="class_MSLVector.html">MSLVector</a> v;
00915 
00916   StateDim = 5;
00917   InputDim = 2;
00918 
00919   <font class="comment">// These are the exact parameters from Ric's model</font>
00920   Mass = 3518.0/32.2;
00921   Adist = 0.45*100.5/12.0;
00922   Bdist = 0.55*100.5/12.0;
00923   Izz = 0.25*Mass*(Adist+Bdist)*(Adist+Bdist);
00924 
00925   <font class="comment">// Constants for the nonlinear tire model</font>
00926   Mu = 0.85;
00927   Nf = Mass*32.2*0.55;
00928   Nr = Mass*32.2*0.45;
00929 
00930   <font class="comment">// Make the list of 2D Inputs</font>
00931   <font class="comment">// Apparently, this models allows rear-wheel steering</font>
00932   <font class="comment">//    This option is set to zero for now...hence v[1]=0.0</font>
00933   Inputs.clear();  <font class="comment">// Otherwise its parent constructor will make some inputs</font>
00934   <font class="keywordflow">for</font> (alpha = -MaxSteeringAngle; alpha &lt;= MaxSteeringAngle; 
00935        alpha += 2.0*MaxSteeringAngle/24.0) {
00936     v = MSLVector(2); v[0] = alpha; v[1] = 0.0;
00937     Inputs.push_back(v);
00938   }
00939 
00940   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(Inputs);
00941   
00942 }
00943 
00944 
00945 <font class="comment">// The is the model from Jim Bernard and Ric Menendez</font>
<a name="l00946"></a><a class="code" href="class_Model2DRigidDyncarNtire.html#a2">00946</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidDyncarNtire.html#a2">Model2DRigidDyncarNtire::StateTransitionEquation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u)<font class="keyword">
</font>00947 <font class="keyword"></font>{
00948   <font class="keywordtype">double</font> alphaf,alphar,fyf,fyr,v,r,psi;
00949   <font class="keywordtype">double</font> talff,talfr,xiblf,xiblr;
00950   <a class="code" href="class_MSLVector.html">MSLVector</a> dx(5);
00951   
00952 
00953   v = x[0]; r = x[1]; psi = x[4];
00954 
00955   alphaf = (v + Adist * r) / Speed - u[0];
00956   alphar = (v - Bdist * r) / Speed - u[1];
00957 
00958   <font class="comment">// Here is where the nonlinear tire model is used</font>
00959   <font class="comment">//  The result is new values for fyf and fyr</font>
00960   talff = tan(fabs(alphaf));
00961   talfr = tan(fabs(alphar));
00962   xiblf = (CAF*talff == 0) ? 
00963     INFINITY :
00964     Mu*Nf/(2.0*CAF*talff);
00965   xiblr = (CAR*talfr == 0) ? 
00966     INFINITY :
00967     Mu*Nr/(2.0*CAR*talfr);
00968   fyf = (xiblf &gt;= 1.0) ?
00969     CAF*talff :
00970     Mu*Nf*(1.0-0.5*xiblf);
00971   fyr = (xiblr &gt;= 1.0) ?
00972     CAR*talfr :
00973     Mu*Nr*(1.0-0.5*xiblr);
00974   fyf = (alphaf &gt; 0) ? -1.0*fabs(fyf) : fabs(fyf);
00975   fyr = (alphar &gt; 0) ? -1.0*fabs(fyr) : fabs(fyr);
00976 
00977   <font class="comment">//cout &lt;&lt; "talff: " &lt;&lt; talff &lt;&lt; "  xiblf: " &lt;&lt; xiblf &lt;&lt; " fyf: " &lt;&lt; fyf &lt;&lt; "\n";</font>
00978 
00979   <font class="comment">/* Transfer the velocity */</font>
00980   dx[0] = -Speed * r  + (fyf + fyr) / Mass;
00981   dx[1] = (fyf * Adist - fyr * Bdist) / Izz;
00982   dx[2] = Speed * cos(psi) - v * sin(psi);
00983   dx[3] = Speed * sin(psi) + v * cos(psi);
00984   dx[4] = r;
00985 
00986   <font class="comment">//cout &lt;&lt; "x: " &lt;&lt; x &lt;&lt; "  Dx: " &lt;&lt; dx &lt;&lt; "  u: " &lt;&lt; u[0] &lt;&lt; "\n";</font>
00987 
00988   <font class="keywordflow">return</font> dx;
00989 }
00990 
00991 
00992 
00993 
00994 
00995 
00996 
00997 <font class="comment">// *********************************************************************</font>
00998 <font class="comment">// *********************************************************************</font>
00999 <font class="comment">// CLASS:     Model2DRigidLander</font>
01000 <font class="comment">//  </font>
01001 <font class="comment">// *********************************************************************</font>
01002 <font class="comment">// *********************************************************************</font>
01003 
01004 <font class="comment">// Constructor</font>
<a name="l01005"></a><a class="code" href="class_Model2DRigidLander.html#a0">01005</a> <a class="code" href="class_Model2DRigidLander.html#a0">Model2DRigidLander::Model2DRigidLander</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model2DRigid.html">Model2DRigid</a>(path) {
01006   <a class="code" href="class_MSLVector.html">MSLVector</a> v;
01007 
01008   StateDim = 4;
01009   InputDim = 1;
01010   Mass = 1.0;
01011   G = 1.568;  <font class="comment">// Accel of gravity on moon (use 9.8 for earth)</font>
01012   Fs = 10.0;
01013   Fu = 20.0;
01014 
01015   LowerState = MSLVector(4);
01016   UpperState = MSLVector(4);
01017 
01018   LowerState[0] = 0.0; LowerState[1] = 0.0; LowerState[2] = -10.0; 
01019   LowerState[3] = -10.0; 
01020   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(LowerState);
01021 
01022   UpperState[0] = 100.0; UpperState[1] = 100.0; UpperState[2] = 10.0; 
01023   UpperState[3] = 10.0; 
01024   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(UpperState);
01025 
01026   <font class="comment">// Make the list of 1D Inputs</font>
01027   Inputs.clear();  <font class="comment">// Otherwise its parent constructor will make some inputs</font>
01028   v = MSLVector(1); v[0] = 0;
01029   Inputs.push_back(v);
01030   v = MSLVector(1); v[0] = 1;
01031   Inputs.push_back(v);
01032   v = MSLVector(1); v[0] = 2;
01033   Inputs.push_back(v);
01034   v = MSLVector(1); v[0] = 3;
01035   Inputs.push_back(v);
01036 
01037   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(Inputs);
01038 }
01039 
01040 
01041 
<a name="l01042"></a><a class="code" href="class_Model2DRigidLander.html#a2">01042</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidLander.html#a2">Model2DRigidLander::Integrate</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u, <font class="keyword">const</font> <font class="keywordtype">double</font> &amp;h)<font class="keyword">
</font>01043 <font class="keyword"></font>{
01044   <font class="keywordflow">return</font> <a class="code" href="class_Model.html#b0">RungeKuttaIntegrate</a>(x,u,h);
01045 }
01046 
01047 
01048 
<a name="l01049"></a><a class="code" href="class_Model2DRigidLander.html#a3">01049</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidLander.html#a3">Model2DRigidLander::StateToConfiguration</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> </font>{
01050   <font class="keywordflow">return</font> MSLVector(x[0],x[1],0.0); <font class="comment">// Yield a zero rotation every time</font>
01051 }
01052 
01053 
<a name="l01054"></a><a class="code" href="class_Model2DRigidLander.html#a4">01054</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidLander.html#a4">Model2DRigidLander::StateTransitionEquation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u)<font class="keyword">
</font>01055 <font class="keyword"></font>{
01056   <a class="code" href="class_MSLVector.html">MSLVector</a> dx(4);
01057 
01058   <font class="comment">/* Transfer the velocity */</font>
01059   dx[0] = x[2];
01060   dx[1] = x[3];
01061   dx[2] = 0.0;
01062   <font class="keywordflow">if</font> (u[0] == 1) 
01063     dx[2] = Fs;
01064   <font class="keywordflow">if</font> (u[0] == 3) 
01065     dx[2] = -Fs;
01066   dx[3] = -Mass*G;
01067   <font class="keywordflow">if</font> (u[0] == 2) 
01068     dx[3] += Fu;
01069 
01070   <font class="comment">//cout &lt;&lt; "x: " &lt;&lt; x &lt;&lt; "  Dx: " &lt;&lt; dx &lt;&lt; "  u: " &lt;&lt; u[0] &lt;&lt; "\n";</font>
01071 
01072   <font class="keywordflow">return</font> dx;
01073 }
01074 
01075 
01076 
01077 
01078 
<a name="l01079"></a><a class="code" href="class_Model2DRigidLander.html#a5">01079</a> <font class="keywordtype">double</font> <a class="code" href="class_Model2DRigidLander.html#a5">Model2DRigidLander::Metric</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2)<font class="keyword"> </font>{
01080   <font class="keywordtype">double</font> d = 0.0;
01081   <font class="keywordtype">int</font> i;
01082 
01083   <font class="keywordflow">for</font> (i = 0; i &lt; 4; i++) {
01084     d += sqrt(<a class="code" href="defs_h.html#a2">sqr</a>(x1[i] - x2[i]) / (UpperState[i] - LowerState[i]));
01085   }
01086   
01087   <font class="comment">//cout &lt;&lt; "x1: " &lt;&lt; x1 &lt;&lt; "  x2: " &lt;&lt; x2 &lt;&lt; "   Metric: " &lt;&lt; d &lt;&lt; "\n";</font>
01088 
01089   <font class="keywordflow">return</font> d;
01090 }
01091 
01092 
01093 
01094 
01095 <font class="comment">// *********************************************************************</font>
01096 <font class="comment">// *********************************************************************</font>
01097 <font class="comment">// CLASS:     Model2DRigidMulti</font>
01098 <font class="comment">// </font>
01099 <font class="comment">// *********************************************************************</font>
01100 <font class="comment">// *********************************************************************</font>
01101 
01102 
01103 <font class="comment">// Constructor</font>
<a name="l01104"></a><a class="code" href="class_Model2DRigidMulti.html#a0">01104</a> <a class="code" href="class_Model2DRigidMulti.html#a0">Model2DRigidMulti::Model2DRigidMulti</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model2DRigid.html">Model2DRigid</a>(path) {
01105   <a class="code" href="class_MSLVector.html">MSLVector</a> u;
01106   <font class="keywordtype">int</font> i,j;
01107 
01108   <a class="code" href="defs_h.html#a7">READ_PARAMETER_OR_ERROR</a>(NumBodies);
01109 
01110   StateDim = 3*NumBodies;
01111   InputDim = 3*NumBodies;
01112 
01113   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(LowerState,MSLVector(StateDim));
01114   <a class="code" href="defs_h.html#a6">READ_PARAMETER_OR_DEFAULT</a>(UpperState,MSLVector(StateDim));
01115 
01116   u = MSLVector(StateDim);
01117   Inputs.clear();
01118   <font class="keywordflow">for</font> (i = 0; i &lt; StateDim; i++) {
01119     <font class="keywordflow">for</font> (j = 0; j &lt; StateDim; j++)
01120       u[j] = (i==j) ? 1.0 : 0.0; 
01121     Inputs.push_back(u);
01122     <font class="keywordflow">for</font> (j = 0; j &lt; StateDim; j++)
01123       u[j] = (i==j) ? -1.0 : 0.0; 
01124     Inputs.push_back(u);
01125   }
01126 }
01127 
01128 
01129 
01130 
<a name="l01131"></a><a class="code" href="class_Model2DRigidMulti.html#a2">01131</a> <font class="keywordtype">double</font> <a class="code" href="class_Model2DRigidMulti.html#a2">Model2DRigidMulti::Metric</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2)<font class="keyword"> </font>{
01132 
01133   <font class="keywordtype">double</font> d,fd,dtheta;
01134   <font class="keywordtype">int</font> i;
01135 
01136   d = 0.0;
01137 
01138   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {
01139     fd = fabs(x1[3*i+2]-x2[3*i+2]);
01140     dtheta = <a class="code" href="defs_h.html#a3">min</a>(fd,2.0*PI - fd);
01141     d += <a class="code" href="defs_h.html#a2">sqr</a>(x1[3*i] - x2[3*i]);
01142     d += <a class="code" href="defs_h.html#a2">sqr</a>(x1[3*i+1] - x2[3*i+1]);
01143     d += <a class="code" href="defs_h.html#a2">sqr</a>(dtheta);
01144   }
01145 
01146   <font class="keywordflow">return</font> sqrt(d);
01147 }
01148 
01149 
01150 
<a name="l01151"></a><a class="code" href="class_Model2DRigidMulti.html#a4">01151</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidMulti.html#a4">Model2DRigidMulti::LinearInterpolate</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2, <font class="keyword">const</font> <font class="keywordtype">double</font> &amp;a)<font class="keyword"></font>{
01152   <a class="code" href="class_MSLVector.html">MSLVector</a> v;
01153   <font class="keywordtype">int</font> i;
01154 
01155   v = (1.0-a)*x1 + a*x2;
01156 
01157   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {
01158 
01159     <font class="keywordflow">if</font> (fabs(x2[3*i+2] - x1[3*i+2]) &gt; PI) {
01160       <font class="keywordflow">if</font> (x1[3*i+2] &gt; x2[3*i+2])
01161         v[3*i+2] = (1.0-a)*x1[3*i+2] + a*(x2[3*i+2]+2.0*PI);
01162       <font class="keywordflow">else</font>
01163         v[3*i+2] = (1.0-a)*(x1[3*i+2]+2.0*PI) + a*x2[3*i+2];
01164     }
01165     
01166     <font class="keywordflow">if</font> (v[3*i+2] &gt; PI)
01167       v[3*i+2] -= 2.0*PI;
01168 
01169   }
01170 
01171   <font class="keywordflow">return</font> v;
01172 
01173 }
01174 
01175 
01176 
<a name="l01177"></a><a class="code" href="class_Model2DRigidMulti.html#a3">01177</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidMulti.html#a3">Model2DRigidMulti::StateToConfiguration</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> 
</font>01178 <font class="keyword"></font>{
01179   <font class="keywordflow">return</font> x;
01180 }
01181 
01182 
01183 
01184 
01185 <font class="comment">// *********************************************************************</font>
01186 <font class="comment">// *********************************************************************</font>
01187 <font class="comment">// CLASS:     Model2DRigidChain</font>
01188 <font class="comment">//  </font>
01189 <font class="comment">// *********************************************************************</font>
01190 <font class="comment">// *********************************************************************</font>
01191 
<a name="l01192"></a><a class="code" href="class_Model2DRigidChain.html#a0">01192</a> <a class="code" href="class_Model2DRigidChain.html#a0">Model2DRigidChain::Model2DRigidChain</a>(string path = <font class="stringliteral">""</font>):<a class="code" href="class_Model2DRigid.html">Model2DRigid</a>(path) {
01193 
01194   <font class="keywordtype">int</font> i;
01195 
01196   <a class="code" href="defs_h.html#a7">READ_PARAMETER_OR_ERROR</a>(NumBodies);
01197 
01198   StopAngle = PI/1.5;
01199 
01200   StateDim = NumBodies+2;
01201   InputDim = NumBodies+2;
01202   
01203   <a class="code" href="defs_h.html#a7">READ_PARAMETER_OR_ERROR</a>(A);
01204   
01205   LowerState = MSLVector(NumBodies+2);
01206   UpperState = MSLVector(NumBodies+2);
01207 
01208   LowerState[0] = 0.0; 
01209   LowerState[1] = 0.0; 
01210   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {
01211     LowerState[i+2] = -StopAngle;
01212   }
01213   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(LowerState);
01214 
01215   UpperState[0] = 100.0; 
01216   UpperState[1] = 100.0; 
01217   <font class="keywordflow">for</font> (i = 0; i &lt; NumBodies; i++) {
01218     UpperState[i+2] = StopAngle;
01219   }
01220   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(LowerState);
01221 
01222 
01223   Inputs.clear();  <font class="comment">// Otherwise its parent constructor will make some inputs</font>
01224   <font class="comment">// NEED A DEFAULT HERE!!!!</font>
01225 
01226   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(Inputs);
01227 
01228 }
01229 
01230 
01231 
<a name="l01232"></a><a class="code" href="class_Model2DRigidChain.html#a4">01232</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidChain.html#a4">Model2DRigidChain::LinearInterpolate</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, 
01233                                             <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2, 
01234                                             <font class="keyword">const</font> <font class="keywordtype">double</font> &amp;a)<font class="keyword"> </font>{
01235   <font class="keywordflow">return</font> (1.0-a)*x1 + a*x2;
01236 }
01237 
01238 
01239 
<a name="l01240"></a><a class="code" href="class_Model2DRigidChain.html#a2">01240</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidChain.html#a2">Model2DRigidChain::StateToConfiguration</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> </font>{
01241   <a class="code" href="class_MSLVector.html">MSLVector</a> q;
01242   <font class="keywordtype">int</font> i;
01243   <font class="keywordtype">double</font> lx,ly,ltheta;
01244 
01245   q = MSLVector(3*NumBodies);
01246   q[0] = x[0];
01247   q[1] = x[1];
01248   q[2] = x[2];
01249 
01250   <font class="keywordflow">for</font> (i = 1; i &lt; NumBodies; i++) {
01251     lx = q[3*(i-1)];
01252     ly = q[3*(i-1)+1];
01253     ltheta = q[3*(i-1)+2];
01254 
01255     q[3*i] = cos(ltheta)*A[i-1]+lx;
01256     q[3*i+1] = sin(ltheta)*A[i-1]+ly;
01257     q[3*i+2] = atan2(cos(ltheta)*sin(x[2+i])+sin(ltheta)*cos(x[2+i]),
01258                      cos(ltheta)*cos(x[2+i])-sin(ltheta)*sin(x[2+i]));
01259     <font class="keywordflow">if</font> (q[3*i+2] &lt; 0.0)
01260       q[3*i+2] += 2.0*PI; <font class="comment">// Force the orientation into [0,2pi)</font>
01261   }
01262 
01263   <font class="keywordflow">return</font> q;
01264 }
01265 
01266 
01267 
01268 
<a name="l01269"></a><a class="code" href="class_Model2DRigidChain.html#a3">01269</a> <a class="code" href="class_MSLVector.html">MSLVector</a> <a class="code" href="class_Model2DRigidChain.html#a3">Model2DRigidChain::StateTransitionEquation</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;u)<font class="keyword"> </font>{
01270 
01271   <a class="code" href="class_MSLVector.html">MSLVector</a> dx(StateDim);
01272 
01273   dx = u;
01274   <font class="keywordflow">return</font> dx;
01275 }
01276 
01277 
01278 
<a name="l01279"></a><a class="code" href="class_Model2DRigidChain.html#a5">01279</a> <font class="keywordtype">double</font> <a class="code" href="class_Model2DRigidChain.html#a5">Model2DRigidChain::Metric</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x1, <font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x2)<font class="keyword"> </font>{
01280 
01281   <font class="keywordtype">double</font> rho;
01282   <a class="code" href="class_MSLVector.html">MSLVector</a> dtheta(StateDim);
01283   <font class="keywordtype">int</font> i;
01284   
01285   rho = <a class="code" href="defs_h.html#a2">sqr</a>(x1[0] - x2[0]) + <a class="code" href="defs_h.html#a2">sqr</a>(x1[1] - x2[1]);
01286 
01287   <font class="keywordflow">for</font> (i = 2; i &lt; StateDim; i++) {
01288     dtheta[i] = <a class="code" href="defs_h.html#a3">min</a>(fabs(x1[i]-x2[i]),2.0*PI - fabs(x1[i]-x2[i]));
01289     rho += <a class="code" href="defs_h.html#a2">sqr</a>(50.0/PI*dtheta[i]);
01290   }
01291 
01292   rho = sqrt(rho);
01293 
01294   <font class="keywordflow">return</font> rho;
01295 }
01296 
01297 
01298 <font class="comment">// Make sure the joint position and limits are respected</font>
<a name="l01299"></a><a class="code" href="class_Model2DRigidChain.html#a6">01299</a> <font class="keywordtype">bool</font> <a class="code" href="class_Model2DRigidChain.html#a6">Model2DRigidChain::Satisfied</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword"> 
</font>01300 <font class="keyword"></font>{
01301   <font class="keywordtype">int</font> i;
01302 
01303   <font class="keywordflow">for</font> (i = 0; i &lt; StateDim; i++)
01304     <font class="keywordflow">if</font> ((x[i] &gt; UpperState[i]) || (x[i] &lt; LowerState[i]))
01305       <font class="keywordflow">return</font> <font class="keyword">false</font>;
01306 
01307   <font class="keywordflow">return</font> <font class="keyword">true</font>;
01308 }
01309 
01310 
01311 
</div></pre><HEAD>
<TITLE>Motion Strategy Library</TITLE>
</HEAD>

<p>

<hr>

Web page maintained by 
<a href="http://janowiec.cs.iastate.edu/~lavalle">Steve LaValle</a><br>

Partial support provided by NSF CAREER Award IRI-970228 (LaValle),
Honda Research, and Iowa State University.<br>

Contributors:  Anna Atramentov, Peng Cheng, James Kuffner, Steve LaValle, and Libo Yang.<br>
