<HEAD>
<TITLE>Motion Strategy Library</TITLE>
</HEAD>

<body bgcolor="#ffffff">

<center><img src="msl.jpg"></center>

<p>


<!-- Generated by Doxygen 1.2.2 on Wed Aug 29 23:26:44 2001 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>rendergl.C</h1><a href="rendergl_C.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">//----------------------------------------------------------------------</font>
00002 <font class="comment">//               The Motion Strategy Library (MSL)</font>
00003 <font class="comment">//----------------------------------------------------------------------</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// Copyright (c) 1998-2000 Iowa State University and Steve LaValle.  </font>
00006 <font class="comment">// All Rights Reserved.</font>
00007 <font class="comment">// </font>
00008 <font class="comment">// Permission to use, copy, and distribute this software and its </font>
00009 <font class="comment">// documentation is hereby granted free of charge, provided that </font>
00010 <font class="comment">// (1) it is not a component of a commercial product, and </font>
00011 <font class="comment">// (2) this notice appears in all copies of the software and</font>
00012 <font class="comment">//     related documentation. </font>
00013 <font class="comment">// </font>
00014 <font class="comment">// Iowa State University and the author make no representations</font>
00015 <font class="comment">// about the suitability or fitness of this software for any purpose.  </font>
00016 <font class="comment">// It is provided "as is" without express or implied warranty.</font>
00017 <font class="comment">//----------------------------------------------------------------------</font>
00018 
00019 <font class="preprocessor">#include &lt;math.h&gt;</font>
00020 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00021 
00022 <font class="preprocessor">#include "<a class="code" href="rendergl_h.html">rendergl.h</a>"</font>
00023 <font class="preprocessor">#include "<a class="code" href="defs_h.html">defs.h</a>"</font>
00024 
00025 <font class="comment">// Because the callback methods are static members that are not allowed by</font>
00026 <font class="comment">// glut to take an arguments, we have to recover the class data.  There </font>
00027 <font class="comment">// must be a better way...</font>
<a name="l00028"></a><a class="code" href="rendergl_C.html#a0">00028</a> <a class="code" href="class_RenderGL.html">RenderGL</a> *RGL;
00029 
00030 
00032 <font class="comment">//</font>
00033 <font class="comment">// RenderGL Class</font>
00034 <font class="comment">//
</font>00036 <font class="comment"></font>
<a name="l00037"></a><a class="code" href="class_RenderGL.html#a0">00037</a> <a class="code" href="class_RenderGL.html#a0">RenderGL::RenderGL</a>(): <a class="code" href="class_Render.html">Render</a>()
00038 {
00039   WindowX = 600.0; 
00040   WindowY = 600.0;
00041   WindowZ = 600.0;
00042 
00043   NumberOfObject = 0;
00044   NumberOfBody = 0;
00045   NumberOfEnvObj = 0;
00046 
00047   SceneBodyLib = <font class="keyword">new</font> (<a class="code" href="class_mslGLObject.html">mslGLObject</a> *);
00048   SceneEnvObjLib = <font class="keyword">new</font> (<a class="code" href="class_mslGLObject.html">mslGLObject</a> *); 
00049 
00050   RGL = <font class="keyword">this</font>;
00051   ControlFreak = <font class="keyword">true</font>;
00052 }
00053 
00054 
<a name="l00055"></a><a class="code" href="class_RenderGL.html#a1">00055</a> <a class="code" href="class_RenderGL.html#a0">RenderGL::RenderGL</a>(string filepath=<font class="stringliteral">""</font>): <a class="code" href="class_Render.html">Render</a>(filepath)
00056 {
00057   WindowX = 600.0; 
00058   WindowY = 600.0;
00059   WindowZ = 600.0;
00060 
00061   NumberOfObject = 0;
00062   NumberOfBody = 0;
00063   NumberOfEnvObj = 0;
00064 
00065   SceneBodyLib = <font class="keyword">new</font> (<a class="code" href="class_mslGLObject.html">mslGLObject</a> *);
00066   SceneEnvObjLib = <font class="keyword">new</font> (<a class="code" href="class_mslGLObject.html">mslGLObject</a> *); 
00067 
00068   RGL = <font class="keyword">this</font>;
00069   ControlFreak = <font class="keyword">true</font>;
00070 }
00071 
00072 
<a name="l00073"></a><a class="code" href="class_RenderGL.html#a2">00073</a> <a class="code" href="class_RenderGL.html#a0">RenderGL::RenderGL</a>(<a class="code" href="class_Scene.html">Scene</a> *s, string filepath): <a class="code" href="class_Render.html">Render</a>(s,filepath)
00074 {
00075   WindowX = 600.0; 
00076   WindowY = 600.0;
00077   WindowZ = 600.0;
00078 
00079   NumberOfObject = 0;
00080   NumberOfBody = 0;
00081   NumberOfEnvObj = 0;
00082 
00083   SceneBodyLib = <font class="keyword">new</font> (<a class="code" href="class_mslGLObject.html">mslGLObject</a> *);
00084   SceneEnvObjLib = <font class="keyword">new</font> (<a class="code" href="class_mslGLObject.html">mslGLObject</a> *); 
00085 
00086   RGL = <font class="keyword">this</font>;
00087   ControlFreak = <font class="keyword">true</font>;
00088 }
00089 
00090 
<a name="l00091"></a><a class="code" href="class_RenderGL.html#a3">00091</a> <a class="code" href="class_RenderGL.html#a3">RenderGL::~RenderGL</a>()<font class="keyword">
</font>00092 <font class="keyword"></font>{
00093   <font class="comment">// Delete a bunch of GL stuff</font>
00094 }
00095 
00096 
<a name="l00097"></a><a class="code" href="class_RenderGL.html#b1">00097</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b1">RenderGL::AddBodyObject</a>(<a class="code" href="class_mslGLObject.html">mslGLObject</a> * obj)<font class="keyword">
</font>00098 <font class="keyword"></font>{
00099   
00100   <font class="keywordflow">if</font>(SceneBodyLib == NULL)
00101     {
00102       <font class="keywordflow">if</font>((SceneBodyLib = (<a class="code" href="class_mslGLObject.html">mslGLObject</a> **) malloc(<font class="keyword">sizeof</font>(<a class="code" href="class_mslGLObject.html">mslGLObject</a> *))) == 0)
00103         {
00104           printf(<font class="stringliteral">"Error reallocating mem\n"</font>);
00105           exit(-1);       
00106         }      
00107     }
00108   <font class="keywordflow">else</font>
00109     <font class="keywordflow">if</font>((SceneBodyLib = (<a class="code" href="class_mslGLObject.html">mslGLObject</a> **) 
00110         realloc(SceneBodyLib, <font class="keyword">sizeof</font>(<a class="code" href="class_mslGLObject.html">mslGLObject</a> *)*(NumberOfBody+1))) == 0) 
00111       {
00112         printf(<font class="stringliteral">"Error reallocating mem\n"</font>);
00113         exit(-1);
00114       }
00115   
00116   SceneBodyLib[NumberOfBody] = obj;
00117   SceneBodyLib[NumberOfBody]-&gt;ID = NumberOfObject;
00118   
00119   NumberOfBody++;
00120   NumberOfObject++;
00121 }
00122 
<a name="l00123"></a><a class="code" href="class_RenderGL.html#b2">00123</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b2">RenderGL::AddEnvObject</a>(<a class="code" href="class_mslGLObject.html">mslGLObject</a> * obj)<font class="keyword">
</font>00124 <font class="keyword"></font>{
00125   
00126   <font class="keywordflow">if</font>(SceneEnvObjLib == NULL)
00127     {
00128       <font class="keywordflow">if</font>((SceneEnvObjLib = (<a class="code" href="class_mslGLObject.html">mslGLObject</a> **) malloc(<font class="keyword">sizeof</font>(<a class="code" href="class_mslGLObject.html">mslGLObject</a> *))) == 0)
00129         {
00130           printf(<font class="stringliteral">"Error reallocating mem\n"</font>);
00131           exit(-1);       
00132         }      
00133     }
00134   <font class="keywordflow">else</font>
00135     <font class="keywordflow">if</font>((SceneEnvObjLib = (<a class="code" href="class_mslGLObject.html">mslGLObject</a> **) 
00136         realloc(SceneEnvObjLib, <font class="keyword">sizeof</font>(<a class="code" href="class_mslGLObject.html">mslGLObject</a> *) * (NumberOfEnvObj+1))) == 0) 
00137       {
00138         printf(<font class="stringliteral">"Error reallocating mem\n"</font>);
00139         exit(-1);
00140       }
00141 
00142   SceneEnvObjLib[NumberOfEnvObj] = obj;
00143   SceneEnvObjLib[NumberOfEnvObj]-&gt;ID = NumberOfObject;
00144 
00145   NumberOfEnvObj++;
00146   NumberOfObject++;
00147 }
00148 
00149 
<a name="l00150"></a><a class="code" href="class_RenderGL.html#b3">00150</a> <a class="code" href="class_mslGLObject.html">mslGLObject</a>* <a class="code" href="class_RenderGL.html#b3">RenderGL::WhichObject</a>(<font class="keywordtype">int</font> id)<font class="keyword">
</font>00151 <font class="keyword"></font>{
00152   <font class="keywordtype">int</font> i;
00153 
00154   <font class="keywordflow">for</font>(i=0; i&lt;NumberOfBody; i++)
00155     <font class="keywordflow">if</font>(SceneBodyLib[i]-&gt;ID == id) <font class="keywordflow">return</font> SceneBodyLib[i];
00156 
00157   <font class="keywordflow">for</font>(i=0; i&lt;NumberOfEnvObj; i++)
00158     <font class="keywordflow">if</font>(SceneEnvObjLib[i]-&gt;ID == id) <font class="keywordflow">return</font> SceneEnvObjLib[i];
00159 
00160   cout &lt;&lt; <font class="stringliteral">"Object ID allocation error"</font> &lt;&lt; endl;
00161   exit(-1);  
00162 }
00163 
00164 
<a name="l00165"></a><a class="code" href="class_RenderGL.html#a4">00165</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#a4">RenderGL::Reset</a>()<font class="keyword">
</font>00166 <font class="keyword"></font>{
00167   <font class="comment">// Use reset from base class</font>
00168   <a class="code" href="class_Render.html#a7">Render::Reset</a>();
00169 
00170   Fov = 45.0;      AspectRatio = 1.0;
00171   Near = 10.0;     Far = 100000.0;
00172   VupX = 0.0,      VupY = 1.0,          VupZ = 0.0;
00173 
00174   EyeX = (BoundingBoxMax[0] + BoundingBoxMin[0])/2.0;
00175   EyeY = (BoundingBoxMax[1] + BoundingBoxMin[1])/2.0;  
00176   EyeZ = BoundingBoxMax[2] + (BoundingBoxMax[1]-BoundingBoxMin[1])/tan(38.0/180.0*PI);
00177 
00178   VpX = (BoundingBoxMax[0] + BoundingBoxMin[0])/2.0;
00179   VpY = (BoundingBoxMax[1] + BoundingBoxMin[1])/2.0;
00180   VpZ = (BoundingBoxMax[2] + BoundingBoxMin[2])/2.0;
00181 
00182   LightPosX = EyeX;
00183   LightPosY = EyeY + (BoundingBoxMax[1] - BoundingBoxMin[1]);
00184   LightPosZ = BoundingBoxMax[2] + (BoundingBoxMax[1]-BoundingBoxMin[1])/tan(38.0/180.0*PI)/2.0;
00185 
00186   Orientation[0] = 0.0;   Orientation[1] = 0.0;          Orientation[2] = 0.0;
00187   Position[0] = 0.0;    Position[1] = 0.0;           Position[2] = 0.0; 
00188 }
00189 
00190 
<a name="l00191"></a><a class="code" href="class_RenderGL.html#b18">00191</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b18">RenderGL::ShowCoordinateFrame</a>()<font class="keyword">
</font>00192 <font class="keyword"></font>{
00193   <a class="code" href="class_MSLVector.html">MSLVector</a> pos(3);
00194   <a class="code" href="class_MSLVector.html">MSLVector</a> scenecenter(3);
00195 
00196   glDisable(GL_TEXTURE_2D);
00197   glDisable(GL_LIGHTING);
00198 
00199   glPushMatrix();
00200 
00201   scenecenter[0] = (RGL-&gt;BoundingBoxMin[0] + RGL-&gt;BoundingBoxMax[0])/2.0;
00202   scenecenter[1] = (RGL-&gt;BoundingBoxMin[1] + RGL-&gt;BoundingBoxMax[1])/2.0;
00203   scenecenter[2] = (RGL-&gt;BoundingBoxMin[2] + RGL-&gt;BoundingBoxMax[2])/2.0;
00204   
00205   glTranslatef(scenecenter[0], scenecenter[1], scenecenter[2]);
00206 
00207   GLfloat Diffuse[] = {1.0, 0.0, 0.0};
00208   GLfloat Ambient[] = {1.0, 0.0, 0.0};
00209   GLfloat Specular[] = {1.0, 0.0, 0.0};
00210   GLfloat Shininess[] = {1.0, 0.0, 0.0};
00211 
00212   glLineWidth(0.2);
00213 
00214   glMaterialfv(GL_FRONT, GL_DIFFUSE, Diffuse);
00215   glMaterialfv(GL_FRONT, GL_AMBIENT, Ambient);
00216   glMaterialfv(GL_FRONT, GL_SPECULAR, Specular);
00217   glMaterialfv(GL_FRONT, GL_SHININESS, Shininess);
00218 
00219   glBegin(GL_LINES);
00220 
00221   <font class="comment">// x axis</font>
00222   glColor4f(1.0, 0.0, 0.0, 1.0);
00223   glVertex3f(0.0, 0.0, 0.0);
00224   glVertex3f(10.0, 0.0, 0.0);
00225   glVertex3f(10.0, 1.0, 0.0);
00226   glVertex3f(12.0, -1.0, 0.0);
00227   glVertex3f(10.0, -1.0, 0.0);
00228   glVertex3f(12.0, 1.0, 0.0);
00229 
00230   <font class="comment">// y axis</font>
00231   glColor4f(0.0, 1.0, 0.0, 1.0);
00232   glVertex3f(0.0, 0.0, 0.0);
00233   glVertex3f(0.0, 10.0, 0.0);
00234   glVertex3f(0.707, 12.707, 0.0);
00235   glVertex3f(0.0, 12.0, 0.0);
00236   glVertex3f(-0.707, 12.707, 0.0);
00237   glVertex3f(0.0, 12.0, 0.0);
00238   glVertex3f(0.0, 11.0, 0.0);
00239   glVertex3f(0.0, 12.0, 0.0);
00240 
00241   <font class="comment">// z axis</font>
00242   glColor4f(0.0, 0.0, 1.0, 1.0);
00243   glVertex3f(0.0, 0.0, 0.0);
00244   glVertex3f(0.0, 0.0, 10.0);
00245   glVertex3f(-1.0, 1.0, 10.0);
00246   glVertex3f(1.0, 1.0, 10.0);
00247   glVertex3f(-1.0, -1.0, 10.0);
00248   glVertex3f(1.0, -1.0, 10.0);
00249   glVertex3f(1.0, 1.0, 10.0);
00250   glVertex3f(-1.0, -1.0, 10.0);
00251 
00252   glEnd();
00253 
00254   glLineWidth(1.0);
00255   glEnable(GL_TEXTURE_2D);
00256   glEnable(GL_LIGHTING);
00257 
00258   glPopMatrix();
00259 
00260 }
00261 
00262 
00263 
<a name="l00264"></a><a class="code" href="class_RenderGL.html#a5">00264</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#a5">RenderGL::Init</a>()<font class="keyword"></font>{
00265   <a class="code" href="class_Render.html#a4">Render::Init</a>();
00266 
00267   <font class="keywordtype">int</font> argc = 2;
00268   <font class="keywordtype">char</font> *argv[] = {<font class="stringliteral">"Dummy1"</font>,<font class="stringliteral">"Dummy2"</font>};
00269 
00270   glutInit(&amp;argc,  argv);
00271   glutInitDisplayMode(GLUT_RGBA | GLUT_DEPTH | GLUT_DOUBLE);
00272   glutInitWindowSize((GLint) WindowX, (GLint) WindowY);
00273   glutInitWindowPosition(200,0);
00274   MainWindow = glutCreateWindow(<font class="stringliteral">"MSL Library   Iowa State University"</font>);
00275   
00276   glEnable(GL_DEPTH_TEST);
00277   glShadeModel(GL_SMOOTH);
00278   glEnable(GL_NORMALIZE);
00279 
00280   GLfloat light_direction []= {0.5, 0.5, -1.5}; 
00281   GLfloat light_diffuse[] = {0.6, 0.4, 0.5, 1.0};
00282   GLfloat light_specular[] = {0.3, 0.6, 0.5, 1.0};
00283   GLfloat light_ambient[] = {AmbientLight, AmbientLight, AmbientLight, 1.0};
00284   glLightfv(GL_LIGHT0, GL_SPOT_DIRECTION, light_direction);
00285   glLightfv(GL_LIGHT0, GL_DIFFUSE, light_diffuse);
00286   glLightfv(GL_LIGHT0, GL_SPECULAR, light_specular);
00287   glLightfv(GL_LIGHT0, GL_AMBIENT, light_ambient);
00288   glEnable(GL_LIGHTING);
00289   glEnable(GL_LIGHT0);
00290   
00291   <font class="comment">// setting the material properties</font>
00292   GLfloat amb_diff [] = {0.3, 0.5, 0.7, 1.0};
00293   GLfloat specular [] = { 0.8, 0.5, 0.5, 1.0 };
00294   GLfloat shininess [] = { 60.0 };
00295   glMaterialfv(GL_FRONT, GL_AMBIENT_AND_DIFFUSE, amb_diff); 
00296   glMaterialfv(GL_FRONT, GL_SPECULAR, specular);
00297   glMaterialfv(GL_FRONT, GL_SHININESS, shininess);
00298   glColorMaterial(GL_FRONT, GL_AMBIENT_AND_DIFFUSE);
00299   glEnable(GL_COLOR_MATERIAL);
00300   
00301   glDepthFunc(GL_LEQUAL);
00302   glEnable(GL_DEPTH_TEST);
00303   glEnable(GL_TEXTURE_2D);
00304 
00305   <font class="comment">// read the configuration file to read appropriate model file</font>
00306   <a class="code" href="class_RenderGL.html#b12">InitData</a>();
00307 
00308   glClearColor(0.0,  0.0,  0.0,  0.0); 
00309   glViewport((GLint)0.0, (GLint)0.0, (GLsizei)WindowX, (GLsizei)WindowY);
00310   glMatrixMode( GL_PROJECTION );
00311   glLoadIdentity();
00312   gluPerspective(Fov, AspectRatio, Near, Far);
00313   glMatrixMode(GL_MODELVIEW);
00314   glLoadIdentity();
00315   gluLookAt(EyeX, EyeY, EyeZ, VpX, VpY, VpZ, VupX, VupY, VupZ);
00316 
00317   glutReshapeFunc( GlutReshape );
00318   glutMouseFunc( GlutMouse );
00319   glutMotionFunc( GlutMouseMove );
00320   glutDisplayFunc( GlutDrawEnvironment );
00321   glutIdleFunc( GlutIdleProcessing );
00322   glutKeyboardFunc( GlutKeyboard );  
00323   
00324 }
00325 
00326 
<a name="l00327"></a><a class="code" href="class_RenderGL.html#b0">00327</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b0">RenderGL::LoadConfig</a>()<font class="keyword">
</font>00328 <font class="keyword"></font>{
00329 
00330   <font class="keywordtype">int</font> i;
00331 
00332   BodyTransform = MSLVector(9 * NumberOfBody);
00333   <font class="keywordflow">for</font>(i=0; i&lt;NumberOfBody; i++) 
00334     {
00335       BodyTransform[9*i+0] = 0.0;  BodyTransform[9*i+1] = 0.0;  
00336       BodyTransform[9*i+2] = 0.0;
00337       BodyTransform[9*i+3] = 0.0;  BodyTransform[9*i+4] = 0.0;  
00338       BodyTransform[9*i+5] = 0.0;
00339       BodyTransform[9*i+6] = 1.0;  BodyTransform[9*i+7] = 1.0;  
00340       BodyTransform[9*i+8] = 1.0;
00341     }
00342   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(BodyTransform);
00343   
00344   <a class="code" href="class_RenderGL.html#b8">SetBodyState</a>(BodyTransform);
00345   
00346   EnvTransform = MSLVector(9 * NumberOfEnvObj);
00347   <font class="keywordflow">for</font>(i=0; i&lt;NumberOfEnvObj; i++)
00348     {
00349       EnvTransform[9*i+0] = 0.0;  EnvTransform[9*i+1] = 0.0;  
00350       EnvTransform[9*i+2] = 0.0;
00351       EnvTransform[9*i+3] = 0.0;  EnvTransform[9*i+4] = 0.0;  
00352       EnvTransform[9*i+5] = 0.0;
00353       EnvTransform[9*i+6] = 1.0;  EnvTransform[9*i+7] = 1.0;  
00354       EnvTransform[9*i+8] = 1.0;
00355     }
00356   <a class="code" href="defs_h.html#a5">READ_OPTIONAL_PARAMETER</a>(EnvTransform);
00357 
00358   <a class="code" href="class_RenderGL.html#b9">SetEnvState</a>(EnvTransform);
00359 }
00360 
00361 
<a name="l00362"></a><a class="code" href="class_RenderGL.html#b8">00362</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b8">RenderGL::SetBodyState</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a>&amp; state)<font class="keyword">
</font>00363 <font class="keyword"></font>{
00364   <font class="keywordtype">int</font> i;
00365   <a class="code" href="class_MSLVector.html">MSLVector</a> vpos(3), vori(3), sca(3);
00366 
00367   <font class="keywordflow">if</font>(state.<a class="code" href="class_MSLVector.html#a8">dim</a>() - NumberOfBody * 6 == 0)
00368     {
00369       <font class="keywordflow">for</font>(i=0; i&lt;NumberOfBody; i++)
00370         {
00371           vpos[0] = state[i*6];
00372           vpos[1] = state[i*6+1];
00373           vpos[2] = state[i*6+2];
00374           vori[0] = state[i*6+3];
00375           vori[1] = state[i*6+4];
00376           vori[2] = state[i*6+5];
00377           
00378           SceneBodyLib[i]-&gt;<a class="code" href="class_mslGLObject.html#a15">SetObjectPosition</a>(vpos);
00379           SceneBodyLib[i]-&gt;<a class="code" href="class_mslGLObject.html#a16">SetObjectOrientation</a>(vori);      
00380         }
00381     }
00382   <font class="keywordflow">else</font>
00383     <font class="keywordflow">if</font>(state.<a class="code" href="class_MSLVector.html#a8">dim</a>() - 9 * NumberOfBody == 0)
00384       {
00385         <font class="keywordflow">for</font>(i=0; i&lt;NumberOfBody; i++)
00386           {
00387             vpos[0] = state[i*9];
00388             vpos[1] = state[i*9+1];
00389             vpos[2] = state[i*9+2];
00390             vori[0] = state[i*9+3];
00391             vori[1] = state[i*9+4];
00392             vori[2] = state[i*9+5];
00393             sca[0] = state[i*9+6];
00394             sca[1] = state[i*9+7];
00395             sca[2] = state[i*9+8];
00396       
00397             SceneBodyLib[i]-&gt;<a class="code" href="class_mslGLObject.html#a15">SetObjectPosition</a>(vpos);
00398             SceneBodyLib[i]-&gt;<a class="code" href="class_mslGLObject.html#a16">SetObjectOrientation</a>(vori);     
00399             SceneBodyLib[i]-&gt;<a class="code" href="class_mslGLObject.html#a17">SetObjectScale</a>(sca);   
00400           }
00401       }
00402   <font class="keywordflow">else</font>
00403     cout &lt;&lt; <font class="stringliteral">"BodyEnf File information error"</font> &lt;&lt; endl;
00404 }
00405 
00406 
<a name="l00407"></a><a class="code" href="class_RenderGL.html#b9">00407</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b9">RenderGL::SetEnvState</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a>&amp; state)<font class="keyword">
</font>00408 <font class="keyword"></font>{
00409   <font class="keywordtype">int</font> i;
00410   <a class="code" href="class_MSLVector.html">MSLVector</a> vpos(3), vori(3), sca(3);
00411 
00412   <font class="keywordflow">if</font>(state.<a class="code" href="class_MSLVector.html#a8">dim</a>() / 9 == NumberOfEnvObj)
00413     {
00414       <font class="keywordflow">for</font>(i=0; i&lt;NumberOfEnvObj; i++)
00415         {
00416           vpos[0] = state[i*9];
00417           vpos[1] = state[i*9+1];
00418           vpos[2] = state[i*9+2];
00419           vori[0] = state[i*9+3];
00420           vori[1] = state[i*9+4];
00421           vori[2] = state[i*9+5];
00422           sca[0] = state[i*9+6];
00423           sca[1] = state[i*9+7];
00424           sca[2] = state[i*9+8];
00425           
00426           SceneEnvObjLib[i]-&gt;<a class="code" href="class_mslGLObject.html#a15">SetObjectPosition</a>(vpos);
00427           SceneEnvObjLib[i]-&gt;<a class="code" href="class_mslGLObject.html#a16">SetObjectOrientation</a>(vori);     
00428           SceneEnvObjLib[i]-&gt;<a class="code" href="class_mslGLObject.html#a17">SetObjectScale</a>(sca);   
00429         }
00430     }
00431   <font class="keywordflow">else</font>
00432     cout &lt;&lt; <font class="stringliteral">"EnvTransform file information error"</font> &lt;&lt; endl;
00433 }
00434 
00435 
00436 
<a name="l00437"></a><a class="code" href="class_RenderGL.html#b12">00437</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b12">RenderGL::InitData</a>()<font class="keyword"></font>{
00438   list&lt;MSLTriangle&gt; trlist;
00439   list&lt;MSLPolygon&gt; plist;
00440   list&lt;string&gt;::iterator fname;
00441   <font class="keywordtype">int</font> i;
00442   <a class="code" href="class_mslGLObject.html">mslGLObject</a> * tobj;
00443   <a class="code" href="class_MSLMatrix.html">MSLMatrix</a> R(3,3);
00444 
00445   AnimationActive = <font class="keyword">false</font>;
00446   CurrentObject = -1;
00447 
00448   CurrentKeyboard = ORI_MOVE_MODE;
00449 
00450   Fov = 45.0;      AspectRatio = 1.0;
00451   Near = 1.0;     Far = 100000.0;
00452   VupX = 0.0,      VupY = 1.0,          VupZ = 0.0;
00453 
00454   LightPosX = 1.0; LightPosY = 1.0;     LightPosZ = 3.0;
00455 
00456   ChangeRate = 4.0;
00457 
00458   AnimationTimeScaleTmp = 0.0;
00459 
00460   Orientation[0] = 0.0;   Orientation[1] = 0.0;          Orientation[2] = 0.0;
00461   Position[0] = 0.0;      Position[1] = 0.0;             Position[2] = 0.0; 
00462 
00463   <font class="comment">// set the upperworld and lowerworld</font>
00464   BoundingBoxMin[0] = S-&gt;LowerWorld[0];
00465   BoundingBoxMin[1] = S-&gt;LowerWorld[1];
00466   BoundingBoxMin[2] = S-&gt;LowerWorld[2];
00467 
00468   BoundingBoxMax[0] = S-&gt;UpperWorld[0];
00469   BoundingBoxMax[1] = S-&gt;UpperWorld[1];
00470   BoundingBoxMax[2] = S-&gt;UpperWorld[2];
00471 
00472   <font class="comment">// set the eye position and view reference point accoring to the scene configuration</font>
00473   EyeX = (BoundingBoxMax[0] + BoundingBoxMin[0])/2.0;  
00474   EyeY = (BoundingBoxMax[1] + BoundingBoxMin[1])/2.0;  
00475   EyeZ = BoundingBoxMax[2] + (BoundingBoxMax[1]-BoundingBoxMin[1])/tan(38.0/180.0*PI);
00476 
00477   VpX = (BoundingBoxMax[0] + BoundingBoxMin[0])/2.0;
00478   VpY = (BoundingBoxMax[1] + BoundingBoxMin[1])/2.0; 
00479   VpZ = (BoundingBoxMax[2] + BoundingBoxMin[2])/2.0;
00480 
00481   <font class="comment">// set the view length</font>
00482   ViewLength = EyeZ - VpZ;
00483 
00484   <font class="comment">// set light position accoring to the viewer position</font>
00485   LightPosX = EyeX;
00486   LightPosY = EyeY + (BoundingBoxMax[1] - BoundingBoxMin[1]);
00487   LightPosZ = BoundingBoxMax[2] + (BoundingBoxMax[1]-BoundingBoxMin[1])/tan(38.0/180.0*PI)/2.0;
00488 
00489   <font class="comment">// set the view coordinate system by the viewer parameters</font>
00490   VCoordX = VCoordY = VCoordZ = MSLVector(3);
00491   VCoordZ = S-&gt;GlobalCameraDirection.norm();
00492   <a class="code" href="renderglobj_C.html#a11">normalMSLVector</a>(S-&gt;GlobalCameraZenith, S-&gt;GlobalCameraDirection, VCoordX);
00493   <a class="code" href="renderglobj_C.html#a11">normalMSLVector</a>(VCoordZ, VCoordX, VCoordY);
00494 
00495   <font class="comment">/*
</font>00496 <font class="comment">  R(0, 0) = VCoordX[0];   R(1, 0) = VCoordX[1];   R(2, 0) = VCoordX[2];
</font>00497 <font class="comment">  R(0, 1) = VCoordY[0];   R(1, 1) = VCoordY[1];   R(2, 1) = VCoordY[2];
</font>00498 <font class="comment">  R(0, 2) = VCoordZ[0];   R(1, 2) = VCoordZ[1];   R(2, 2) = VCoordZ[2];
</font>00499 <font class="comment">  
</font>00500 <font class="comment">  cout &lt;&lt; "viewer orientation matrix: " &lt;&lt; R &lt;&lt; endl;
</font>00501 <font class="comment">
</font>00502 <font class="comment">  VRpy = irpy(R);
</font>00503 <font class="comment">
</font>00504 <font class="comment">  DefVCoordX = DefVCoordY = DefVCoordZ = MSLVector(3);
</font>00505 <font class="comment">  DefVCoordZ[0] = 0.0;  DefVCoordZ[1] = 0.0;  DefVCoordZ[2] = -1.0;
</font>00506 <font class="comment">  DefVCoordY[0] = 0.0;  DefVCoordY[1] = 1.0;  DefVCoordY[2] = 0.0;
</font>00507 <font class="comment">  DefVCoordX[0] = -1.0;  DefVCoordX[1] = 0.0;  DefVCoordX[2] = 0.0;
</font>00508 <font class="comment">
</font>00509 <font class="comment">  R(0, 0) = DefVCoordX[0];   R(1, 0) = DefVCoordX[1];   R(2, 0) = DefVCoordX[2];
</font>00510 <font class="comment">  R(0, 1) = DefVCoordY[0];   R(1, 1) = DefVCoordY[1];   R(2, 1) = DefVCoordY[2];
</font>00511 <font class="comment">  R(0, 2) = DefVCoordZ[0];   R(1, 2) = DefVCoordZ[1];   R(2, 2) = DefVCoordZ[2];
</font>00512 <font class="comment">  
</font>00513 <font class="comment">  cout &lt;&lt; "Default viewer orientation matrix: " &lt;&lt; R &lt;&lt; endl;
</font>00514 <font class="comment">
</font>00515 <font class="comment">  DefVRpy = irpy(R);
</font>00516 <font class="comment">
</font>00517 <font class="comment">  RpyModification = (VRpy - DefVRpy) * 180 / PI;
</font>00518 <font class="comment">
</font>00519 <font class="comment">  cout &lt;&lt; "rpy angle: " &lt;&lt; RpyModification &lt;&lt; endl;
</font>00520 <font class="comment">
</font>00521 <font class="comment">  SCoordZ[0] = 0.0;  SCoordZ[1] = 0.0;  SCoordZ[2] = 1.0;
</font>00522 <font class="comment">  SCoordY[0] = 0.0;  SCoordY[1] = 1.0;  SCoordY[2] = 0.0;
</font>00523 <font class="comment">  SCoordX[0] = 1.0;  SCoordX[1] = 0.0;  SCoordX[2] = 0.0;
</font>00524 <font class="comment">  */</font>
00525 
00526   <font class="comment">// EnvList was initialized by Init in Render base class</font>
00527   EnvIndex = vector&lt;int&gt;(EnvList.size());
00528 
00529   i = 0;
00530   <a class="code" href="defs_h.html#a8">forall</a>(fname,EnvList)<font class="keyword"> </font>{    
00531 
00532     <font class="keywordflow">if</font> (fname-&gt;substr(fname-&gt;length()-3,3) == <font class="stringliteral">"obj"</font>)
00533       {
00534         
00535         cout &lt;&lt; <font class="stringliteral">"model file name: "</font> &lt;&lt; *fname &lt;&lt; endl;
00536         tobj = <font class="keyword">new</font> <a class="code" href="class_mslGLObject.html">mslGLObject</a>;
00537         tobj-&gt;<a class="code" href="class_mslGLObject.html#a2">ReadModelFile</a>(FilePath, *fname);
00538         <a class="code" href="class_RenderGL.html#b2">AddEnvObject</a>(tobj);
00539         EnvIndex[i] = -1;
00540       }
00541     <font class="keywordflow">else</font>
00542       {
00543         std::ifstream fin((FilePath + *fname).c_str());
00544         <font class="keywordflow">if</font> (S-&gt;GeomDim == 2) 
00545           {
00546             fin &gt;&gt; plist;
00547             trlist = <a class="code" href="triangle_h.html#a0">PolygonsToTriangles</a>(plist,5.0); <font class="comment">// Defined in triangle.C</font>
00548           }
00549         <font class="keywordflow">else</font>
00550           fin &gt;&gt; trlist;
00551         fin.close();
00552         EnvIndex[i] = glGenLists(1);
00553         glNewList(EnvIndex[i], GL_COMPILE);
00554         <a class="code" href="class_RenderGL.html#b13">InitGeometry</a>(trlist);
00555         glEndList();
00556         trlist.clear();
00557         plist.clear();
00558       }
00559     i++;
00560   }
00561 
00562   <font class="comment">// Bodies</font>
00563   BodyIndex = vector&lt;int&gt;(BodyList.size());
00564   i = 0;
00565   <a class="code" href="defs_h.html#a8">forall</a>(fname,BodyList)<font class="keyword"> </font>{
00566     <font class="keywordflow">if</font> (fname-&gt;substr(fname-&gt;length()-3,3) == <font class="stringliteral">"obj"</font>)
00567       {
00568         cout &lt;&lt; <font class="stringliteral">"model file name: "</font> &lt;&lt; *fname &lt;&lt; endl;
00569         
00570         tobj = <font class="keyword">new</font> <a class="code" href="class_mslGLObject.html">mslGLObject</a>;
00571         tobj-&gt;<a class="code" href="class_mslGLObject.html#a2">ReadModelFile</a>(FilePath, *fname);
00572         <a class="code" href="class_RenderGL.html#b1">AddBodyObject</a>(tobj);
00573         BodyIndex[i] = -1;
00574       }
00575     <font class="keywordflow">else</font>
00576       {
00577         std::ifstream fin2((FilePath + *fname).c_str());
00578         <font class="keywordflow">if</font> (S-&gt;GeomDim == 2) 
00579           {
00580             fin2 &gt;&gt; plist;
00581             trlist = <a class="code" href="triangle_h.html#a0">PolygonsToTriangles</a>(plist,3.0); <font class="comment">// Defined in 3Dtriangle.C</font>
00582           }
00583         <font class="keywordflow">else</font>
00584           fin2 &gt;&gt; trlist;
00585         fin2.close();
00586         BodyIndex[i] = glGenLists(1);
00587         glNewList(BodyIndex[i], GL_COMPILE);
00588         <a class="code" href="class_RenderGL.html#b13">InitGeometry</a>(trlist);
00589         glEndList();
00590         trlist.clear();
00591       }
00592     i++;
00593   }
00594 
00595   <a class="code" href="class_RenderGL.html#b0">LoadConfig</a>();
00596 
00597 }
00598 
00599 
00600 
<a name="l00601"></a><a class="code" href="class_RenderGL.html#b13">00601</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b13">RenderGL::InitGeometry</a>(list&lt;MSLTriangle&gt; triangles)<font class="keyword"></font>{
00602   <a class="code" href="class_mslGLObject.html">mslGLObject</a> tobj;
00603 
00604   list&lt;MSLTriangle&gt;::iterator t;
00605   GLfloat d1[3],d2[3],norm[3];
00606   glPushMatrix();
00607   glBegin(GL_TRIANGLES);
00608   <a class="code" href="defs_h.html#a8">forall</a>(t, triangles)<font class="keyword"></font>{
00609     d1[0] = (GLfloat)t-&gt;p2.xcoord() - (GLfloat)t-&gt;p1.xcoord();
00610     d1[1] = (GLfloat)t-&gt;p2.ycoord() - (GLfloat)t-&gt;p1.ycoord();
00611     d1[2] = (GLfloat)t-&gt;p2.zcoord() - (GLfloat)t-&gt;p1.zcoord();
00612 
00613     d2[0] = (GLfloat)t-&gt;p3.xcoord() - (GLfloat)t-&gt;p1.xcoord();
00614     d2[1] = (GLfloat)t-&gt;p3.ycoord() - (GLfloat)t-&gt;p1.ycoord();
00615     d2[2] = (GLfloat)t-&gt;p3.zcoord() - (GLfloat)t-&gt;p1.zcoord();
00616 
00617     <a class="code" href="class_RenderGL.html#b16">NormCrossProduct</a>(d1, d2, norm);
00618 
00619     glNormal3fv(norm);
00620 
00621     glVertex3f(t-&gt;p1.xcoord(), t-&gt;p1.ycoord(), t-&gt;p1.zcoord());
00622     glVertex3f(t-&gt;p2.xcoord(), t-&gt;p2.ycoord(), t-&gt;p2.zcoord());
00623     glVertex3f(t-&gt;p3.xcoord(), t-&gt;p3.ycoord(), t-&gt;p3.zcoord());
00624   }
00625   glEnd();
00626   glPopMatrix();
00627 }
00628 
00629 
00630 
00631 
<a name="l00632"></a><a class="code" href="class_RenderGL.html#b14">00632</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b14">RenderGL::DrawBodies</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a> &amp;x)<font class="keyword">
</font>00633 <font class="keyword"></font>{
00634 
00635   <font class="keywordtype">int</font> i, j;
00636   <a class="code" href="class_MSLVector.html">MSLVector</a> q(6),mq;
00637   <a class="code" href="class_MSLVector.html">MSLVector</a> tv(3);
00638 
00639   <font class="comment">// Use the forward kinematics to place all body configs in a big MSLVector</font>
00640   mq = x;
00641   
00642   j = 0;
00643 
00644   <font class="keywordflow">for</font> (i = 0; i &lt; S-&gt;NumBodies; i++) {
00645     <font class="comment">// Get the configuration</font>
00646     q[0] = mq[i*6]; q[1] = mq[i*6+1]; q[2] = mq[i*6+2]; 
00647     q[3] = mq[i*6+3]; q[4] = mq[i*6+4]; q[5] = mq[i*6+5]; 
00648     
00649     <font class="keywordflow">if</font>(BodyIndex[i] != -1)
00650       {
00651         <font class="comment">// draw the simple model objects</font>
00652 
00653         <font class="comment">// Change the colors for different bodies</font>
00654         glColor3f(RGBRed[(i+1) % RENDERCOLORS],
00655                   RGBGreen[(i+1) % RENDERCOLORS],
00656                   RGBBlue[(i+1) % RENDERCOLORS]);
00657         
00658         <font class="comment">// Dump the gl stuff</font>
00659         glPushMatrix();
00660 
00661         glTranslatef((GLfloat)q[0],(GLfloat)q[1],(GLfloat)q[2]);
00662         glRotatef((GLfloat)(q[5]*57.286),0,0,1.0);
00663         glRotatef((GLfloat)(q[4]*57.296),0,1.0,0);
00664         glRotatef((GLfloat)(q[3]*57.296),1.0,0,0);
00665         
00666         glCallList(BodyIndex[i]);
00667         
00668         glPopMatrix();
00669       }
00670     <font class="keywordflow">else</font>
00671       {
00672         <font class="comment">// draw complex 3d model objects</font>
00673 
00674         <font class="comment">// if it is in the animation process, continously change the state, </font>
00675         <font class="comment">// otherwise, keep the current state</font>
00676   
00677         <font class="keywordflow">if</font> (AnimationActive)
00678           {
00679             tv[0] = q[0]; tv[1] = q[1]; tv[2] = q[2];
00680             SceneBodyLib[j]-&gt;<a class="code" href="class_mslGLObject.html#a15">SetObjectPosition</a>(tv);
00681             tv[0] = q[3]*57.286; tv[1] = q[4]*57.286; tv[2] = q[5]*57.286;
00682             SceneBodyLib[j]-&gt;<a class="code" href="class_mslGLObject.html#a16">SetObjectOrientation</a>(tv);
00683           }
00684 
00685         <font class="comment">//  comment the object bounding box drawing</font>
00686         <font class="keywordflow">if</font> (BoundingBoxOn)
00687           SceneBodyLib[j]-&gt;<a class="code" href="class_mslGLObject.html#a13">ObjectBoundingBoxDraw</a>();
00688         SceneBodyLib[j]-&gt;<a class="code" href="class_mslGLObject.html#a12">ObjectDraw</a>();
00689         j++;
00690       }
00691   }
00692   
00693 }
00694 
00695 
<a name="l00696"></a><a class="code" href="class_RenderGL.html#b15">00696</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b15">RenderGL::DrawEnv</a>()<font class="keyword"></font>{
00697   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> i, j;
00698 
00699   j = 0;
00700 
00701   <font class="keywordflow">for</font> (i = 0; i &lt; EnvIndex.size(); i++)
00702     {
00703       <font class="keywordflow">if</font>(EnvIndex[i] != -1)
00704         {
00705           glPushMatrix();
00706           glColor3f(RGBRed[0],RGBGreen[0],RGBBlue[0]);  
00707           glCallList(EnvIndex[i]);
00708           glPopMatrix();
00709         }
00710       <font class="keywordflow">else</font>
00711         {
00712           <font class="keywordflow">if</font> (BoundingBoxOn)
00713             SceneEnvObjLib[j]-&gt;<a class="code" href="class_mslGLObject.html#a13">ObjectBoundingBoxDraw</a>();
00714           SceneEnvObjLib[j]-&gt;<a class="code" href="class_mslGLObject.html#a12">ObjectDraw</a>();
00715           j++;
00716         }
00717     }
00718 }
00719 
00720 
<a name="l00721"></a><a class="code" href="class_RenderGL.html#b16">00721</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b16">RenderGL::NormCrossProduct</a>(<font class="keywordtype">float</font> v1[3], <font class="keywordtype">float</font> v2[3], <font class="keywordtype">float</font> out[3])<font class="keyword">
</font>00722 <font class="keyword"></font>{
00723   out[0] = v1[1]*v2[2] - v1[2]*v2[1];
00724   out[1] = v1[2]*v2[0] - v1[0]*v2[2];
00725   out[2] = v1[0]*v2[1] - v1[1]*v2[0];
00726 
00727   <a class="code" href="class_RenderGL.html#b17">Normalize</a>(out);
00728 }
00729 
00730 
<a name="l00731"></a><a class="code" href="class_RenderGL.html#b17">00731</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b17">RenderGL::Normalize</a>(<font class="keywordtype">float</font> v[3])<font class="keyword"> 
</font>00732 <font class="keyword"></font>{
00733   GLfloat d = sqrt(v[0]*v[0] + v[1]*v[1] + v[2]*v[2]);
00734 
00735   v[0] /=d;
00736   v[1] /=d;
00737   v[2] /=d;
00738 }
00739 
00740 
00741 
<a name="l00742"></a><a class="code" href="class_RenderGL.html#a6">00742</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#a6">RenderGL::MainLoop</a>(<a class="code" href="class_Gui.html">Gui</a> *g)<font class="keyword"> </font>{
00743 
00744   g-&gt;Finished = <font class="keyword">false</font>;
00745   
00746   <font class="comment">// Store this in the gui pointer G (for callbacks)</font>
00747   G = g;
00748 
00749   glutMainLoop();
00750 
00751 }
00752 
00753 
00754 
00755 
<a name="l00756"></a><a class="code" href="class_RenderGL.html#b11">00756</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b11">RenderGL::DrawPath</a>()<font class="keyword">
</font>00757 <font class="keyword"></font>{ 
00758   <font class="keywordtype">int</font> i, j;
00759   <font class="keywordtype">int</font> BodyNum;
00760   <a class="code" href="class_MSLVector.html">MSLVector</a> state1;
00761   list&lt;MSLVector&gt;::iterator state2;
00762 
00763   glPushMatrix();
00764   glDisable(GL_TEXTURE_2D);
00765 
00766   GLfloat Diffuse[] = {1.0, 0.0, 0.0};
00767   GLfloat Ambient[] = {1.0, 0.0, 0.0};
00768   GLfloat Specular[] = {1.0, 0.0, 0.0};
00769   GLfloat Shininess[] = {1.0, 0.0, 0.0};
00770 
00771   glDisable(GL_LIGHTING);
00772   glLineWidth(0.5);
00773 
00774   glMaterialfv(GL_FRONT, GL_DIFFUSE, Diffuse);
00775   glMaterialfv(GL_FRONT, GL_AMBIENT, Ambient);
00776   glMaterialfv(GL_FRONT, GL_SPECULAR, Specular);
00777   glMaterialfv(GL_FRONT, GL_SHININESS, Shininess);
00778 
00779   glBegin(GL_LINES);
00780 
00781   state1 = FrameList.front();
00782   BodyNum = state1.<a class="code" href="class_MSLVector.html#a8">dim</a>() / 6;
00783   i = 0;
00784   <a class="code" href="defs_h.html#a8">forall</a>(state2, FrameList)<font class="keyword">
</font>00785 <font class="keyword">    </font>{
00786       <font class="keywordflow">if</font>(i != 0 &amp;&amp; i&lt;NumFrames)
00787         {
00788           <font class="keywordflow">for</font>(j=0; j&lt;BodyNum; j++)
00789             {
00790               glColor3f(RGBRed[(j+1) % RENDERCOLORS],
00791                         RGBGreen[(j+1) % RENDERCOLORS],
00792                         RGBBlue[(j+1) % RENDERCOLORS]);
00793 
00794               glVertex3f(state1[6*j], state1[6*j+1], state1[6*j+2]);
00795               glVertex3f(state2-&gt;<font class="keyword">operator</font>[](6*j), 
00796                          state2-&gt;operator[](6*j+1), 
00797                          state2-&gt;operator[](6*j+2));
00798             }
00799           state1 = *state2;
00800         }
00801       i++;
00802     }
00803 
00804   glEnd();
00805 
00806   glLineWidth(1.0);
00807 
00808   glEnable(GL_TEXTURE_2D);
00809   glEnable(GL_LIGHTING);
00810 
00811   glPopMatrix();
00812 }
00813 
00814 
00815 
<a name="l00816"></a><a class="code" href="class_RenderGL.html#d1">00816</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#d1">RenderGL::GlutDrawEnvironment</a>()<font class="keyword"> </font>{
00817 
00818   <font class="keywordtype">int</font> k, j;
00819   <a class="code" href="class_MSLVector.html">MSLVector</a> c, conf(6);
00820   <font class="keywordtype">float</font> vsca;
00821   <a class="code" href="class_MSLVector.html">MSLVector</a> vt1(3);
00822   <a class="code" href="class_MSLVector.html">MSLVector</a> scenecenter(3);
00823 
00824   scenecenter[0] = (RGL-&gt;BoundingBoxMin[0] + RGL-&gt;BoundingBoxMax[0])/2.0;
00825   scenecenter[1] = (RGL-&gt;BoundingBoxMin[1] + RGL-&gt;BoundingBoxMax[1])/2.0;
00826   scenecenter[2] = (RGL-&gt;BoundingBoxMin[2] + RGL-&gt;BoundingBoxMax[2])/2.0;
00827  
00828   RGL-&gt;<a class="code" href="class_RenderGL.html#b5">SetLightPos</a>();
00829 
00830   <font class="comment">// LaValle added these three lines 1/8/2001</font>
00831   GLfloat light_ambient[] = {RGL-&gt;AmbientLight, RGL-&gt;AmbientLight, 
00832                              RGL-&gt;AmbientLight, 1.0};
00833   glLightfv(GL_LIGHT0, GL_AMBIENT, light_ambient);
00834 
00835   glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
00836   
00837   <font class="comment">// Advance the frame</font>
00838   <font class="keywordflow">if</font> (RGL-&gt;AnimationActive)
00839     RGL-&gt;<a class="code" href="class_Render.html#b0">SetCurrentAnimationFrame</a>();
00840   
00841   <font class="keywordflow">if</font>(RGL-&gt;AttachedCameraOn)
00842     {
00843       <font class="comment">// get the current frameinformation</font>
00844       list&lt;MSLVector&gt;::iterator fi;
00845       fi = RGL-&gt;FrameList.begin();
00846       <font class="keywordflow">for</font> (k = 0; k &lt; RGL-&gt;AnimationFrameIndex - 1; k++)
00847         fi++;
00848       c = *fi;
00849 
00850       <font class="keywordflow">for</font> (j = 0; j &lt; 6; j++)
00851         conf[j] = c[ 6 * RGL-&gt;S-&gt;AttachedCameraBody + j];
00852       
00853       <font class="comment">// get the camera position and orientation in the scene coordinate</font>
00854       vt1 = RGL-&gt;S-&gt;AttachedCameraPosition;
00855       vt1 = <a class="code" href="renderglobj_C.html#a7">point_x_rotation</a>(conf[3], vt1);
00856       vt1 = <a class="code" href="renderglobj_C.html#a8">point_y_rotation</a>(conf[4], vt1);
00857       vt1 = <a class="code" href="renderglobj_C.html#a9">point_z_rotation</a>(conf[5], vt1);      
00858 
00859       vt1[0] = vt1[0] + conf[0];
00860       vt1[1] = vt1[1] + conf[1];
00861       vt1[2] = vt1[2] + conf[2];
00862 
00863       <font class="comment">// get the camera position and orientation in the global coordinate</font>
00864       vt1[0] = vt1[0] - scenecenter[0];
00865       vt1[1] = vt1[1] - scenecenter[1];
00866       vt1[2] = vt1[2] - scenecenter[2];
00867       
00868       vt1 = <a class="code" href="renderglobj_C.html#a7">point_x_rotation</a>(RGL-&gt;Orientation[0]*(PI/180.0), vt1);
00869       vt1 = <a class="code" href="renderglobj_C.html#a8">point_y_rotation</a>(RGL-&gt;Orientation[1]*(PI/180.0), vt1);
00870       vt1 = <a class="code" href="renderglobj_C.html#a9">point_z_rotation</a>(RGL-&gt;Orientation[2]*(PI/180.0), vt1);      
00871 
00872       vt1[0] = vt1[0] + scenecenter[0];
00873       vt1[1] = vt1[1] + scenecenter[1];
00874       vt1[2] = vt1[2] + scenecenter[2];
00875            
00876       vt1[0] = vt1[0] + RGL-&gt;Position[0];
00877       vt1[1] = vt1[1] + RGL-&gt;Position[1];
00878       vt1[2] = vt1[2] + RGL-&gt;Position[2];
00879 
00880       RGL-&gt;EyeX = vt1[0];
00881       RGL-&gt;EyeY = vt1[1];
00882       RGL-&gt;EyeZ = vt1[2];
00883 
00884       vt1 = RGL-&gt;S-&gt;AttachedCameraDirection;
00885 
00886       <font class="comment">// get the direction in the scene coordinate</font>
00887       vt1 = <a class="code" href="renderglobj_C.html#a7">point_x_rotation</a>(conf[3], vt1);
00888       vt1 = <a class="code" href="renderglobj_C.html#a8">point_y_rotation</a>(conf[4], vt1);
00889       vt1 = <a class="code" href="renderglobj_C.html#a9">point_z_rotation</a>(conf[5], vt1);      
00890 
00891       <font class="comment">// get the direction in the global coordinate</font>
00892       vt1 = <a class="code" href="renderglobj_C.html#a7">point_x_rotation</a>(RGL-&gt;Orientation[0]*(PI/180.0), vt1);
00893       vt1 = <a class="code" href="renderglobj_C.html#a8">point_y_rotation</a>(RGL-&gt;Orientation[1]*(PI/180.0), vt1);
00894       vt1 = <a class="code" href="renderglobj_C.html#a9">point_z_rotation</a>(RGL-&gt;Orientation[2]*(PI/180.0), vt1);      
00895 
00896       vsca = RGL-&gt;ViewLength / vt1.<a class="code" href="class_MSLVector.html#a14">length</a>();
00897 
00898       RGL-&gt;VpX = RGL-&gt;EyeX + vt1[0]*vsca;
00899       RGL-&gt;VpY = RGL-&gt;EyeY + vt1[1]*vsca;
00900       RGL-&gt;VpZ = RGL-&gt;EyeZ + vt1[2]*vsca;
00901 
00902       vt1 = RGL-&gt;S-&gt;AttachedCameraZenith;
00903       <font class="comment">// get the zenith in the scene coordinate</font>
00904       vt1 = <a class="code" href="renderglobj_C.html#a7">point_x_rotation</a>(conf[3], vt1);
00905       vt1 = <a class="code" href="renderglobj_C.html#a8">point_y_rotation</a>(conf[4], vt1);
00906       vt1 = <a class="code" href="renderglobj_C.html#a9">point_z_rotation</a>(conf[5], vt1);
00907 
00908       <font class="comment">// get the direction in the global coordinate</font>
00909       vt1 = <a class="code" href="renderglobj_C.html#a7">point_x_rotation</a>(RGL-&gt;Orientation[0]*(PI/180.0), vt1);
00910       vt1 = <a class="code" href="renderglobj_C.html#a8">point_y_rotation</a>(RGL-&gt;Orientation[1]*(PI/180.0), vt1);
00911       vt1 = <a class="code" href="renderglobj_C.html#a9">point_z_rotation</a>(RGL-&gt;Orientation[2]*(PI/180.0), vt1);      
00912 
00913       RGL-&gt;VupX = vt1[0];
00914       RGL-&gt;VupY = vt1[1];
00915       RGL-&gt;VupZ = vt1[2];
00916 
00917       RGL-&gt;Fov = 70.0;
00918     }
00919   <font class="keywordflow">else</font>
00920     {
00921       vsca = RGL-&gt;ViewLength / RGL-&gt;S-&gt;GlobalCameraDirection.length();
00922 
00923       RGL-&gt;EyeX = RGL-&gt;S-&gt;GlobalCameraPosition[0];
00924       RGL-&gt;EyeY = RGL-&gt;S-&gt;GlobalCameraPosition[1];
00925       RGL-&gt;EyeZ = RGL-&gt;S-&gt;GlobalCameraPosition[2];
00926 
00927       RGL-&gt;VpX = RGL-&gt;EyeX + RGL-&gt;S-&gt;GlobalCameraDirection[0] * vsca;
00928       RGL-&gt;VpY = RGL-&gt;EyeY + RGL-&gt;S-&gt;GlobalCameraDirection[1] * vsca;
00929       RGL-&gt;VpZ = RGL-&gt;EyeZ + RGL-&gt;S-&gt;GlobalCameraDirection[2] * vsca;
00930 
00931       RGL-&gt;VupX = RGL-&gt;S-&gt;GlobalCameraZenith[0];
00932       RGL-&gt;VupY = RGL-&gt;S-&gt;GlobalCameraZenith[1];
00933       RGL-&gt;VupZ = RGL-&gt;S-&gt;GlobalCameraZenith[2];
00934 
00935       RGL-&gt;Fov = 45.0;      
00936     }
00937 
00938   <font class="keywordflow">if</font> (!RGL-&gt;MultipleViewsOn)
00939     {
00940       glViewport((GLint)0.0, (GLint)0.0, (GLsizei)RGL-&gt;WindowX, (GLsizei)RGL-&gt;WindowY);
00941       glMatrixMode(GL_PROJECTION);
00942       glLoadIdentity();
00943       gluPerspective(RGL-&gt;Fov,(GLfloat)RGL-&gt;WindowX / (GLfloat)RGL-&gt;WindowY, 
00944                      RGL-&gt;Near, RGL-&gt;Far);
00945       glMatrixMode(GL_MODELVIEW);
00946       glLoadIdentity();  
00947       
00948       gluLookAt(RGL-&gt;EyeX, RGL-&gt;EyeY, RGL-&gt;EyeZ, RGL-&gt;VpX, 
00949                 RGL-&gt;VpY, RGL-&gt;VpZ, RGL-&gt;VupX, RGL-&gt;VupY, RGL-&gt;VupZ);
00950       
00951       RGL-&gt;<a class="code" href="class_RenderGL.html#b4">SceneRender</a>();
00952     }
00953   <font class="keywordflow">else</font>
00954     {
00955 
00956       glViewport((GLint)0.0, (GLint)0.0, (GLsizei)RGL-&gt;WindowX/2, (GLsizei)RGL-&gt;WindowY/2);
00957       glMatrixMode( GL_PROJECTION );
00958       glLoadIdentity();
00959       glOrtho(RGL-&gt;BoundingBoxMin[2]*1.2-scenecenter[2]*1.2,  
00960               RGL-&gt;BoundingBoxMax[2]*1.2-scenecenter[2]*1.2, 
00961               RGL-&gt;BoundingBoxMin[1]*1.2-scenecenter[1]*1.2, 
00962               RGL-&gt;BoundingBoxMax[1]*1.2-scenecenter[1]*1.2, 0.1, 100000.0);
00963       glMatrixMode(GL_MODELVIEW);
00964       glLoadIdentity();
00965       gluLookAt(scenecenter[0]-1000.0, scenecenter[1], scenecenter[2], 
00966                 scenecenter[0], scenecenter[1], scenecenter[2], 0.0, 1.0, 0.0);      
00967  
00968       RGL-&gt;<a class="code" href="class_RenderGL.html#b4">SceneRender</a>();
00969       
00970       glViewport((GLint)RGL-&gt;WindowX/2, (GLint)RGL-&gt;WindowY/2, 
00971                  (GLsizei)RGL-&gt;WindowX/2, (GLsizei)RGL-&gt;WindowY/2);
00972       glMatrixMode( GL_PROJECTION );
00973       glLoadIdentity();
00974       glOrtho(RGL-&gt;BoundingBoxMin[0]*1.2-scenecenter[0]*1.2, 
00975               RGL-&gt;BoundingBoxMax[0]*1.2-scenecenter[0]*1.2, 
00976               RGL-&gt;BoundingBoxMin[2]*1.2-scenecenter[2]*1.2, 
00977               RGL-&gt;BoundingBoxMax[2]*1.2-scenecenter[2]*1.2, 0.1, 100000.0);
00978       glMatrixMode(GL_MODELVIEW);
00979       glLoadIdentity();
00980       gluLookAt(scenecenter[0], scenecenter[1]+1000.0, scenecenter[2], 
00981                 scenecenter[0], scenecenter[1], scenecenter[2], 0.0, 0.0, -1.0);      
00982 
00983       RGL-&gt;<a class="code" href="class_RenderGL.html#b4">SceneRender</a>();
00984 
00985       glViewport((GLint)0.0, (GLint)RGL-&gt;WindowY/2, 
00986                  (GLsizei)RGL-&gt;WindowX/2, (GLsizei)RGL-&gt;WindowY/2);
00987       glMatrixMode( GL_PROJECTION );
00988       glLoadIdentity();
00989       glOrtho(RGL-&gt;BoundingBoxMin[0]*1.2-scenecenter[0]*1.2, 
00990               RGL-&gt;BoundingBoxMax[0]*1.2-scenecenter[0]*1.2, 
00991               RGL-&gt;BoundingBoxMin[1]*1.2-scenecenter[1]*1.2, 
00992               RGL-&gt;BoundingBoxMax[1]*1.2-scenecenter[1]*1.2, 0.1, 100000.0);
00993       glMatrixMode(GL_MODELVIEW);
00994       glLoadIdentity();
00995       gluLookAt(scenecenter[0], scenecenter[1], scenecenter[2]+1000.0, 
00996                 scenecenter[0], scenecenter[1], scenecenter[2], 0.0, 1.0, 0.0);      
00997 
00998       RGL-&gt;<a class="code" href="class_RenderGL.html#b4">SceneRender</a>();
00999 
01000       glViewport((GLint)RGL-&gt;WindowX/2, (GLint)0.0, 
01001                  (GLsizei)RGL-&gt;WindowX/2, (GLsizei)RGL-&gt;WindowY/2);
01002       glMatrixMode(GL_PROJECTION);
01003       glLoadIdentity();
01004       gluPerspective(RGL-&gt;Fov,(GLfloat)RGL-&gt;WindowX / (GLfloat)RGL-&gt;WindowY, 
01005                      RGL-&gt;Near, RGL-&gt;Far);
01006       glMatrixMode(GL_MODELVIEW);
01007       glLoadIdentity();  
01008       gluLookAt(RGL-&gt;EyeX, RGL-&gt;EyeY, RGL-&gt;EyeZ, RGL-&gt;VpX, 
01009                 RGL-&gt;VpY, RGL-&gt;VpZ, RGL-&gt;VupX, RGL-&gt;VupY, RGL-&gt;VupZ);
01010       
01011       RGL-&gt;<a class="code" href="class_RenderGL.html#b4">SceneRender</a>();
01012 
01013     }
01014     
01015   glutSwapBuffers();
01016 }
01017 
01018 
<a name="l01019"></a><a class="code" href="class_RenderGL.html#b4">01019</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b4">RenderGL::SceneRender</a>()<font class="keyword">
</font>01020 <font class="keyword"></font>{
01021   <a class="code" href="class_MSLVector.html">MSLVector</a> scenecenter(3);
01022 
01023   glPushMatrix();
01024 
01025   scenecenter[0] = (BoundingBoxMin[0] + BoundingBoxMax[0])/2.0;
01026   scenecenter[1] = (BoundingBoxMin[1] + BoundingBoxMax[1])/2.0;
01027   scenecenter[2] = (BoundingBoxMin[2] + BoundingBoxMax[2])/2.0;
01028 
01029   <font class="comment">// set the position and orientation of the scene</font>
01030   glTranslatef(Position[0], Position[1], Position[2]);
01031 
01032   <font class="comment">// rotate around the position the viewer looks at</font>
01033   glTranslatef(scenecenter[0], scenecenter[1], scenecenter[2]);
01034   glRotatef(Orientation[2], 0.0, 0.0, 1.0);
01035   glRotatef(Orientation[1], 0.0, 1.0, 0.0);
01036   glRotatef(Orientation[0], 1.0, 0.0, 0.0);    
01037   glTranslatef(-scenecenter[0], -scenecenter[1], -scenecenter[2]);
01038 
01039   <font class="comment">// draw the coordinate</font>
01040   <font class="comment">//ShowCoordinateFrame();</font>
01041      
01042   <font class="comment">// Draw environment</font>
01043   <a class="code" href="class_RenderGL.html#b15">DrawEnv</a>();
01044 
01045   <a class="code" href="class_RenderGL.html#b14">DrawBodies</a>(CurrentAnimationFrame);
01046 
01047   <font class="keywordflow">if</font> (ShowPathOn)
01048     <a class="code" href="class_RenderGL.html#b11">DrawPath</a>();
01049 
01050   <font class="keywordflow">if</font> (CurrentObject != -1)
01051     <a class="code" href="class_RenderGL.html#b3">WhichObject</a>(CurrentObject)-&gt;<a class="code" href="class_mslGLObject.html#a14">ObjectHighlight</a>();
01052 
01053   <font class="keywordflow">if</font> (BoundingBoxOn)
01054     <a class="code" href="class_RenderGL.html#b10">DrawBoundingBox</a>();
01055 
01056   glPopMatrix();
01057   
01058 }
01059 
01060 
<a name="l01061"></a><a class="code" href="class_RenderGL.html#b5">01061</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b5">RenderGL::SetLightPos</a>()<font class="keyword">
</font>01062 <font class="keyword"></font>{
01063   GLfloat lightpos[4];
01064 
01065   lightpos[0] = LightPosX;
01066   lightpos[1] = LightPosY;
01067   lightpos[2] = LightPosZ;
01068   lightpos[3] = 1.0;
01069   
01070   glLightfv(GL_LIGHT0, GL_POSITION, lightpos);  
01071 }
01072 
01073 
<a name="l01074"></a><a class="code" href="class_RenderGL.html#b6">01074</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b6">RenderGL::SetSceneOrientationChange</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a>&amp; oric)<font class="keyword">
</font>01075 <font class="keyword"></font>{
01076   
01077   Orientation[0] = Orientation[0] + oric[0];
01078   Orientation[1] = Orientation[1] + oric[1];
01079   Orientation[2] = Orientation[2] + oric[2];
01080 
01081   <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i=0; i&lt;3; i++)
01082     {
01083       <font class="keywordflow">while</font>(Orientation[i]&gt;=2*PI) Orientation[i] = Orientation[i] - 360.0;
01084       <font class="keywordflow">while</font>(Orientation[i]&lt;0) Orientation[i] = Orientation[i] + 360.0;
01085     }
01086 }
01087 
01088 
01089 
01090 
<a name="l01091"></a><a class="code" href="class_RenderGL.html#b7">01091</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b7">RenderGL::SetScenePositionChange</a>(<font class="keyword">const</font> <a class="code" href="class_MSLVector.html">MSLVector</a>&amp; posc)<font class="keyword">
</font>01092 <font class="keyword"></font>{
01093   
01094   Position[0] = Position[0] + posc[0];
01095   Position[1] = Position[1] + posc[1];
01096   Position[2] = Position[2] + posc[2];
01097 }
01098 
01099 
01100 
<a name="l01101"></a><a class="code" href="class_RenderGL.html#b10">01101</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#b10">RenderGL::DrawBoundingBox</a>()<font class="keyword">
</font>01102 <font class="keyword"></font>{
01103   
01104   glDisable(GL_TEXTURE_2D);
01105   glDisable(GL_LIGHTING);
01106 
01107   GLfloat Diffuse[] = {1.0, 0.0, 0.0};
01108   GLfloat Ambient[] = {1.0, 0.0, 0.0};
01109   GLfloat Specular[] = {1.0, 0.0, 0.0};
01110   GLfloat Shininess[] = {1.0, 0.0, 0.0};
01111 
01112   glPushMatrix();
01113 
01114   glLineWidth(1.0);
01115 
01116   glColor4f(0.41, 0.55, 0.137, 1.0);
01117   glMaterialfv(GL_FRONT, GL_DIFFUSE, Diffuse);
01118   glMaterialfv(GL_FRONT, GL_AMBIENT, Ambient);
01119   glMaterialfv(GL_FRONT, GL_SPECULAR, Specular);
01120   glMaterialfv(GL_FRONT, GL_SHININESS, Shininess);
01121 
01122   glBegin(GL_LINES);
01123   
01124   glNormal3f(-1.0, -1.0, 1.0);
01125   glVertex3f(BoundingBoxMin[0], BoundingBoxMin[1], BoundingBoxMin[2]);
01126   glNormal3f(1.0, -1.0, 1.0);
01127   glVertex3f(BoundingBoxMax[0], BoundingBoxMin[1], BoundingBoxMin[2]);
01128 
01129   glNormal3f(-1.0, -1.0, 1.0);
01130   glVertex3f(BoundingBoxMin[0], BoundingBoxMin[1], BoundingBoxMin[2]);
01131   glNormal3f(-1.0, 1.0, 1.0);
01132   glVertex3f(BoundingBoxMin[0], BoundingBoxMax[1], BoundingBoxMin[2]);
01133 
01134   glNormal3f(1.0, 1.0, 1.0);
01135   glVertex3f(BoundingBoxMax[0], BoundingBoxMax[1], BoundingBoxMin[2]);
01136   glNormal3f(-1.0, 1.0, 1.0);
01137   glVertex3f(BoundingBoxMin[0], BoundingBoxMax[1], BoundingBoxMin[2]);
01138 
01139   glNormal3f(1.0, 1.0, 1.0);
01140   glVertex3f(BoundingBoxMax[0], BoundingBoxMax[1], BoundingBoxMin[2]);
01141   glNormal3f(1.0, -1.0, 1.0);
01142   glVertex3f(BoundingBoxMax[0], BoundingBoxMin[1], BoundingBoxMin[2]);
01143 
01144 
01145 
01146   glNormal3f(1.0, 1.0, -1.0);
01147   glVertex3f(BoundingBoxMax[0], BoundingBoxMax[1], BoundingBoxMax[2]);
01148   glNormal3f(-1.0, 1.0, -1.0);
01149   glVertex3f(BoundingBoxMin[0], BoundingBoxMax[1], BoundingBoxMax[2]);
01150 
01151   glNormal3f(1.0, 1.0, -1.0);
01152   glVertex3f(BoundingBoxMax[0], BoundingBoxMax[1], BoundingBoxMax[2]);
01153   glNormal3f(1.0, -1.0, -1.0);
01154   glVertex3f(BoundingBoxMax[0], BoundingBoxMin[1], BoundingBoxMax[2]);
01155 
01156   glNormal3f(-1.0, -1.0, -1.0);
01157   glVertex3f(BoundingBoxMin[0], BoundingBoxMin[1], BoundingBoxMax[2]);
01158   glNormal3f(1.0, -1.0, -1.0);
01159   glVertex3f(BoundingBoxMax[0], BoundingBoxMin[1], BoundingBoxMax[2]);
01160 
01161   glNormal3f(-1.0, -1.0, -1.0);
01162   glVertex3f(BoundingBoxMin[0], BoundingBoxMin[1], BoundingBoxMax[2]);
01163   glNormal3f(-1.0, 1.0, -1.0);
01164   glVertex3f(BoundingBoxMin[0], BoundingBoxMax[1], BoundingBoxMax[2]);
01165 
01166 
01167 
01168   glNormal3f(1.0, -1.0, 1.0);
01169   glVertex3f(BoundingBoxMax[0], BoundingBoxMin[1], BoundingBoxMin[2]);
01170   glNormal3f(1.0, -1.0, -1.0);
01171   glVertex3f(BoundingBoxMax[0], BoundingBoxMin[1], BoundingBoxMax[2]);
01172 
01173   glNormal3f(1.0, 1.0, -1.0);
01174   glVertex3f(BoundingBoxMax[0], BoundingBoxMax[1], BoundingBoxMax[2]);
01175   glNormal3f(1.0, 1.0, 1.0);
01176   glVertex3f(BoundingBoxMax[0], BoundingBoxMax[1], BoundingBoxMin[2]);
01177 
01178   glNormal3f(-1.0, 1.0, 1.0);
01179   glVertex3f(BoundingBoxMin[0], BoundingBoxMax[1], BoundingBoxMin[2]);
01180   glNormal3f(-1.0, 1.0, -1.0);
01181   glVertex3f(BoundingBoxMin[0], BoundingBoxMax[1], BoundingBoxMax[2]);
01182 
01183   glNormal3f(-1.0, -1.0, 1.0);
01184   glVertex3f(BoundingBoxMin[0], BoundingBoxMin[1], BoundingBoxMin[2]);
01185   glNormal3f(-1.0, -1.0, 1.0);
01186   glVertex3f(BoundingBoxMin[0], BoundingBoxMin[1], BoundingBoxMax[2]);
01187 
01188   glEnd();
01189   
01190   glPopMatrix();
01191   
01192   glLineWidth(1.0);
01193 
01194   glEnable(GL_TEXTURE_2D);
01195   glEnable(GL_LIGHTING);
01196 }
01197 
01198 
01199 
<a name="l01200"></a><a class="code" href="class_RenderGL.html#d2">01200</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#d2">RenderGL::GlutReshape</a>(<font class="keywordtype">int</font> w, <font class="keywordtype">int</font> h)<font class="keyword">
</font>01201 <font class="keyword"></font>{
01202   RGL-&gt;WindowX = w;
01203   RGL-&gt;WindowY = h;
01204   RGL-&gt;WindowZ = ((<font class="keywordtype">float</font>) w + (<font class="keywordtype">float</font>) h)/2.0;
01205 
01206   glViewport(0,0,(GLsizei) RGL-&gt;WindowX, (GLsizei) RGL-&gt;WindowY);
01207   glMatrixMode(GL_PROJECTION);
01208   glLoadIdentity();
01209   gluPerspective(RGL-&gt;Fov,(GLfloat) RGL-&gt;WindowX / (GLfloat) RGL-&gt;WindowY, RGL-&gt;Near, RGL-&gt;Far);
01210   glMatrixMode(GL_MODELVIEW);
01211   glLoadIdentity();  
01212   gluLookAt(RGL-&gt;EyeX, RGL-&gt;EyeY, RGL-&gt;EyeZ, RGL-&gt;VpX, 
01213             RGL-&gt;VpY, RGL-&gt;VpZ, RGL-&gt;VupX, RGL-&gt;VupY, RGL-&gt;VupZ);
01214 }
01215 
01216 
<a name="l01217"></a><a class="code" href="class_RenderGL.html#d3">01217</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#d3">RenderGL::GlutMouse</a>(<font class="keywordtype">int</font> button, <font class="keywordtype">int</font> state, <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y)<font class="keyword">
</font>01218 <font class="keyword"></font>{
01219   <font class="keywordtype">float</font> x1, y1;
01220 
01221   x1 = ((<font class="keywordtype">float</font>)x-RGL-&gt;WindowX/2.0)*(MaxX-MinX)/RGL-&gt;WindowX;
01222   y1 = ((<font class="keywordtype">float</font>)y-RGL-&gt;WindowY/2.0)*(MaxY-MinY)/RGL-&gt;WindowY*-1.0;
01223 
01224   RGL-&gt;LastX = x1;
01225   RGL-&gt;LastY = y1;
01226 
01227   RGL-&gt;CurrentMouseButton = button;
01228   RGL-&gt;CurrentMouseState = state;
01229 }
01230 
01231 
<a name="l01232"></a><a class="code" href="class_RenderGL.html#d4">01232</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#d4">RenderGL::GlutMouseMove</a>( <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y )<font class="keyword">
</font>01233 <font class="keyword"></font>{
01234   <font class="keywordtype">int</font> i;
01235   <font class="keywordtype">float</font> x1, y1;
01236   <font class="keywordtype">float</font> delta_x, delta_y;
01237   <a class="code" href="class_MSLVector.html">MSLVector</a> oric(3), posc(3);
01238   <a class="code" href="class_MSLVector.html">MSLVector</a> sori(3);
01239   <a class="code" href="class_MSLMatrix.html">MSLMatrix</a> mt;
01240 
01241   oric[0] = 0.0;  oric[1] = 0.0;  oric[2] = 0.0;
01242   posc[0] = 0.0;  posc[1] = 0.0;  posc[2] = 0.0;
01243 
01244   x1 = ((<font class="keywordtype">float</font>)x-RGL-&gt;WindowX/2.0)*(MaxX-MinX)/RGL-&gt;WindowX;
01245   y1 = ((<font class="keywordtype">float</font>)y-RGL-&gt;WindowY/2.0)*(MaxY-MinY)/RGL-&gt;WindowY*-1.0;
01246 
01247   delta_x = (x1 - RGL-&gt;LastX);
01248   delta_y = (y1 - RGL-&gt;LastY);
01249 
01250   <font class="keywordflow">if</font>(RGL-&gt;CurrentKeyboard == ORI_MOVE_MODE)
01251     {
01252       <font class="comment">// change the position and orientation of the whole scene</font>
01253       
01254       <font class="comment">// change the orientation around y and z axis</font>
01255       <font class="keywordflow">if</font>(RGL-&gt;CurrentMouseButton==GLUT_LEFT_BUTTON &amp;&amp; RGL-&gt;CurrentMouseState==GLUT_DOWN)
01256         {
01257 
01258           sori[0] = RGL-&gt;Orientation[0];
01259           sori[1] = RGL-&gt;Orientation[1];
01260           sori[2] = RGL-&gt;Orientation[2];
01261 
01262           mt = <a class="code" href="renderglobj_C.html#a15">free_rotate</a>(RGL-&gt;VCoordY, <a class="code" href="renderglobj_C.html#a13">rpy</a>(sori*(PI/180.0)), 
01263                            delta_x / (MaxX - MinX) * PI / 5.0);
01264 
01265 
01266           mt = <a class="code" href="renderglobj_C.html#a15">free_rotate</a>(RGL-&gt;VCoordX, mt, 
01267                            delta_y / (MaxY - MinY) * PI / 5.0);
01268           
01269           oric = <a class="code" href="renderglobj_C.html#a12">irpy</a>(mt)*180.0/PI - sori;
01270           RGL-&gt;<a class="code" href="class_RenderGL.html#b6">SetSceneOrientationChange</a>(oric);
01271           
01272         }
01273 
01274       <font class="comment">// change the position along the x and y axis</font>
01275       <font class="keywordflow">if</font>(RGL-&gt;CurrentMouseButton==GLUT_MIDDLE_BUTTON &amp;&amp; RGL-&gt;CurrentMouseState==GLUT_DOWN)
01276         {
01277           posc = -delta_x * RGL-&gt;ChangeRate * RGL-&gt;VCoordX + 
01278             delta_y * RGL-&gt;ChangeRate * RGL-&gt;VCoordY;
01279 
01280           RGL-&gt;<a class="code" href="class_RenderGL.html#b7">SetScenePositionChange</a>(posc*0.1);
01281         }
01282 
01283       <font class="comment">// change the orientation around x axis and position along the z axis</font>
01284       <font class="keywordflow">if</font>(RGL-&gt;CurrentMouseButton==GLUT_RIGHT_BUTTON &amp;&amp; RGL-&gt;CurrentMouseState==GLUT_DOWN)
01285         {
01286           sori[0] = RGL-&gt;Orientation[0];
01287           sori[1] = RGL-&gt;Orientation[1];
01288           sori[2] = RGL-&gt;Orientation[2];
01289 
01290           mt = <a class="code" href="renderglobj_C.html#a15">free_rotate</a>(RGL-&gt;VCoordZ, <a class="code" href="renderglobj_C.html#a13">rpy</a>(sori*(PI/180.0)), 
01291                            delta_x / (MaxX - MinX) * PI / 5.0);
01292 
01293           oric = <a class="code" href="renderglobj_C.html#a12">irpy</a>(mt)*180.0/PI - sori;
01294           RGL-&gt;<a class="code" href="class_RenderGL.html#b6">SetSceneOrientationChange</a>(oric);
01295 
01296           posc = 5.0 * delta_y / (MaxY - MinY) * PI * RGL-&gt;ChangeRate * RGL-&gt;VCoordZ;
01297           RGL-&gt;<a class="code" href="class_RenderGL.html#b7">SetScenePositionChange</a>(posc);
01298         }
01299     }
01300   <font class="keywordflow">else</font>
01301     {
01302       <font class="comment">// change the scale, orientation and position of the current object</font>
01303 
01304       <font class="comment">// change the orientation around y and z axis </font>
01305       <font class="keywordflow">if</font>(RGL-&gt;CurrentMouseButton==GLUT_LEFT_BUTTON &amp;&amp; RGL-&gt;CurrentMouseState==GLUT_DOWN)
01306         {
01307           <font class="keywordflow">if</font>(RGL-&gt;CurrentObject!=-1)
01308             {
01309               oric[0] = 0.0;
01310               oric[1] = delta_x / (MaxX - MinX) * PI * RGL-&gt;ChangeRate; 
01311               oric[2] = delta_y / (MaxY - MinY) * PI * RGL-&gt;ChangeRate;
01312               
01313               RGL-&gt;<a class="code" href="class_RenderGL.html#b3">WhichObject</a>(RGL-&gt;CurrentObject)-&gt;<a class="code" href="class_mslGLObject.html#a19">SetBodyOrientationChange</a>(oric);
01314             }
01315         }
01316 
01317       <font class="comment">// change the position along x and y</font>
01318       <font class="keywordflow">if</font>(RGL-&gt;CurrentMouseButton==GLUT_MIDDLE_BUTTON &amp;&amp; RGL-&gt;CurrentMouseState==GLUT_DOWN)
01319         {
01320           <font class="keywordflow">if</font>(RGL-&gt;CurrentObject!=-1)
01321             {
01322               RGL-&gt;<a class="code" href="class_RenderGL.html#b3">WhichObject</a>(RGL-&gt;CurrentObject)-&gt;Position[0] =
01323                 RGL-&gt;<a class="code" href="class_RenderGL.html#b3">WhichObject</a>(RGL-&gt;CurrentObject)-&gt;Position[0] + delta_x * RGL-&gt;ChangeRate;
01324               RGL-&gt;<a class="code" href="class_RenderGL.html#b3">WhichObject</a>(RGL-&gt;CurrentObject)-&gt;Position[1] = 
01325                 RGL-&gt;<a class="code" href="class_RenderGL.html#b3">WhichObject</a>(RGL-&gt;CurrentObject)-&gt;Position[1] + delta_y * RGL-&gt;ChangeRate;
01326             }
01327         }
01328       
01329       <font class="comment">// change the orientation around x or scale of the object or position along z</font>
01330       <font class="keywordflow">if</font>(RGL-&gt;CurrentMouseButton==GLUT_RIGHT_BUTTON &amp;&amp; RGL-&gt;CurrentMouseState==GLUT_DOWN)
01331         {
01332           <font class="keywordflow">if</font>(RGL-&gt;CurrentObject!=-1)
01333             {
01334               oric[0] = delta_x / (MaxX - MinX) * PI * RGL-&gt;ChangeRate;
01335               oric[1] = 0.0;             oric[2] = 0.0;
01336               RGL-&gt;<a class="code" href="class_RenderGL.html#b3">WhichObject</a>(RGL-&gt;CurrentObject)-&gt;<a class="code" href="class_mslGLObject.html#a19">SetBodyOrientationChange</a>(oric);
01337 
01338               <font class="keywordflow">if</font>(RGL-&gt;CurrentKeyboard == SCALE_MOVE_MODE)
01339                 {
01340                   <font class="keywordflow">for</font>(i=0; i&lt;3; i++)
01341                     {
01342                       RGL-&gt;<a class="code" href="class_RenderGL.html#b3">WhichObject</a>(RGL-&gt;CurrentObject)-&gt;Scale[i] = 
01343                         RGL-&gt;<a class="code" href="class_RenderGL.html#b3">WhichObject</a>(RGL-&gt;CurrentObject)-&gt;Scale[i] * 
01344                         (1+delta_y/(MaxY - MinY));
01345                     }
01346                 }
01347               <font class="keywordflow">else</font>
01348                 {
01349                   RGL-&gt;<a class="code" href="class_RenderGL.html#b3">WhichObject</a>(RGL-&gt;CurrentObject)-&gt;Position[2] = 
01350                     RGL-&gt;<a class="code" href="class_RenderGL.html#b3">WhichObject</a>(RGL-&gt;CurrentObject)-&gt;Position[2] + delta_y * RGL-&gt;ChangeRate;
01351                 }
01352             }
01353         }
01354     }
01355 
01356   RGL-&gt;LastX = x1;
01357   RGL-&gt;LastY = y1;
01358 
01359   glutPostRedisplay();
01360 }
01361 
01362 
01363 
<a name="l01364"></a><a class="code" href="class_RenderGL.html#d0">01364</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#d0">RenderGL::GlutIdleProcessing</a>()<font class="keyword">
</font>01365 <font class="keyword"></font>{
01366   <font class="keywordtype">int</font> i;
01367 
01368   <font class="comment">// Handle the window events for the Gui</font>
01369   <font class="keywordflow">for</font> (i = 0; i &lt; 20; i++) <font class="comment">// This is a hack!!!</font>
01370     RGL-&gt;G-&gt;<a class="code" href="class_Render.html#a5">HandleEvents</a>();
01371 
01372   RGL-&gt;<a class="code" href="class_Render.html#a5">HandleEvents</a>();
01373 
01374   <font class="comment">// Allow exiting by pressing Exit button in Gui</font>
01375   <font class="keywordflow">if</font> (RGL-&gt;G-&gt;Finished)
01376     exit(-1);
01377 
01378   <font class="keywordflow">if</font> ( glutGetWindow() != RGL-&gt;MainWindow ) 
01379     glutSetWindow(RGL-&gt;MainWindow);  
01380 
01381   glutPostRedisplay();
01382 
01383 }
01384 
01385 
<a name="l01386"></a><a class="code" href="class_RenderGL.html#d5">01386</a> <font class="keywordtype">void</font> <a class="code" href="class_RenderGL.html#d5">RenderGL::GlutKeyboard</a>(<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> Key, <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y)<font class="keyword">
</font>01387 <font class="keyword"></font>{
01388   <font class="keywordflow">switch</font>(Key) {
01389   <font class="keywordflow">case</font> <font class="charliteral">'a'</font>:
01390     RGL-&gt;<a class="code" href="class_Render.html#a13">ButtonHandle</a>(74);
01391     <font class="keywordflow">break</font>;
01392   <font class="keywordflow">case</font> <font class="charliteral">'b'</font>:
01393     RGL-&gt;BoundingBoxOn = !(RGL-&gt;BoundingBoxOn);
01394     <font class="keywordflow">break</font>;
01395   <font class="keywordflow">case</font> <font class="charliteral">'d'</font>:
01396     RGL-&gt;<a class="code" href="class_Render.html#a13">ButtonHandle</a>(73);
01397     <font class="keywordflow">break</font>;
01398   <font class="keywordflow">case</font> <font class="charliteral">'h'</font>:
01399     cout &lt;&lt; endl;
01400     cout &lt;&lt; <font class="stringliteral">"HELP FOR RENDERGL KEYBOARD CONTROL:"</font> &lt;&lt; endl;
01401     cout &lt;&lt; <font class="stringliteral">"'a': Accelerate Animation Rate"</font> &lt;&lt; endl;
01402     cout &lt;&lt; <font class="stringliteral">"'b': Show and Hide the Bounding Box"</font> &lt;&lt; endl;
01403     cout &lt;&lt; <font class="stringliteral">"'d': Decelerate Animation Rate"</font> &lt;&lt; endl;
01404     cout &lt;&lt; <font class="stringliteral">"'h': Show the Keyboard Control Help"</font> &lt;&lt; endl;
01405     cout &lt;&lt; <font class="stringliteral">"'m': Change to Multiview Mode"</font> &lt;&lt; endl;
01406     cout &lt;&lt; <font class="stringliteral">"'p': Pause or Continue the Animation"</font> &lt;&lt; endl;
01407     cout &lt;&lt; <font class="stringliteral">"'q': Quit"</font> &lt;&lt; endl;
01408     cout &lt;&lt; <font class="stringliteral">"'r': Reset the Rendering Options\n"</font> &lt;&lt; endl;
01409     <font class="keywordflow">break</font>;
01410   <font class="keywordflow">case</font> <font class="charliteral">'m'</font>:
01411     RGL-&gt;MultipleViewsOn = !(RGL-&gt;MultipleViewsOn);
01412     <font class="keywordflow">break</font>;
01413   <font class="keywordflow">case</font> <font class="charliteral">'p'</font>:
01414     RGL-&gt;<a class="code" href="class_Render.html#a13">ButtonHandle</a>(72);
01415     <font class="keywordflow">break</font>;
01416   <font class="keywordflow">case</font> <font class="charliteral">'q'</font>:
01417     exit(0);
01418     <font class="keywordflow">break</font>;
01419   <font class="keywordflow">case</font> <font class="charliteral">'r'</font>:
01420     RGL-&gt;<a class="code" href="class_Render.html#a13">ButtonHandle</a>(75);
01421     <font class="keywordflow">break</font>;
01422   <font class="keywordflow">case</font> <font class="charliteral">'v'</font>:
01423     RGL-&gt;AttachedCameraOn = !(RGL-&gt;AttachedCameraOn);
01424     <font class="keywordflow">break</font>;
01425   };
01426   
01427   glutPostRedisplay();   
01428 }
01429 
01430 
01431 
01432 
01433 
01434 
01435 
01436 
</div></pre><HEAD>
<TITLE>Motion Strategy Library</TITLE>
</HEAD>

<p>

<hr>

Web page maintained by 
<a href="http://janowiec.cs.iastate.edu/~lavalle">Steve LaValle</a><br>

Partial support provided by NSF CAREER Award IRI-970228 (LaValle),
Honda Research, and Iowa State University.<br>

Contributors:  Anna Atramentov, Peng Cheng, James Kuffner, Steve LaValle, and Libo Yang.<br>
