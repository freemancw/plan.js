Make the shared event handling more robust.

